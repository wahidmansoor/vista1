var Qe=Object.defineProperty;var Ze=(t,s,i)=>s in t?Qe(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i;var ie=(t,s,i)=>Ze(t,typeof s!="symbol"?s+"":s,i);import{r as g,j as e,u as je,y as ei,h as ii,c as ti,d as F}from"./react-vendor-B1d8dduC.js";import{aK as ke,aL as si,aM as ai,aN as ni,aO as _e,aP as Te,b as ri,aQ as Ie,aR as Pe,X as Ae,aS as Ee,aT as Re,aU as oi,z as J,x as me,r as $,y as A,_ as De,aV as X,I as li,ar as ci,Q as L,aW as di,aX as mi,Y as gi,aY as pi,aZ as ui,E as yi,a_ as de,a$ as hi,aJ as ge,p as fi,C as xi,b0 as vi,u as k,a7 as Fe,b1 as Me,b2 as bi,b3 as wi,b4 as Ni,b5 as Ci,b6 as Si,b7 as ji,b8 as ki,b9 as _i,ba as Ti,bb as Ii,bc as Pi,bd as Ai,$ as U,be as Ei,bf as Ri,bg as Di,bh as Fi,bi as Mi,aq as qi,bj as Oi,aI as Li,bk as Bi,bl as Ui}from"./vendor-COw5p1kA.js";import{c as Gi,u as qe,t as H,B as Hi,E as Oe,C as te,a as se,b as ae,d as ne,s as $i}from"./module-cdu-BUS-kbPn.js";import{H as Y,a as W,G as Vi}from"./gemini-sdk-BpXHbcls.js";const M=si,q=ai,O=ni,D=g.forwardRef(({className:t,sideOffset:s=4,...i},a)=>e.jsx(ke,{ref:a,sideOffset:s,className:Gi("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...i}));D.displayName=ke.displayName;const zi=oi,Le=g.forwardRef(({className:t,...s},i)=>e.jsx(_e,{ref:i,className:"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",...s}));Le.displayName=_e.displayName;const Ki=ri("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Be=g.forwardRef(({className:t,variant:s,...i},a)=>e.jsx(Te,{ref:a,className:Ki({variant:s}),...i}));Be.displayName=Te.displayName;const Yi=g.forwardRef(({className:t,...s},i)=>e.jsx(Ie,{ref:i,className:"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",...s}));Yi.displayName=Ie.displayName;const Ue=g.forwardRef(({className:t,...s},i)=>e.jsx(Pe,{ref:i,className:"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600","toast-close":"",...s,children:e.jsx(Ae,{className:"h-4 w-4"})}));Ue.displayName=Pe.displayName;const Ge=g.forwardRef(({className:t,...s},i)=>e.jsx(Ee,{ref:i,className:"text-sm font-semibold",...s}));Ge.displayName=Ee.displayName;const He=g.forwardRef(({className:t,...s},i)=>e.jsx(Re,{ref:i,className:"text-sm opacity-90",...s}));He.displayName=Re.displayName;function Wi(){const{toasts:t}=qe();return e.jsxs(zi,{children:[t.map(function({id:s,title:i,description:a,action:n,...l}){return e.jsxs(Be,{...l,children:[e.jsxs("div",{className:"grid gap-1",children:[i&&e.jsx(Ge,{children:i}),a&&e.jsx(He,{children:a})]}),n,e.jsx(Ue,{})]},s)}),e.jsx(Le,{})]})}const Xi=({children:t})=>e.jsx("div",{className:"bg-white rounded-lg shadow-lg",children:e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"space-y-6",children:t})})}),Ji=({children:t})=>e.jsx("div",{className:"bg-white rounded-lg shadow-lg p-6",children:t}),Qi=({children:t})=>e.jsx("div",{className:"opd-card",children:e.jsx("div",{className:"opd-card-content",children:e.jsx("div",{className:"space-y-6",children:t})})}),Zi=({children:t})=>e.jsx("div",{className:"bg-white rounded-lg shadow-lg p-6",children:t}),et=({children:t})=>e.jsx("div",{className:"bg-white rounded-lg shadow-lg p-6",children:t}),it=({patientData:t,isEnabled:s=!1})=>{const[i,a]=g.useState("loading"),[n,l]=g.useState(null),[c,u]=g.useState(null);g.useEffect(()=>{if(!s){a("disabled");return}if(!t){a("disabled"),l("No patient data available to generate a summary.");return}(async()=>{try{a("loading"),await new Promise(h=>setTimeout(h,1500));const o=y(t);l(o),a("generated")}catch(o){console.error("Failed to generate AI summary:",o),u("Failed to generate summary. Please try again later."),a("error")}})()},[t,s]);const y=p=>"This 58-year-old patient presents with symptoms suggestive of possible oncological condition. Based on the available data, recommend further investigation including appropriate imaging and possibly tissue diagnosis. Consider referral to specialized oncology service for comprehensive evaluation.";return i==="disabled"&&!n?null:e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("svg",{className:"w-6 h-6 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),e.jsx("h3",{className:"text-lg font-semibold text-blue-800",children:"AI Summary"})]}),i==="loading"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-blue-600",children:[e.jsx(J,{className:"w-5 h-5 mr-2 animate-spin"}),e.jsx("span",{children:"Generating clinical summary..."})]}),e.jsx("div",{className:"h-4 bg-blue-100 rounded animate-pulse"}),e.jsx("div",{className:"h-4 bg-blue-100 rounded animate-pulse w-5/6"}),e.jsx("div",{className:"h-4 bg-blue-100 rounded animate-pulse w-4/6"})]}),i==="generated"&&n&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-green-600 mb-2",children:[e.jsx(me,{className:"w-5 h-5 mr-2"}),e.jsx("span",{children:"Summary generated"})]}),e.jsx("p",{className:"text-gray-700",children:n})]}),i==="error"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-red-600",children:[e.jsx($,{className:"w-5 h-5 mr-2"}),e.jsx("span",{children:c||"Failed to generate summary"})]}),e.jsx("button",{className:"text-sm bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 mt-2",onClick:()=>{t&&(a("loading"),setTimeout(()=>{l(y()),a("generated")},1500))},children:"Try Again"})]}),i==="disabled"&&n&&e.jsx("div",{className:"text-sm text-gray-500",children:n})]})},tt=()=>{const t=je();return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-indigo-800",children:"🎯 Patient Evaluation Overview"}),e.jsx("p",{className:"text-gray-700 max-w-3xl",children:"This module guides oncologists through a complete and structured patient evaluation during outpatient visits. It is not an EHR but a clinical decision support tool meant to ensure no critical detail is missed during your assessment."}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-100 space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Key Features"}),e.jsxs("ul",{className:"list-disc list-inside text-gray-700 space-y-1",children:[e.jsx("li",{children:"Structured History Taking: CC, HOPC, PMH, Family & Social History"}),e.jsx("li",{children:"Oncology-Focused Physical Examination & Red Flags"}),e.jsx("li",{children:"Initial Diagnostic Planning and Performance Status"}),e.jsx("li",{children:"Non-EHR format with clinical flexibility"})]}),e.jsx("div",{className:"pt-4",children:e.jsx("button",{onClick:()=>t("/opd/patient-evaluation-form"),className:"bg-indigo-600 hover:bg-indigo-700 text-white text-sm px-5 py-2 rounded-md shadow",children:"🚀 Start Patient Evaluation"})})]})]})},st={id:"breast",name:"Breast Cancer Diagnostic Pathway",description:"Systematic approach to breast cancer diagnosis and staging, aligned with NCCN 2024 and ASCO guidelines.",recommendedTimeframe:"1-2 weeks for diagnosis, 2-4 weeks for full staging and treatment plan",steps:[{id:"initial",title:"Initial Presentation & Clinical Assessment",description:"Patient presents with breast symptoms (e.g., lump, skin changes, nipple discharge) or abnormal screening mammogram. Detailed history (including risk factors like family history, prior breast conditions, hormonal exposures, genetic predisposition) and clinical breast exam (CBE).",expectedDuration:"1-2 days",guidelineSource:"NCCN BC-1 2024, ASCO Guideline on Breast Cancer Diagnosis 2021",evidenceLevel:"I",patientInfo:"Explain the importance of evaluating symptoms/findings. Discuss the next steps, likely diagnostic imaging. Address anxiety and provide reassurance. Offer information on risk factors.",pitfalls:["Dismissing patient concerns, especially in younger women or those with dense breasts.","Incomplete CBE or inadequate documentation.","Delay in scheduling diagnostic imaging for suspicious findings (BI-RADS 0 on screening, palpable mass)."],options:[{text:"Abnormal screening mammogram (e.g., BI-RADS 0, or new BI-RADS 3, 4, 5 finding)",next:"diagnostic_imaging_mammogram_callback"},{text:"Palpable mass, focal persistent pain, suspicious nipple discharge (bloody, unilateral, spontaneous), skin changes (dimpling, erythema, peau d'orange), or axillary adenopathy",next:"diagnostic_imaging_symptomatic",triggers:["suspicious_clinical_finding"]},{text:"Non-suspicious symptoms (e.g., cyclical bilateral pain, non-bloody bilateral discharge), no palpable mass, normal screening history",next:"risk_assessment_reassurance_low_suspicion"},{text:"High risk patient (e.g. known BRCA mutation, strong family history, prior chest RT) for screening/surveillance",next:"high_risk_surveillance_protocol"}],redFlags:[{id:"suspicious_clinical_finding",condition:"Palpable dominant hard mass, peau d'orange, skin ulceration, nipple retraction/inversion (new), fixed axillary nodes, or signs of inflammatory breast cancer (diffuse erythema, edema, warmth).",message:"High suspicion for locally advanced or inflammatory breast cancer. Requires urgent evaluation.",severity:"critical",recommendations:["Urgent diagnostic mammogram (if >30 yrs) and targeted ultrasound within 24-72 hours.","Consider early surgical/breast oncology consultation (same day or next day).","Document detailed findings, including size, location, and characteristics of mass and any skin/nodal changes."],urgency:"Same-day",actionType:"Urgent Imaging & Specialist Consultation"}]},{id:"diagnostic_imaging_mammogram_callback",title:"Diagnostic Mammography & Ultrasound (Screening Callback)",description:"Perform diagnostic mammography (additional views, magnification, tomosynthesis as needed) and targeted breast ultrasound for any abnormality seen on screening mammogram. Correlate with prior imaging.",expectedDuration:"1-3 days",tooltip:"Resolve screening findings. Assign final BI-RADS category.",guidelineSource:"ACR Practice Parameter for Breast Imaging 2023, NCCN BC-2 2024",evidenceLevel:"I",patientInfo:"Explain that additional views are common after screening. Describe procedures. Discuss BI-RADS outcome.",pitfalls:["Not performing ultrasound for all relevant mammographic findings.","Inadequate views leading to missed lesions."],options:[{text:"BI-RADS 4 or 5 (Suspicious or Highly Suspicious)",next:"image_guided_biopsy",triggers:["high_birads_finding"]},{text:"BI-RADS 3 (Probably Benign) - typically short-interval (6-month) follow-up or biopsy based on risk/patient/radiologist preference",next:"birads3_management_protocol"},{text:"BI-RADS 1 or 2 (Negative or Benign) - resolved screening finding",next:"return_to_routine_screening"}],redFlags:[{id:"high_birads_finding",condition:"BI-RADS 4 or 5 lesion identified on diagnostic workup.",message:"High suspicion for malignancy. Tissue diagnosis is required promptly.",severity:"critical",recommendations:["Schedule image-guided core needle biopsy (CNB) within 3-5 business days.","Clearly communicate need for biopsy to patient and referring physician.","Determine optimal biopsy modality (ultrasound-guided preferred if visible, stereotactic for calcs, MRI-guided if only seen on MRI)."],urgency:"Routine",actionType:"Biopsy Scheduling & Communication"}]},{id:"diagnostic_imaging_symptomatic",title:"Diagnostic Mammography & Ultrasound (Symptomatic Patient)",description:"For palpable mass or other symptoms: if age >40, diagnostic mammogram and targeted ultrasound. If age 30-39, ultrasound first, then mammogram if suspicious/inconclusive. If <30, ultrasound first, mammogram rarely needed. Breast MRI for specific indications (e.g., occult primary with axillary mets, extent of disease in dense breasts with known cancer).",expectedDuration:"1-3 days",guidelineSource:"ACR Appropriateness Criteria 2022, NCCN BC-1 & BC-2 2024",evidenceLevel:"I",patientInfo:"Explain imaging based on age/symptoms. Discuss BI-RADS outcome.",pitfalls:["Not using ultrasound as primary modality in young women (<30).","Delaying mammography in symptomatic women >30 if ultrasound appears benign but mass persists."],options:[{text:"BI-RADS 4 or 5 (Suspicious or Highly Suspicious)",next:"image_guided_biopsy",triggers:["high_birads_finding"]},{text:"BI-RADS 3 (Probably Benign)",next:"birads3_management_protocol"},{text:"BI-RADS 1 or 2 (Negative or Benign) but symptoms persist or clinical concern remains",next:"clinical_radiologic_discordance_review"},{text:"BI-RADS 1 or 2 (Negative or Benign), symptoms resolve or concordant benign explanation",next:"routine_followup_if_indicated"}]},{id:"image_guided_biopsy",title:"Image-Guided Core Needle Biopsy (CNB)",description:"Perform CNB of BI-RADS 4/5 lesion(s) using appropriate imaging guidance. Obtain multiple cores (typically 4-6). Place biopsy marker clip. Send tissue for histology, ER/PR/HER2 (for invasive cancer and DCIS). Ki-67 optional but often done. Consider tissue for genomic assays if invasive cancer likely.",expectedDuration:"1-3 days (procedure + initial pathology report)",tooltip:"CNB is standard. Ensure radiologic-pathologic concordance. Document clip placement.",guidelineSource:"NCCN BC-3 2024, ASCO/CAP ER/PR/HER2 Testing Guidelines 2020/2023",evidenceLevel:"I",requiresMDT:!0,patientInfo:"Explain CNB procedure, purpose (diagnosis), risks (bruising, bleeding, infection, pain, rare pneumothorax for deep lesions), benefits. Obtain informed consent. Post-biopsy care.",pitfalls:["Insufficient sample for all required tests (ER/PR/HER2, genomics).","Biopsy of non-representative area or sampling error.","Radiologic-pathologic discordance not identified or addressed.","Marker clip not placed, misplaced, or migrates.","Performing FNA instead of CNB for initial diagnosis of solid mass (FNA insufficient for receptor status or distinguishing in-situ from invasive)."],options:[{text:"Malignancy confirmed (Invasive Carcinoma or Ductal Carcinoma In Situ - DCIS)",next:"post_biopsy_consult_pathology_review",triggers:["breast_cancer_diagnosis_biopsy"]},{text:"High-risk lesion (e.g., Atypical Ductal Hyperplasia (ADH), Lobular Carcinoma In Situ (LCIS), Flat Epithelial Atypia (FEA), Papilloma with atypia)",next:"high_risk_lesion_management_discussion"},{text:"Benign pathology, concordant with imaging findings",next:"benign_concordant_pathology_followup"},{text:"Pathology discordant with imaging, or insufficient for diagnosis (e.g. atypia of undetermined significance - AUS)",next:"discordant_insufficient_pathology_review_repeat_biopsy"}],redFlags:[{id:"breast_cancer_diagnosis_biopsy",condition:"Biopsy confirms invasive breast cancer or DCIS.",message:"Breast cancer diagnosed. Requires prompt communication with patient, staging, and multidisciplinary discussion.",severity:"critical",recommendations:["Pathologist to ensure ER/PR/HER2 (with reflex ISH if HER2 IHC 2+) results are processed promptly.","Schedule follow-up with surgeon/breast specialist within 1 week to discuss results and plan.","Initiate staging workup as indicated by tumor type/size/grade (NCCN BC-4).","Refer for genetic counseling if criteria met (NCCN BC-6).","Prepare for presentation at multidisciplinary tumor board (MDT)."],urgency:"Routine",actionType:"Pathology Processing, Consultation & Staging Initiation"}]},{id:"post_biopsy_consult_pathology_review",title:"Post-Biopsy Consultation, Full Pathology Review & Staging",description:"Consultation to discuss confirmed cancer diagnosis. Review final pathology: histologic type, grade, size (if excisional), ER/PR status, HER2 status (IHC and ISH if done), Ki-67. Clinical staging (TNM) based on exam, imaging, biopsy. Systemic staging (CT C/A/P, bone scan, or PET-CT) for clinical stage IIB (T2N1, T3N0) or higher, or symptomatic patients, or inflammatory BC (NCCN BC-4). Brain MRI if neurological symptoms or specific subtypes (e.g. HER2+, triple negative with high burden).",expectedDuration:"3-7 days for full pathology and initial staging plan",guidelineSource:"NCCN BC-4 & BC-5 2024, AJCC 8th Ed. Breast Cancer Staging",evidenceLevel:"I",requiresMDT:!0,patientInfo:"Provide clear explanation of diagnosis, pathology report (ER/PR/HER2 meaning), and cancer stage. Discuss need for further staging tests. Offer emotional support and resources. Discuss MDT process. Genetic counseling referral if indicated.",pitfalls:["Incomplete or delayed ER/PR/HER2/Ki-67 results.","Under-staging (missing metastases) or over-staging.","Delay in MDT presentation or specialist consultations.","Not offering genetic counseling according to guidelines (e.g., age <50, triple negative, male breast cancer, specific family history - NCCN BC-6)."],options:[{text:"Early stage (Stage I-IIA, selected IIB based on biology) potentially suitable for primary surgery",next:"mdt_treatment_planning_early_stage_breast"},{text:"Locally advanced (some Stage IIB, Stage III) or inflammatory breast cancer - typically requires neoadjuvant therapy",next:"mdt_treatment_planning_locally_advanced_breast"},{text:"Metastatic disease (Stage IV) identified on staging workup",next:"mdt_treatment_planning_metastatic_breast",triggers:["metastatic_breast_cancer_staging"]},{text:"DCIS without invasion",next:"mdt_treatment_planning_dcis"}],redFlags:[{id:"metastatic_breast_cancer_staging",condition:"Metastatic disease (Stage IV) confirmed by staging investigations.",message:"Stage IV breast cancer. Treatment is primarily systemic with palliative intent for most; some oligometastatic cases may have different approaches. Requires urgent multidisciplinary input.",severity:"critical",recommendations:["Urgent medical oncology consultation (within days).","Biopsy of a metastatic site if feasible and not previously done (especially if discordance in receptors suspected or for research protocols).","Early palliative care referral for symptom management, psychosocial support, and goals of care discussion.","Discuss prognosis, treatment goals, and advanced care planning with patient and family.","Consider clinical trials."],urgency:"Same-day",actionType:"Urgent Oncology Referral & Palliative Care Integration"},{id:"inflammatory_breast_cancer_confirmed",condition:"Clinical diagnosis of inflammatory breast cancer (IBC) confirmed or highly suspected post-imaging/biopsy.",message:"IBC is an aggressive form of breast cancer. Requires urgent, coordinated trimodality therapy, starting with neoadjuvant systemic therapy.",severity:"critical",recommendations:["Urgent medical oncology, surgical oncology, and radiation oncology consultations (within days).","Skin punch biopsy if not already done and diagnosis uncertain, to confirm dermal lymphatic invasion.","Complete staging workup immediately (PET-CT highly recommended for IBC).","Do NOT proceed with upfront surgery."],urgency:"Immediate",actionType:"Urgent Multidisciplinary Consultation & Neoadjuvant Planning"}]}]},at={id:"prostate",name:"Prostate Cancer Diagnostic Pathway",description:"Evidence-based approach to prostate cancer diagnosis, risk stratification, and initial staging, aligned with NCCN 2024 and EAU 2024 guidelines.",recommendedTimeframe:"2-4 weeks from suspicion to diagnostic biopsy result; further 2-4 weeks for full staging and MDT discussion if cancer confirmed.",steps:[{id:"initial",title:"Initial Assessment & PSA/DRE Evaluation",description:"Patient presents with elevated Prostate-Specific Antigen (PSA), abnormal Digital Rectal Exam (DRE), strong family history, or known genetic predisposition (e.g., BRCA1/2). Assess urinary symptoms (IPSS score) and rule out benign causes of PSA elevation (UTI, prostatitis, recent ejaculation/instrumentation, catheter).",expectedDuration:"1-2 days",guidelineSource:"NCCN PROS-1 2024, EAU Guidelines on Prostate Cancer 2024",evidenceLevel:"I",patientInfo:"Discuss PSA/DRE findings, the concept of risk stratification, and the diagnostic pathway. Address anxiety. Explain that not all elevated PSAs mean cancer and benign causes need to be excluded.",pitfalls:["Not repeating an initial elevated PSA after addressing potential benign causes.","Ignoring abnormal DRE even with normal PSA.","Failure to consider and rule out UTI or recent ejaculation/instrumentation/catheterization that could transiently elevate PSA before proceeding."],options:[{text:"Elevated PSA (> age-specific range or >4 ng/mL generally, or >3 ng/mL for men with BRCA2 or >40yrs with BRCA1) and/or suspicious DRE (nodule, induration, asymmetry)",next:"psa_confirmation_risk_assessment"},{text:"Strong family history (e.g., 1st degree relative <65yrs, multiple relatives) or known genetic predisposition (BRCA1/2, Lynch Syndrome, HOXB13) - consider earlier screening / lower PSA threshold",next:"psa_confirmation_risk_assessment"},{text:"PSA normal, DRE normal, no significant risk factors",next:"routine_screening_surveillance_prostate"},{text:"Symptoms of UTI/prostatitis present",next:"treat_uti_recheck_psa"}],redFlags:[{id:"prostate_very_high_psa_symptoms",condition:"PSA > 20 ng/mL with new onset significant bone pain, or PSA > 50 ng/mL. Any PSA level with neurological symptoms concerning for spinal cord compression (e.g., new leg weakness, saddle anesthesia, bowel/bladder incontinence).",message:"High suspicion for metastatic disease or locally advanced disease with complications. Requires urgent evaluation and management.",severity:"critical",recommendations:["Urgent urology/oncology consultation (within 24-48 hours).","Immediate bone scan and CT Chest/Abdomen/Pelvis (or PSMA PET-CT if available and indicated for high-risk staging).","If cord compression suspected: urgent MRI spine (same day), neurosurgical/radiation oncology consult, consider immediate high-dose corticosteroids."],urgency:"Immediate",actionType:"Urgent Staging, Specialist Consultation & Symptom Management"}]},{id:"psa_confirmation_risk_assessment",title:"PSA Confirmation, Risk Assessment & Shared Decision-Making",description:"Confirm persistent PSA elevation (repeat test 4-8 weeks after initial, ensuring no interfering factors). Calculate PSA density (PSAD = PSA / prostate volume from TRUS/MRI) and PSA velocity if prior values available. Assess risk factors (age, race, family hx of prostate/breast/ovarian/pancreatic cancer, genetic mutations). Use validated risk calculators (e.g., ERSPC, PCPT, Stockholm3, 4Kscore, SelectMDx, MyProstateScore) to estimate probability of clinically significant cancer. Discuss pros/cons of biopsy.",expectedDuration:"1-2 weeks (allowing for repeat test and calculator use)",tooltip:"PSAD > 0.15 ng/mL/cc is concerning. Risk calculators and biomarkers can help refine biopsy decisions and avoid overdiagnosis.",guidelineSource:"NCCN PROS-2 2024, AUA/SUO Guidelines 2023, EAU Guidelines 2024",evidenceLevel:"II",patientInfo:"Explain rationale for confirming PSA, role of PSAD, risk calculators, and biomarkers in guiding decisions. Discuss the balance between detecting significant cancer and risks of biopsy/overtreatment. Shared decision-making is key.",pitfalls:["Proceeding to biopsy based on a single elevated PSA without confirmation or comprehensive risk assessment.","Not using or misinterpreting risk calculators/biomarkers.","Insufficient discussion of biopsy risks/benefits leading to uninformed patient choice."],options:[{text:"Persistent elevated PSA / high-risk profile on calculators / suspicious DRE / patient preference for diagnostic clarity after discussion",next:"pre_biopsy_prostate_mri"},{text:"PSA normalized or low risk profile after assessment / patient preference against biopsy after discussion",next:"active_monitoring_psa_dre_risk_reassessment"}]},{id:"pre_biopsy_prostate_mri",title:"Pre-biopsy Multiparametric Prostate MRI (mpMRI)",description:"Perform high-quality mpMRI (3T preferred) prior to initial biopsy if available and PSA/risk warrants. Report using PI-RADS v2.1. For patients with prior negative biopsy but ongoing suspicion, mpMRI is also strongly recommended.",expectedDuration:"1-2 weeks (scheduling and reporting)",tooltip:"mpMRI improves detection of clinically significant (Grade Group >=2) prostate cancer and can guide targeted biopsies, potentially reducing detection of insignificant cancers.",guidelineSource:"NCCN PROS-3 2024, EAU Guidelines 2024, PRECISION Trial, MRI-FIRST Trial",evidenceLevel:"I",patientInfo:"Explain mpMRI procedure, its benefits in identifying suspicious areas for targeted biopsy, and how results (PI-RADS score) will inform the biopsy plan. Mention it may help avoid biopsy if no suspicious lesions are found in some low-risk men.",pitfalls:["Poor quality mpMRI scan or inexperienced interpretation leading to false positives/negatives.","Not performing MRI before biopsy if indicated and available, leading to potentially missed targets.","Over-reliance on PI-RADS 3 lesions without considering other risk factors (PSAD is critical for PI-RADS 3)."],options:[{text:"PI-RADS 4 or 5 lesion (High or Very High suspicion)",next:"mri_targeted_plus_systematic_biopsy",triggers:["prostate_high_pirads"]},{text:"PI-RADS 3 lesion (Equivocal) - decision to biopsy based on PSAD, risk profile, biomarkers, patient preference",next:"pirads3_lesion_management_discussion"},{text:"PI-RADS 1 or 2 lesion (Low or Very Low suspicion) AND low overall clinical risk (e.g. low PSAD)",next:"continue_monitoring_consider_no_biopsy"},{text:"PI-RADS 1 or 2 lesion BUT high clinical risk (e.g. high PSAD, strong family hx) or patient preference",next:"systematic_biopsy_consider_no_target"},{text:"No mpMRI performed or available, but clinical suspicion remains high enough to warrant biopsy",next:"systematic_prostate_biopsy_only"}],redFlags:[{id:"prostate_high_pirads",condition:"PI-RADS 4 or 5 lesion identified on mpMRI.",message:"High or very high suspicion for clinically significant prostate cancer. MRI-targeted biopsy of the lesion plus systematic biopsies are strongly recommended.",severity:"critical",recommendations:["Schedule MRI-guided or MRI-ultrasound fusion targeted biopsy of the index lesion(s) + standard systematic template biopsies (typically 10-12 cores) within 2-3 weeks.","Discuss findings and biopsy plan clearly with the patient."],urgency:"Routine",actionType:"Targeted & Systematic Biopsy Scheduling"},{id:"prostate_extracapsular_extension_mri",condition:"Clear evidence of extracapsular extension (ECE), seminal vesicle invasion (SVI), or direct bladder/rectal invasion on mpMRI.",message:"Findings suggest locally advanced disease (at least T3). This is critical for staging and impacts treatment planning significantly. Biopsy should confirm.",severity:"warning",recommendations:["Ensure biopsy plan adequately samples areas near suspected ECE/SVI if safe and feasible.","Flag for urology/MDT discussion regarding neoadjuvant approaches or more extensive surgical planning if cancer is confirmed and resectable.","Consider PSMA PET-CT for staging if high-risk features are present on MRI, once cancer confirmed."],urgency:"Routine",actionType:"Biopsy Planning Adjustment & MDT Alert for Advanced Disease Features"}]},{id:"mri_targeted_plus_systematic_biopsy",title:"MRI-Targeted and Systematic Prostate Biopsy",description:"Perform MRI-targeted biopsies (cognitive, software fusion, or in-bore) of PI-RADS 3-5 lesions (typically 2-4 cores per target), PLUS systematic template biopsies (e.g., 10-12 cores, transrectal or transperineal approach). Prophylactic antibiotics tailored to local resistance patterns. Consider periprostatic block for pain.",expectedDuration:"1-3 days (procedure + initial pathology report)",tooltip:"Combination of targeted and systematic biopsy maximizes detection of clinically significant cancer. Transperineal approach has lower infection risk. Discuss risks: bleeding, infection (sepsis is rare but serious), pain, hematuria, hematospermia, temporary urinary retention.",guidelineSource:"NCCN PROS-4 2024, AUA/SUO Guidelines 2023, EAU Guidelines 2024",evidenceLevel:"I",requiresMDT:!0,patientInfo:"Explain the biopsy procedure (targeted + systematic), chosen approach (transrectal vs transperineal), specific risks, and post-procedure care (e.g., antibiotic completion, signs of infection). Obtain informed consent.",pitfalls:["Targeting error during fusion biopsy leading to false negative in targeted cores.","Insufficient cores from targeted or systematic component.","Post-biopsy infection/sepsis, especially with TRUS biopsy if prophylaxis is inadequate or resistance occurs.","Underestimation of cancer grade/volume if sampling is suboptimal."],options:[{text:"Prostate cancer confirmed (Gleason score and Grade Group available)",next:"pathology_review_risk_stratification_mdt",triggers:["prostate_cancer_confirmed_biopsy"]},{text:"Biopsy negative for cancer, despite suspicious MRI/PSA (MRI-pathology discordance)",next:"negative_biopsy_discordant_high_suspicion_review"},{text:"Atypical findings (e.g., ASAP - Atypical Small Acinar Proliferation) or HGPIN (High-Grade Prostatic Intraepithelial Neoplasia)",next:"atypical_hgpin_biopsy_management"},{text:"Clinically insignificant cancer found (e.g., very low volume Gleason 3+3=6), concordant with low risk MRI/profile",next:"discussion_active_surveillance_low_risk"}],redFlags:[{id:"prostate_cancer_confirmed_biopsy",condition:"Prostate cancer (adenocarcinoma) confirmed on biopsy.",message:"Histological confirmation of prostate cancer. Proceed to detailed risk stratification, staging, and multidisciplinary discussion.",severity:"critical",recommendations:["Ensure full pathology report includes Gleason score, ISUP Grade Group, number of positive cores, percentage of core involvement for each positive core, presence of intraductal carcinoma (IDC-P), perineural invasion (PNI).","Schedule for risk stratification using NCCN or EAU criteria and staging investigations as indicated (NCCN PROS-5).","Arrange urology/oncology consultation to discuss results and comprehensive treatment options."],urgency:"Routine",actionType:"Detailed Pathology Review, Risk Stratification & Staging Initiation"}]},{id:"pathology_review_risk_stratification_mdt",title:"Pathology Review, Risk Stratification, Staging & MDT Discussion",description:"Detailed review of biopsy pathology. Risk stratify using NCCN criteria (Very Low to Very High Risk) or EAU risk groups (Low, Intermediate, High). Staging investigations: Bone scan and CT Abdomen/Pelvis for unfavorable intermediate-risk with >cT2b or GG >2, or high-risk localized. PSMA PET-CT (if available) is preferred over conventional imaging for initial staging of unfavorable intermediate, high, and very high-risk disease, or any suspected metastatic disease (NCCN PROS-5, EAU 2024). Discuss germline (for all high/very high risk, metastatic, +ve family hx, IDC-P) and somatic testing (for metastatic/recurrent, or regional considering treatment implications). Present at MDT.",expectedDuration:"1-2 weeks (for staging and MDT)",guidelineSource:"NCCN PROS-5, PROS-6, PROS-7 2024, AJCC 8th Ed., EAU Guidelines 2024",evidenceLevel:"I",requiresMDT:!0,patientInfo:"Explain Gleason score, Grade Group, full risk category, and implications for treatment options/prognosis. Discuss need and type of staging scans. Explain genetic testing rationale if indicated. Describe MDT role in recommending optimal treatment.",pitfalls:["Incorrect Gleason grading or incomplete pathology reporting.","Under-staging due to inappropriate imaging modality or missed metastatic disease.","Not offering germline/somatic testing as per evolving guidelines, missing actionable mutations.","Delay in MDT discussion impacting timely treatment initiation for aggressive cancers."],options:[{text:"Localized disease: Very Low, Low, or Favorable Intermediate Risk (NCCN)",next:"treatment_options_discussion_low_favorable_intermediate_risk_prostate"},{text:"Localized disease: Unfavorable Intermediate, High, or Very High Risk (NCCN)",next:"treatment_options_discussion_unfavorable_intermediate_high_risk_prostate"},{text:"Regional lymph node involvement (N1) identified on staging",next:"treatment_planning_n1_prostate_cancer",triggers:["prostate_n1_disease_staging"]},{text:"Metastatic (M1) disease identified on staging",next:"treatment_planning_m1_prostate_cancer",triggers:["prostate_m1_disease_staging"]}],redFlags:[{id:"prostate_n1_disease_staging",condition:"Regional lymph node (N1) disease confirmed on staging investigations.",message:"Pelvic lymph node positive (N1) prostate cancer. Treatment typically involves multimodal therapy.",severity:"critical",recommendations:["Medical oncology / Urologic oncology / Radiation oncology consultation for multimodal therapy planning (e.g., EBRT + ADT, possibly with abiraterone; or radical prostatectomy + ePLND followed by adjuvant/salvage therapy).","Ensure comprehensive somatic/germline testing.","Discuss prognosis, goals of care, and clinical trial options."],urgency:"Routine",actionType:"Multidisciplinary Consultation for N1 Disease"},{id:"prostate_m1_disease_staging",condition:"Metastatic (M1) disease confirmed on staging investigations (bone, distant lymph nodes, visceral).",message:"Metastatic prostate cancer. Systemic therapy is the cornerstone of management. Assess for oligometastatic vs widespread disease.",severity:"critical",recommendations:["Urgent medical oncology/urologic oncology consultation.","Initiate Androgen Deprivation Therapy (ADT) promptly. Consider combination therapy (e.g., ADT + ARPI, ADT + docetaxel, or triplet therapy for high volume/de novo metastatic HSPC).","Ensure comprehensive somatic/germline testing (e.g. BRCA, HRR mutations, MSI/dMMR).","Discuss prognosis, goals of care, palliative care involvement, and clinical trial options.","Address bone health (calcium, Vit D, bone protective agents)."],urgency:"Same-day",actionType:"Urgent Oncology Consultation & Systemic Therapy Initiation for M1 Disease"}]}]},nt={id:"lung",name:"Lung Cancer Diagnostic Pathway",description:"Systematic approach to lung cancer evaluation and staging, compliant with NCCN 2024 and ESMO 2023 guidelines.",recommendedTimeframe:"2-3 weeks",steps:[{id:"initial",title:"Initial Presentation & Risk Assessment",description:"Patient presents with symptoms (e.g., persistent cough, dyspnea, hemoptysis) or incidental imaging finding concerning for lung cancer. Assess risk factors (smoking history, family history, occupational exposure).",expectedDuration:"1-2 days",guidelineSource:"NCCN LU-1 2024",evidenceLevel:"I",patientInfo:"Discuss the importance of evaluating symptoms and the plan for initial imaging if indicated. Counsel on smoking cessation.",pitfalls:["Dismissing symptoms as benign without investigation in high-risk patients.","Delay in ordering initial imaging."],options:[{text:"Suspicious chest imaging findings (e.g., nodule >8mm)",next:"imaging",triggers:["suspicious_imaging"]},{text:"Symptoms suggestive of lung cancer (e.g., hemoptysis, new persistent cough >3 weeks)",next:"symptoms",triggers:["concerning_symptoms"]}],redFlags:[{id:"suspicious_imaging",condition:"Suspicious chest imaging (e.g., solid nodule >8mm, part-solid nodule, GGO with solid component)",message:"Imaging findings concerning for malignancy. Refer to NCCN LU-2 for nodule management.",severity:"critical",recommendations:["Expedite dedicated CT chest with contrast (unless contraindicated).","Early pulmonology/thoracic surgery consultation within 1 week.","Review smoking history and occupational exposures in detail."],urgency:"Same-day",actionType:"Referral and Imaging"},{id:"concerning_symptoms",condition:"High-risk symptoms (e.g., hemoptysis, unexplained weight loss, new hoarseness)",message:"Symptoms concerning for lung cancer warrant prompt investigation.",severity:"warning",recommendations:["Chest imaging (CXR or CT) within 1 week as per NICE NG12.","Document duration, severity, and progression of symptoms.","Assess for other red flag symptoms (e.g., superior vena cava syndrome)."],urgency:"Routine",actionType:"Investigation"}]},{id:"imaging",title:"Diagnostic Imaging Studies",description:"Perform high-quality CT chest with IV contrast to characterize lesion(s) and assess for mediastinal/hilar adenopathy and distant metastases. PET-CT for staging if appropriate (NCCN LU-3).",expectedDuration:"3-5 days",tooltip:"CT features: size, morphology (solid, subsolid), spiculation, pleural retraction. PET-CT for FDG-avidity. Ensure renal function adequate for contrast.",guidelineSource:"NCCN LU-3 2024, ESMO LG-2023",evidenceLevel:"I",patientInfo:"Explain the purpose of CT/PET-CT, what to expect during the scan, and potential findings. Discuss contrast allergy risks.",pitfalls:["Inadequate CT slice thickness for small nodule characterization.","Misinterpretation of inflammatory vs. malignant FDG uptake on PET.","Not performing PET-CT prior to invasive staging in potentially resectable disease."],options:[{text:"Definitive lesion on CT Chest requiring characterization",next:"characterize",triggers:["significant_findings"]},{text:"Suspected Stage III/IV or indeterminate findings, proceed to PET/CT",next:"staging",triggers:["metastatic_suspicion"]}],redFlags:[{id:"significant_findings",condition:"CT findings highly suspicious for malignancy (e.g., spiculated mass, large nodule with growth)",message:"Features highly suspicious for malignancy. Requires tissue diagnosis.",severity:"critical",recommendations:["Expedite tissue diagnosis (biopsy/bronchoscopy).","Consider PET/CT for staging if not already done (NCCN LU-4).","Early thoracic MDT discussion planning (within 1-2 weeks)."],urgency:"Same-day",actionType:"Biopsy and Staging"},{id:"metastatic_suspicion",condition:"Suspected metastatic disease on CT or PET-CT (e.g., adrenal, liver, bone lesions)",message:"Features concerning for advanced/metastatic disease. Biopsy of metastatic site may be preferred.",severity:"critical",recommendations:["Complete staging workup (e.g., brain MRI).","Early medical oncology consultation.","Plan for molecular testing on diagnostic tissue (NCCN LU-5)."],urgency:"Same-day",actionType:"Referral and Staging"}]},{id:"characterize",title:"Lesion Characterization & Biopsy Planning",description:"Determine optimal biopsy strategy based on lesion location, size, and patient fitness. Peripheral lesions often amenable to CT-guided biopsy; central lesions may require bronchoscopy (EBUS/Navigational).",expectedDuration:"1-2 days",guidelineSource:"ACCP Lung Cancer Guidelines 2013, BTS 2023",evidenceLevel:"I",requiresMDT:!0,patientInfo:"Discuss biopsy options, risks (pneumothorax, bleeding), benefits, and alternatives. Obtain informed consent.",pitfalls:["Choosing a suboptimal biopsy technique leading to non-diagnostic sample.","Delay in biopsy scheduling.","Not obtaining sufficient tissue for molecular testing."],options:[{text:"Peripheral lesion accessible to percutaneous biopsy",next:"biopsy"},{text:"Central lesion or mediastinal nodes requiring bronchoscopy/EBUS",next:"bronchoscopy"}]},{id:"biopsy",title:"Tissue Biopsy (Percutaneous)",description:"Perform image-guided (typically CT) core needle biopsy for peripheral lung lesions. Ensure adequate sample for histology and molecular testing (NCCN LU-5).",expectedDuration:"2-5 days",tooltip:"Core biopsy preferred over FNA for architectural assessment and molecular studies. Risks: pneumothorax (15-25%), bleeding. Post-procedure CXR.",guidelineSource:"NCCN LU-4 2024",evidenceLevel:"I",requiresMDT:!0,patientInfo:"Discuss risks (pneumothorax, bleeding, pain) and benefits of CT-guided biopsy. Obtain informed consent. Provide post-procedure instructions.",pitfalls:["Non-diagnostic sample due to poor targeting or insufficient tissue.","Delay in pathology reporting.","Not sending tissue for molecular markers if adenocarcinoma suspected."],options:[{text:"Malignancy confirmed (e.g., NSCLC, SCLC)",next:"staging_post_biopsy"},{text:"Non-diagnostic or benign pathology",next:"mdt_review_indeterminate"}]},{id:"bronchoscopy",title:"Bronchoscopy & Endobronchial Ultrasound (EBUS)",description:"For central lesions or mediastinal/hilar lymph node staging. EBUS-TBNA for lymph node sampling. Navigational bronchoscopy for peripheral lesions not suitable for CT-biopsy.",expectedDuration:"2-5 days",tooltip:"EBUS-TBNA is crucial for mediastinal staging (NCCN LU-4). Risks: bleeding, infection, pneumothorax (rare).",guidelineSource:"NCCN LU-4 2024, ERS/ESTS Guidelines",evidenceLevel:"I",requiresMDT:!0,patientInfo:"Explain procedure, sedation, potential discomfort, and risks. Obtain informed consent. NPO instructions.",pitfalls:["Inadequate nodal staging if EBUS not performed systematically.","Complications in patients with severe COPD.","Insufficient material from FNA for all molecular tests."],options:[{text:"Malignancy confirmed, staging complete or needs PET",next:"staging_post_biopsy"},{text:"Non-diagnostic or benign pathology",next:"mdt_review_indeterminate"}]},{id:"staging_post_biopsy",title:"Post-Biopsy Staging & MDT Review",description:"Integrate histological diagnosis with PET-CT and other imaging (e.g., Brain MRI for NSCLC as per NCCN LU-6) to establish definitive TNM stage. All cases to be discussed at MDT.",expectedDuration:"5-7 days",guidelineSource:"NCCN LU-6/LU-7 2024",evidenceLevel:"I",requiresMDT:!0,patientInfo:"Explain the staging results and their implications for treatment options. Outline the role of the MDT.",pitfalls:["Incomplete staging (e.g., omitting brain MRI in non-metastatic NSCLC).","Delay in MDT discussion.","Not performing molecular testing for NSCLC adenocarcinoma (EGFR, ALK, ROS1, BRAF, PD-L1 etc. - NCCN LU-5)."],options:[{text:"Localized disease (Stage I-II, selected III)",next:"treatment_planning_curative"},{text:"Locally advanced disease (Stage III)",next:"treatment_planning_multimodal"},{text:"Metastatic disease (Stage IV)",next:"palliative",triggers:["metastatic_confirmed"]}],redFlags:[{id:"metastatic_confirmed",condition:"Confirmed metastatic disease (Stage IV)",message:"Stage IV disease identified. Focus on systemic therapy and palliative care.",severity:"critical",recommendations:["Urgent medical oncology consultation (within 1 week).","Ensure comprehensive molecular testing is performed/pending (NCCN LU-9).","Early palliative care involvement for symptom management and goals of care discussion.","Discuss prognosis and treatment goals with patient and family."],urgency:"Same-day",actionType:"Referral and Systemic Therapy Planning"}]}]},rt={id:"ovarian",name:"Ovarian Cancer Diagnostic Pathway",description:"Evidence-based approach to ovarian cancer diagnosis and staging, aligned with NCCN 2024, ESGO-ESTRO-ESP 2023, and SGO guidelines.",recommendedTimeframe:"1-2 weeks for diagnosis; 2-4 weeks for full staging and surgical planning.",steps:[{id:"initial",title:"Initial Assessment & Symptom Evaluation",description:"Patient presents with symptoms (e.g., bloating, pelvic/abdominal pain, early satiety, urinary urgency/frequency - often persistent and new-onset) or incidental adnexal mass on imaging. Detailed history, including family history of ovarian/breast cancer (BRCA).",expectedDuration:"1-2 days",guidelineSource:"NCCN OV-1 2024, ACOG Committee Opinion No. 716",evidenceLevel:"I",patientInfo:"Explain that symptoms can be vague and the importance of thorough evaluation. Discuss family history and potential genetic predisposition. Address anxiety.",pitfalls:["Dismissing vague symptoms as benign, especially in premenopausal women.","Not taking a detailed family history.","Delay in referral to gynecologic oncology for suspicious findings."],options:[{text:"Suspicious pelvic mass on prior imaging or exam, or persistent concerning symptoms",next:"pelvic_exam_ultrasound"},{text:"Incidental adnexal finding, low suspicion symptoms",next:"initial_workup_low_risk"}],redFlags:[{id:"acute_symptoms_high_risk",condition:"Acute abdominal/pelvic pain with adnexal mass, signs of torsion, rupture, or bowel obstruction.",message:"Potential oncologic emergency or acute gynecologic condition. Requires urgent evaluation.",severity:"critical",recommendations:["Urgent gynecologic/surgical consultation (within 24 hours).","Immediate imaging (pelvic ultrasound, CT if indicated).","Assess for hemodynamic instability."],urgency:"Immediate",actionType:"Urgent Specialist Consultation & Imaging"}]},{id:"pelvic_exam_ultrasound",title:"Pelvic Examination & Transvaginal Ultrasound (TVUS)",description:"Perform comprehensive pelvic examination (bimanual and rectovaginal). Perform TVUS to characterize adnexal mass(es) - size, morphology (solid components, septations, papillary projections, laterality), and assess for ascites/peritoneal disease. Use IOTA ADNEX model or RMI if available.",expectedDuration:"1 day",tooltip:"Document mass characteristics meticulously. TVUS is the primary imaging modality. Consider CA-125 concurrently.",guidelineSource:"NCCN OV-1 2024, ISUOG Consensus Statement 2017",evidenceLevel:"I",calculatorId:"IOTA_ADNEX_model",patientInfo:"Explain the pelvic exam and TVUS procedure. Discuss how ultrasound helps characterize the mass. Reassure patient during exam.",pitfalls:["Incomplete pelvic exam.","Suboptimal ultrasound technique or interpretation.","Not recognizing high-risk ultrasound features."],options:[{text:"High suspicion of malignancy on exam/TVUS (e.g., solid/complex mass, ascites, peritoneal nodules, IOTA ADNEX high risk)",next:"tumor_markers_ct_staging",triggers:["suspicious_mass_imaging"]},{text:"Indeterminate findings on TVUS",next:"tumor_markers_ct_staging"},{text:"Clearly benign simple cyst on TVUS (e.g., <10cm, unilocular, anechoic)",next:"benign_cyst_management"}],redFlags:[{id:"suspicious_mass_imaging",condition:"Adnexal mass with ultrasound features suspicious for malignancy (e.g., solid component, papillary projections, ascites, high vascularity).",message:"Findings highly concerning for ovarian malignancy. Requires prompt referral to Gynecologic Oncologist.",severity:"critical",recommendations:["Refer to Gynecologic Oncologist within 1 week (NCCN OV-2).","Obtain CA-125, HE4 (if available, for ROMA score), and other markers (CEA, CA19-9, AFP, hCG, LDH if suspicious for non-epithelial tumor).","Proceed to CT Chest/Abdomen/Pelvis with contrast for staging."],urgency:"Same-day",actionType:"Referral & Staging Workup"}]},{id:"tumor_markers_ct_staging",title:"Tumor Markers & CT Staging",description:"Measure serum CA-125. In premenopausal women with complex mass, also consider AFP, hCG, LDH. For postmenopausal women with adnexal mass, CA-125 and HE4 (for ROMA score) can aid risk assessment. Perform CT Chest/Abdomen/Pelvis with contrast for staging (assess peritoneal carcinomatosis, lymphadenopathy, distant mets).",expectedDuration:"3-5 days",tooltip:"CA-125 can be elevated in benign conditions. Interpret with imaging. CT helps determine resectability and guides surgical planning.",guidelineSource:"NCCN OV-1 & OV-2 2024, SGO Guidelines",evidenceLevel:"I",calculatorId:"ROMA_score",patientInfo:"Explain blood tests for tumor markers and CT scan for staging. Discuss that CA-125 is not diagnostic alone but part of overall assessment.",pitfalls:["Relying solely on CA-125 for diagnosis.","Not ordering appropriate markers for suspected germ cell or stromal tumors in younger patients.","Inadequate CT protocol or interpretation for peritoneal disease."],options:[{text:"High suspicion based on imaging, elevated markers (e.g., CA-125 >200 U/mL in postmenopausal, or high ROMA/ADNEX score), and/or CT findings of metastatic disease",next:"gyn_onc_consult_surgical_planning",triggers:["confirmed_high_risk_oc"]},{text:"Indeterminate findings, further assessment needed (e.g. MRI Pelvis, GI consult if primary GI cancer suspected)",next:"mdt_review_further_investigation"}],redFlags:[{id:"confirmed_high_risk_oc",condition:"Combination of suspicious imaging, significantly elevated tumor markers, and/or CT evidence of advanced disease.",message:"High probability of ovarian cancer. Management by Gynecologic Oncologist is mandatory.",severity:"critical",recommendations:["Ensure Gynecologic Oncologist is leading management.","Discuss goals of care, including fertility preservation if applicable and feasible.","Plan for surgical staging/debulking or neoadjuvant chemotherapy based on resectability assessment (NCCN OV-3/OV-4).","Offer genetic counseling (BRCA, Lynch syndrome) - NCCN OV-1."],urgency:"Routine",actionType:"Definitive Management Planning"},{id:"bowel_ureteric_obstruction",condition:"Evidence of bowel or ureteric obstruction on CT scan.",message:"Significant complication requiring urgent intervention or planning.",severity:"critical",recommendations:["Urgent surgical/urologic/GI consultation as appropriate.","Consider stenting or diversion if symptomatic or impending renal failure.","Incorporate into overall surgical/treatment plan."],urgency:"Same-day",actionType:"Intervention & Specialist Consultation"}]},{id:"gyn_onc_consult_surgical_planning",title:"Gynecologic Oncology Consultation & Surgical/Treatment Planning",description:"Comprehensive consultation with Gynecologic Oncologist. Review all data, discuss prognosis, treatment options (primary debulking surgery (PDS) vs. neoadjuvant chemotherapy (NACT) followed by interval debulking surgery). Biopsy may be obtained via laparoscopy or image-guided if PDS not planned initially or diagnosis uncertain.",expectedDuration:"3-7 days",guidelineSource:"NCCN OV-3 & OV-4 2024, ESGO Guidelines",evidenceLevel:"I",requiresMDT:!0,patientInfo:"Detailed discussion of diagnosis, stage, treatment goals (curative/palliative), surgical procedures (TAH-BSO, omentectomy, lymphadenectomy, peritonectomy), chemotherapy, side effects, and expected recovery. Importance of MDT input. Clinical trial options.",pitfalls:["Inadequate preoperative assessment of resectability leading to suboptimal surgery.","Delay in starting NACT for unresectable disease.","Not performing germline/somatic BRCA testing and HRD testing on tumor tissue (NCCN OV-5)."],options:[{text:"Proceed with Primary Debulking Surgery (PDS)",next:"primary_debulking_surgery"},{text:"Candidate for Neoadjuvant Chemotherapy (NACT) due to extensive disease or comorbidities",next:"neoadjuvant_chemotherapy_planning"},{text:"Diagnosis uncertain or requires tissue confirmation before major surgery/NACT",next:"diagnostic_laparoscopy_biopsy"}]}]},ot={id:"gastric",name:"Gastric Cancer Diagnostic Pathway",description:"Systematic approach to gastric cancer diagnosis and staging, aligned with NCCN 2024, ESMO 2023, and Japanese Gastric Cancer Association (JGCA) guidelines.",recommendedTimeframe:"1-2 weeks for endoscopy and biopsy results; 2-3 weeks for full staging and MDT discussion if cancer confirmed.",steps:[{id:"initial",title:"Initial Assessment & Symptom Evaluation",description:"Patient presents with dyspepsia, epigastric pain, weight loss, dysphagia, early satiety, or signs of GI bleeding (melena, hematemesis). Assess for alarm features (NCCN GC-1). Evaluate H. pylori risk factors.",expectedDuration:"1-2 days",guidelineSource:"NCCN GC-1 2024, ESMO Clinical Practice Guidelines 2023",evidenceLevel:"I",patientInfo:"Explain the importance of evaluating persistent GI symptoms. Discuss alarm features and the need for endoscopy if present. Address anxiety.",pitfalls:["Attributing symptoms to GERD without investigating further in at-risk patients.","Delaying endoscopy in patients with alarm features.","Not considering H. pylori testing in dyspeptic patients without alarm features (age <60)."],options:[{text:"Alarm features present (e.g., weight loss, dysphagia, persistent vomiting, GI bleed, palpable mass, iron deficiency anemia) OR age >60 with new onset dyspepsia (NCCN GC-1)",next:"urgent_endoscopy_biopsy",triggers:["alarm_symptoms_gc"]},{text:"No alarm features, age <60: Test for H. pylori (urea breath test or stool antigen). If positive, treat.",next:"hp_testing_management"},{text:"No alarm features, H. pylori negative or treated but symptoms persist >4-8 weeks",next:"endoscopy_biopsy_non_urgent"}],redFlags:[{id:"alarm_symptoms_gc",condition:"Presence of alarm features (e.g., significant weight loss, progressive dysphagia, overt GI bleeding, palpable mass).",message:"High suspicion for malignancy. Requires prompt endoscopic evaluation.",severity:"critical",recommendations:["Schedule upper GI endoscopy (EGD) within 2 weeks (NCCN GC-1).","Obtain CBC, iron studies, LFTs, albumin.","If active severe bleeding, manage as GI emergency (see GI Bleed Pathway)."],urgency:"Routine",actionType:"Endoscopy Scheduling & Lab Workup"}]},{id:"urgent_endoscopy_biopsy",title:"Upper GI Endoscopy (EGD) & Biopsy",description:"Perform EGD with high-definition white light and chromoendoscopy/NBI if available. Document lesion morphology (Paris classification), location, and extent. Obtain multiple biopsies (at least 6-8) from suspicious lesions for histology. Biopsy normal-appearing mucosa if linitis plastica suspected.",expectedDuration:"1-3 days (procedure to initial findings)",tooltip:"Systematic biopsy protocol is crucial. Photograph lesions. Consider EUS at same session if deep invasion suspected and expertise available.",guidelineSource:"NCCN GC-1 2024, ESGE Guideline 2022",evidenceLevel:"I",patientInfo:"Explain EGD procedure, sedation, risks (bleeding, perforation, aspiration), and purpose of biopsies. Obtain informed consent.",pitfalls:["Insufficient number or quality of biopsies.","Missing early or flat lesions.","Not documenting precise location for surgical planning.","Failure to biopsy suspicious regional nodes if seen on EUS."],options:[{text:"Gastric malignancy suspected/confirmed on EGD/biopsy (adenocarcinoma, lymphoma, GIST, NET)",next:"pathology_review_molecular_testing",triggers:["gastric_cancer_diagnosis"]},{text:"High-grade dysplasia found",next:"hgd_management"},{text:"Benign findings (e.g., gastritis, ulcer) or low-grade dysplasia",next:"benign_lgd_management"},{text:"Non-diagnostic EGD/biopsy but high clinical suspicion persists",next:"repeat_egd_alternative_imaging"}],redFlags:[{id:"gastric_cancer_diagnosis",condition:"Histopathological confirmation of gastric malignancy.",message:"Gastric cancer diagnosed. Proceed with comprehensive staging and MDT discussion.",severity:"critical",recommendations:["Ensure pathology report includes histologic type, grade, Lauren classification (intestinal/diffuse/mixed), HER2 IHC, PD-L1 CPS, and MSI status (NCCN GC-2).","Schedule staging CT Chest/Abdomen/Pelvis with oral and IV contrast.","Refer to multidisciplinary team (surgeon, medical oncologist, radiation oncologist, pathologist, radiologist)."],urgency:"Routine",actionType:"Staging & MDT Referral"},{id:"linitis_plastica_suspicion",condition:"Endoscopic suspicion of linitis plastica (diffusely infiltrated, rigid stomach wall).",message:"High suspicion for aggressive diffuse-type adenocarcinoma. Often underdiagnosed on biopsy.",severity:"critical",recommendations:["Take multiple deep biopsies or jumbo biopsies from different areas.","Consider EUS with FNA of thickened wall.","CT scan may show characteristic wall thickening. PET-CT can be helpful.","Early surgical consultation is critical due to poor prognosis."],urgency:"Same-day",actionType:"Enhanced Biopsy & Imaging, Urgent Consult"}]},{id:"pathology_review_molecular_testing",title:"Pathology Review & Molecular Testing",description:"Confirm histologic type (adenocarcinoma most common). For adenocarcinoma: assess grade, Lauren classification. Perform HER2 IHC (reflex FISH if IHC 2+). Test for MSI (IHC or PCR) and PD-L1 (CPS score, e.g., 22C3 or 28-8 pharmDx). Consider NTRK fusion testing for advanced disease.",expectedDuration:"5-10 days (for full molecular results)",tooltip:"Molecular testing is crucial for guiding systemic therapy in advanced/metastatic disease. Ensure adequate tissue for all tests.",guidelineSource:"NCCN GC-2 & GC-F 2024, CAP Guideline 2022",evidenceLevel:"I",requiresMDT:!0,patientInfo:"Explain that detailed tumor analysis helps determine the best treatment options, including targeted therapies or immunotherapy.",pitfalls:["Insufficient tissue for all molecular tests.","Delay in obtaining molecular results impacting treatment decisions.","Misinterpretation of HER2 or PD-L1 scoring."],options:[{text:"Pathology and molecular results available",next:"staging_workup_gastric"}]},{id:"staging_workup_gastric",title:"Comprehensive Staging Workup",description:"CT Chest/Abdomen/Pelvis with oral and IV contrast. EUS for T and N staging of non-metastatic disease (NCCN GC-3). PET-CT if potentially resectable M0 disease to rule out occult mets (especially for GEJ or bulky tumors) or if CT equivocal. Diagnostic laparoscopy with peritoneal washings for all potentially resectable (cT1b or higher) gastric cancers before neoadjuvant/adjuvant therapy or surgery (NCCN GC-3). Assess nutritional status (albumin, prealbumin, weight loss %).",expectedDuration:"1-2 weeks",guidelineSource:"NCCN GC-3 & GC-4 2024, ESMO Guidelines 2023",evidenceLevel:"I",requiresMDT:!0,patientInfo:"Explain the purpose of each staging test (CT, EUS, PET, laparoscopy) in determining the extent of cancer and guiding treatment. Discuss nutritional support if needed.",pitfalls:["Omitting diagnostic laparoscopy for potentially resectable cases, leading to unexpected positive cytology or peritoneal mets at surgery.","Underutilization of EUS for local staging.","Not addressing malnutrition preoperatively."],options:[{text:"Resectable disease (cT1-T4a, N0-N3, M0, no positive cytology) - candidate for perioperative/neoadjuvant therapy or upfront surgery based on stage/MDT",next:"mdt_treatment_planning_resectable"},{text:"Unresectable locally advanced disease (T4b, bulky N3, encasement of major vessels) OR Oligometastatic disease potentially convertible",next:"mdt_treatment_planning_unresectable_locally_advanced"},{text:"Widely metastatic disease (M1) or positive peritoneal cytology",next:"mdt_treatment_planning_metastatic",triggers:["metastatic_gastric_cancer"]}],redFlags:[{id:"metastatic_gastric_cancer",condition:"Metastatic disease (M1) confirmed by imaging or positive peritoneal cytology.",message:"Stage IV gastric cancer. Treatment is primarily systemic with palliative intent.",severity:"critical",recommendations:["Medical oncology consultation for systemic therapy (chemotherapy +/- HER2-targeted therapy +/- immunotherapy based on biomarkers).","Early palliative care referral for symptom management and goals of care discussion.","Nutritional support, management of ascites/obstruction as needed.","Consider clinical trials."],urgency:"Same-day",actionType:"Systemic Therapy Planning & Supportive Care"}]}]},lt={id:"head_neck",name:"Head & Neck Cancer Diagnostic Pathway",description:"Structured approach to head and neck cancer diagnosis, staging, and initial management, aligned with NCCN 2024 and ESMO 2023 guidelines.",recommendedTimeframe:"1-2 weeks for diagnosis; 2-3 weeks for full staging and MDT discussion.",steps:[{id:"initial",title:"Initial Presentation & Symptom Assessment",description:"Patient presents with symptoms such as persistent sore throat, dysphagia, odynophagia, hoarseness, neck mass, oral lesion, unexplained otalgia, or cranial neuropathies. Assess risk factors (tobacco, alcohol, HPV).",expectedDuration:"1-2 days",guidelineSource:"NCCN HN-1 2024, ESMO H&N Guidelines 2023",evidenceLevel:"I",patientInfo:"Explain the importance of evaluating persistent symptoms. Discuss risk factors. Address anxiety and the diagnostic plan, likely involving ENT specialist referral.",pitfalls:["Delaying referral for persistent symptoms (>2-4 weeks).","Not performing a thorough cranial nerve exam.","Underestimating significance of unilateral otalgia or serous otitis media in adults (nasopharyngeal cancer risk)."],options:[{text:"Red flag symptoms: Stridor, airway compromise, significant bleeding, rapidly enlarging neck mass, cranial neuropathy",next:"emergency_assessment_ent",triggers:["hn_emergency_symptoms"]},{text:"Suspicious neck mass, persistent hoarseness >2-4 wks, non-healing oral ulcer >2-4 wks, dysphagia/odynophagia, or other concerning symptoms",next:"ent_referral_exam"},{text:"Low suspicion symptoms, no clear red flags",next:"primary_care_monitoring_reassess"}],redFlags:[{id:"hn_emergency_symptoms",condition:"Stridor, airway compromise, active hemorrhage from tumor site, rapidly progressive cranial neuropathy.",message:"Potential life-threatening situation. Requires immediate specialist assessment and possible intervention.",severity:"critical",recommendations:["Immediate referral to ENT/Emergency Department.","Secure airway if compromised (prepare for intubation/tracheostomy).","Control hemorrhage.","Urgent imaging (CT Head/Neck with contrast) may be needed."],urgency:"Immediate",actionType:"Emergency Referral & Airway/Hemorrhage Management"}]},{id:"ent_referral_exam",title:"ENT Specialist Examination & Endoscopy",description:"Comprehensive head and neck examination by ENT specialist, including palpation of neck nodes, oral cavity, and cranial nerve assessment. Perform flexible nasopharyngolaryngoscopy. Examination under anesthesia (EUA) with direct laryngoscopy, esophagoscopy, bronchoscopy (panendoscopy) may be indicated, especially for unknown primary or synchronous primary suspicion.",expectedDuration:"1-3 days",tooltip:"Document all subsites. Biopsy suspicious lesions during endoscopy/EUA. Consider HPV testing for oropharyngeal tumors (p16 IHC).",guidelineSource:"NCCN HN-1 & HN-2 2024",evidenceLevel:"I",requiresMDT:!0,patientInfo:"Explain the specialist exam, including flexible scope. If EUA needed, explain procedure, anesthesia, and purpose of biopsies.",pitfalls:["Incomplete endoscopic examination missing a primary site.","Not biopsying all suspicious areas.","Failure to perform p16 testing on oropharyngeal SCC biopsies."],options:[{text:"Visible lesion identified, biopsy taken/planned",next:"pathology_review_hn"},{text:"Neck mass, primary unknown after initial endoscopy. Plan for EUA, imaging, possible FNA of neck node.",next:"unknown_primary_workup_hn"},{text:"No lesion found, symptoms persist or high suspicion",next:"imaging_hn_initial"}]},{id:"pathology_review_hn",title:"Pathology Review & HPV Testing",description:"Histopathological confirmation of malignancy (usually Squamous Cell Carcinoma). For oropharyngeal SCC, p16 IHC testing is mandatory (NCCN HN-3). For nasopharyngeal carcinoma, EBV (EBER) testing. Note histologic grade and features like PNI, LVI.",expectedDuration:"3-7 days",tooltip:"p16 status significantly impacts staging and prognosis for oropharyngeal cancer. Ensure adequate tissue for all necessary tests.",guidelineSource:"NCCN HN-3 2024, CAP H&N Cancer Reporting Protocols",evidenceLevel:"I",requiresMDT:!0,patientInfo:"Explain the biopsy results, including cancer type and HPV/EBV status if relevant. Discuss how this information guides staging and treatment.",pitfalls:["p16 testing not performed or misinterpreted for oropharyngeal SCC.","Insufficient biopsy material for complete diagnosis and molecular testing.","Delay in pathology reporting."],options:[{text:"Malignancy confirmed (e.g., SCC, NPC, salivary gland tumor)",next:"staging_workup_hn",triggers:["hn_cancer_confirmed"]},{text:"Dysplasia or pre-malignant lesion found",next:"premalignant_lesion_management_hn"},{text:"Biopsy benign or non-diagnostic, but high clinical suspicion remains",next:"repeat_biopsy_further_investigation_hn"}],redFlags:[{id:"hn_cancer_confirmed",condition:"Histopathological confirmation of head and neck malignancy.",message:"Head and neck cancer diagnosed. Proceed with comprehensive staging and multidisciplinary team discussion.",severity:"critical",recommendations:["Schedule staging imaging (CT Neck with contrast, CT Chest, PET-CT as per NCCN HN-4).","Refer to multidisciplinary H&N oncology team (ENT surgeon, radiation oncologist, medical oncologist, pathologist, radiologist, speech pathologist, dietitian, dentist).","Dental assessment prior to radiation therapy.","Speech and swallow evaluation.","Nutritional assessment and support."],urgency:"Routine",actionType:"Staging, MDT Referral & Supportive Care Planning"}]},{id:"staging_workup_hn",title:"Comprehensive Staging Workup",description:"CT Neck with IV contrast (from skull base to clavicles). CT Chest (with or without contrast). PET-CT (skull base to mid-thigh) for stage III/IV disease, unknown primary, or aggressive histology (NCCN HN-4). MRI for specific sites (e.g., nasopharynx, paranasal sinus, skull base, salivary glands, PNI assessment). Dental evaluation and speech/swallow function assessment.",expectedDuration:"1-2 weeks",guidelineSource:"NCCN HN-4 & HN-5 2024, AJCC 8th Ed. Staging Manual",evidenceLevel:"I",requiresMDT:!0,patientInfo:"Explain the purpose of staging scans (CT, PET-CT, MRI) to determine cancer extent. Discuss importance of dental, speech, and swallow evaluations before treatment.",pitfalls:["Incomplete staging (e.g., omitting chest imaging).","Not performing PET-CT when indicated, potentially missing distant mets or unknown primary.","Delay in dental clearance impacting start of radiation.","Underestimation of tumor extent, especially perineural invasion, without appropriate MRI."],options:[{text:"Localized disease (Stage I-II) or selected Stage III/IVA (e.g. HPV+ oropharynx)",next:"mdt_treatment_planning_early_hn"},{text:"Locally/regionally advanced disease (Stage III-IVB, excluding M1)",next:"mdt_treatment_planning_advanced_hn"},{text:"Metastatic disease (Stage IVC / M1) identified",next:"mdt_treatment_planning_metastatic_hn",triggers:["metastatic_hn_cancer"]},{text:"Cancer of Unknown Primary (CUP) with neck node mets",next:"unknown_primary_management_hn"}],redFlags:[{id:"metastatic_hn_cancer",condition:"Metastatic disease (M1) confirmed by staging investigations.",message:"Stage IVC (metastatic) head and neck cancer. Treatment intent is primarily palliative.",severity:"critical",recommendations:["Medical oncology consultation for systemic therapy (chemotherapy, immunotherapy, targeted therapy).","Early palliative care referral for symptom control and goals of care discussion.","Address nutritional support, pain management, and potential airway issues.","Consider clinical trials."],urgency:"Same-day",actionType:"Systemic Therapy & Palliative Care Planning"}]}]},ct={id:"pancreatic",name:"Pancreatic Cancer Diagnostic Pathway",description:"Evidence-based approach to pancreatic cancer diagnosis, staging, and initial management planning, aligned with NCCN 2024, ESMO 2023, and ASGE guidelines.",recommendedTimeframe:"1-2 weeks for diagnosis; 2-3 weeks for full staging and MDT discussion.",steps:[{id:"initial",title:"Initial Presentation & Symptom Evaluation",description:"Patient presents with symptoms such as painless obstructive jaundice, new-onset diabetes (especially >50 yrs with weight loss), unexplained persistent abdominal/back pain, weight loss, steatorrhea, or acute pancreatitis without clear cause.",expectedDuration:"1-2 days",guidelineSource:"NCCN PA-1 & PA-2 2024, ESMO Pancreatic Cancer Guidelines 2023",evidenceLevel:"I",patientInfo:"Explain that symptoms warrant investigation to rule out serious conditions, including pancreatic cancer. Discuss the diagnostic plan, likely involving imaging and specialist referral.",pitfalls:["Attributing symptoms to benign GI issues, delaying diagnosis.","Not recognizing new-onset diabetes with weight loss as a red flag.","Delay in imaging for painless jaundice."],options:[{text:"Painless obstructive jaundice (elevated bilirubin, dark urine, pale stools)",next:"urgent_imaging_jaundice",triggers:["pan_jaundice"]},{text:"Suspicious pancreatic mass/lesion found on incidental imaging",next:"dedicated_pancreatic_imaging"},{text:"Concerning symptoms (e.g., persistent epigastric pain radiating to back, unexplained significant weight loss, new-onset diabetes with weight loss) without jaundice",next:"initial_labs_imaging_non_jaundice"},{text:"Vague symptoms, low suspicion initially",next:"primary_care_workup_monitoring"}],redFlags:[{id:"pan_jaundice",condition:"Painless obstructive jaundice.",message:"High suspicion for pancreatic head or periampullary malignancy. Requires urgent evaluation.",severity:"critical",recommendations:["Urgent (within 48 hours) high-quality multiphase pancreatic protocol CT scan (or MRI/MRCP if CT contraindicated/equivocal).","Check LFTs, coagulation profile (INR).","Urgent referral to HPB surgeon / Gastroenterologist with expertise in pancreatobiliary diseases.","Consider biliary drainage (ERCP with stenting or PTBD) if severe jaundice or cholangitis, after imaging if possible."],urgency:"Immediate",actionType:"Urgent Imaging, Labs & Specialist Referral"},{id:"cholangitis_signs",condition:"Jaundice with fever, chills, RUQ pain (Charcot's triad) or sepsis.",message:"Acute cholangitis, a medical emergency. Requires immediate biliary decompression and antibiotics.",severity:"critical",recommendations:["Immediate hospital admission.","Broad-spectrum IV antibiotics.","Urgent biliary decompression (ERCP or PTBD) within 12-24 hours.","Fluid resuscitation and supportive care."],urgency:"Immediate",actionType:"Emergency Admission & Intervention"}]},{id:"dedicated_pancreatic_imaging",title:"High-Quality Pancreatic Imaging",description:"Perform multiphase pancreatic protocol CT (preferred) or MRI/MRCP. This is crucial for characterizing the lesion, assessing vascular involvement (SMA, SMV, portal vein, celiac axis), and detecting metastatic disease.",expectedDuration:"2-5 days",tooltip:"CT protocol: non-contrast, arterial, pancreatic parenchymal, and portal venous phases. Thin slices. Radiologist expertise is key.",guidelineSource:"NCCN PA-2 & PA-3 2024, International Consensus Guidelines 2017 (Radiology)",evidenceLevel:"I",patientInfo:"Explain the specific type of CT or MRI needed and why it’s important for detailed views of the pancreas and surrounding structures.",pitfalls:["Using a generic abdominal CT instead of a dedicated pancreatic protocol scan.","Misinterpretation of vascular involvement.","Not identifying small liver or peritoneal metastases."],options:[{text:"Solid pancreatic mass identified, potentially resectable or borderline resectable",next:"ca19_9_tissue_acquisition"},{text:"Clearly unresectable locally advanced disease (e.g., extensive vascular encasement)",next:"ca19_9_tissue_acquisition_unresectable"},{text:"Metastatic disease identified on imaging",next:"ca19_9_biopsy_metastatic_site",triggers:["pan_metastatic_imaging"]},{text:"Cystic lesion of pancreas identified",next:"pancreatic_cystic_lesion_pathway"},{text:"No discrete mass, but diffuse changes or secondary signs (e.g. dilated pancreatic duct)",next:"eus_evaluation_pancreas"}],redFlags:[{id:"pan_metastatic_imaging",condition:"Evidence of metastatic disease (e.g., liver, lung, peritoneal metastases) on initial high-quality imaging.",message:"Metastatic pancreatic cancer. Tissue diagnosis is needed, preferably from a metastatic site. Treatment is systemic.",severity:"critical",recommendations:["Obtain CA 19-9.","Biopsy of an accessible metastatic lesion is preferred for diagnosis and molecular profiling.","Refer to Medical Oncologist.","Early Palliative Care consultation."],urgency:"Routine",actionType:"Biopsy Planning & Oncology Referral"}]},{id:"ca19_9_tissue_acquisition",title:"CA 19-9 & Tissue Acquisition Strategy",description:"Measure serum CA 19-9. Plan for tissue acquisition. EUS-FNA is preferred for most pancreatic head/body/tail lesions. CT-guided biopsy if EUS not feasible or for specific targets. Biopsy of suspected metastatic sites is preferred if M1 disease. For resectable disease without preoperative therapy planned, some centers proceed to surgery without biopsy if imaging is classic, but biopsy is generally recommended (NCCN PA-3).",expectedDuration:"3-7 days (including EUS scheduling and procedure)",tooltip:"CA 19-9 can be falsely normal in Lewis antigen negative individuals (~10%). EUS allows FNA and detailed local staging.",guidelineSource:"NCCN PA-3 2024, ASGE Guideline 2022 (EUS)",evidenceLevel:"I",requiresMDT:!0,patientInfo:"Explain CA 19-9 blood test. Discuss EUS/biopsy procedure, its purpose for confirming diagnosis and guiding treatment, risks (pancreatitis, bleeding, perforation).",pitfalls:["Not obtaining tissue prior to neoadjuvant therapy.","Performing percutaneous biopsy through uninvolved peritoneum if potentially resectable (risk of seeding - though controversial and often unavoidable).","Non-diagnostic biopsy delaying treatment."],options:[{text:"Pancreatic adenocarcinoma or other malignancy confirmed by biopsy",next:"molecular_testing_staging_mdt"},{text:"Biopsy non-diagnostic, but high suspicion remains",next:"repeat_biopsy_alternative_approach"},{text:"Benign pathology, concordant with less suspicious imaging",next:"benign_pancreas_followup"}]},{id:"molecular_testing_staging_mdt",title:"Molecular Testing, Full Staging Review & MDT",description:"For confirmed adenocarcinoma, perform germline testing for all patients (BRCA1/2, PALB2, ATM, Lynch syndrome genes, etc.). Somatic tumor testing (e.g., KRAS, NRG1, NTRK fusions, MSI/dMMR, HRD) for advanced/metastatic disease or if informing neoadjuvant/adjuvant choices (NCCN PA-4). Review all imaging with MDT (HPB surgeon, medical/radiation oncologist, radiologist, pathologist) to confirm resectability status (resectable, borderline, locally advanced unresectable, metastatic) using NCCN criteria. Consider staging laparoscopy for select cases (e.g. high CA19-9, large tumors, borderline resectable) to rule out occult peritoneal/liver mets.",expectedDuration:"1-2 weeks (molecular testing can take time)",guidelineSource:"NCCN PA-3, PA-4, PA-5 2024",evidenceLevel:"I",requiresMDT:!0,patientInfo:"Explain that genetic testing (blood and/or tumor) can identify specific mutations that might guide treatment. Discuss MDT review and its role in formulating the best treatment plan. Explain staging laparoscopy if considered.",pitfalls:["Not performing germline testing for all patients.","Delay in obtaining molecular results for treatment decisions.","Inaccurate staging due to lack of MDT review or omitting staging laparoscopy when indicated."],options:[{text:"Resectable disease confirmed by MDT",next:"treatment_planning_resectable_pancreas"},{text:"Borderline resectable disease confirmed by MDT",next:"treatment_planning_borderline_pancreas"},{text:"Locally advanced, unresectable disease confirmed by MDT",next:"treatment_planning_locally_advanced_pancreas"},{text:"Metastatic disease confirmed by MDT",next:"treatment_planning_metastatic_pancreas",triggers:["pan_metastatic_mdt"]}],redFlags:[{id:"pan_metastatic_mdt",condition:"Metastatic pancreatic cancer confirmed after full workup and MDT review.",message:"Definitive metastatic disease. Focus on systemic therapy and supportive/palliative care.",severity:"critical",recommendations:["Medical Oncology to lead systemic therapy (chemotherapy +/- targeted therapy based on molecular results).","Palliative care for symptom management, QoL, and goals of care.","Nutritional support, pain management, management of biliary/duodenal obstruction.","Discuss clinical trial options."],urgency:"Routine",actionType:"Systemic Therapy & Palliative Care"}]}]},dt={id:"bladder",name:"Bladder Cancer Diagnostic Pathway",description:"Systematic approach to bladder cancer diagnosis and staging",recommendedTimeframe:"2-3 weeks",steps:[{id:"initial",title:"Initial Assessment",description:"Patient presents with hematuria or urinary symptoms",expectedDuration:"1-2 days",tooltip:"Document gross vs microscopic hematuria and associated symptoms",options:[{text:"Gross hematuria",next:"urgent_cystoscopy",triggers:["gross_bleeding"]},{text:"Microscopic hematuria",next:"initial_workup"},{text:"Irritative symptoms",next:"urinalysis"}],redFlags:[{id:"gross_bleeding",condition:"Gross hematuria with clots",message:"Active bleeding requiring evaluation",severity:"critical",recommendations:["Urgent urologic consultation","CBC and coagulation profile","Consider admission if heavy bleeding"]}]},{id:"urinalysis",title:"Urinalysis and Cytology",description:"Initial laboratory evaluation",expectedDuration:"2-3 days",tooltip:"Include urine cytology and culture if indicated",options:[{text:"Positive cytology",next:"cystoscopy",triggers:["positive_cytology"]},{text:"Persistent hematuria",next:"cystoscopy"},{text:"Negative workup",next:"risk_assessment"}],redFlags:[{id:"positive_cytology",condition:"Positive urine cytology",message:"Cytology suggesting malignancy",severity:"warning",recommendations:["Expedite cystoscopy","Consider upper tract imaging","Document smoking history"]}]},{id:"cystoscopy",title:"Diagnostic Cystoscopy",description:"Direct visualization of bladder mucosa",expectedDuration:"1 day",tooltip:"Document location, size, and number of lesions",options:[{text:"Visible tumor",next:"turbt",triggers:["visible_tumor"]},{text:"Suspicious areas",next:"biopsy"},{text:"Normal cystoscopy",next:"imaging"}],redFlags:[{id:"visible_tumor",condition:"Visible bladder tumor",message:"Tumor identified on cystoscopy",severity:"critical",recommendations:["Schedule TURBT within 2 weeks","Complete staging workup","Consider enhanced cystoscopy"]}]},{id:"imaging",title:"Upper Tract Imaging",description:"CT urogram or other appropriate imaging",expectedDuration:"2-3 days",tooltip:"Evaluate upper tracts and look for metastatic disease",options:[{text:"Bladder mass",next:"turbt"},{text:"Upper tract lesion",next:"specialized_evaluation",triggers:["upper_tract"]},{text:"Metastatic disease",next:"staging",triggers:["metastatic"]}],redFlags:[{id:"upper_tract",condition:"Upper tract lesion",message:"Suspicious upper tract finding",severity:"warning",recommendations:["Urology consultation","Consider ureteroscopy","Plan comprehensive evaluation"]},{id:"metastatic",condition:"Metastatic disease",message:"Evidence of metastatic spread",severity:"critical",recommendations:["Tissue confirmation needed","Oncology consultation","Discuss treatment goals"]}]},{id:"turbt",title:"TURBT",description:"Transurethral resection of bladder tumor",expectedDuration:"1-2 days",tooltip:"Complete resection with muscle if possible",options:[{text:"Non-muscle invasive",next:"risk_stratification"},{text:"Muscle invasive",next:"staging",triggers:["muscle_invasive"]},{text:"Incomplete resection",next:"repeat_turbt"}],redFlags:[{id:"muscle_invasive",condition:"Muscle invasive disease",message:"Muscle invasion confirmed",severity:"critical",recommendations:["Complete staging workup","Multidisciplinary consultation","Discuss treatment options","Consider clinical trials"]}]}]},ye={breast:st,prostate:at,lung:nt,ovarian:rt,gastric:ot,head_neck:lt,pancreatic:ct,bladder:dt},he=({redFlag:t,onDismiss:s})=>{const{severity:i,message:a,condition:n,recommendations:l}=t;return e.jsx("div",{className:`p-4 rounded-lg border ${i==="critical"?"bg-red-50 border-red-300":"bg-yellow-50 border-yellow-300"}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:i==="critical"?e.jsx($,{className:"w-5 h-5 text-red-600"}):e.jsx(A,{className:"w-5 h-5 text-yellow-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:`font-semibold ${i==="critical"?"text-red-800":"text-yellow-800"}`,children:n}),s&&e.jsxs("button",{onClick:s,className:"text-gray-400 hover:text-gray-500",children:[e.jsx("span",{className:"sr-only",children:"Dismiss"}),e.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})]})]}),e.jsx("p",{className:`mt-1 text-sm ${i==="critical"?"text-red-700":"text-yellow-700"}`,children:a}),l&&l.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("h4",{className:`text-sm font-medium ${i==="critical"?"text-red-800":"text-yellow-800"}`,children:"Recommendations:"}),e.jsx("ul",{className:`mt-2 text-sm space-y-1 list-disc list-inside ${i==="critical"?"text-red-700":"text-yellow-700"}`,children:l.map((c,u)=>e.jsx("li",{children:c},u))})]})]})]})})},mt=({summary:t,onRedFlagDismiss:s})=>{const{totalSteps:i,completedSteps:a,activeRedFlags:n,estimatedTimeRemaining:l,nextRequiredActions:c}=t,u=Math.round(a/i*100),y=n.filter(o=>o.severity==="critical"),p=n.filter(o=>o.severity==="warning");return e.jsxs("div",{className:"bg-white rounded-lg shadow divide-y divide-gray-200",children:[e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Pathway Progress"}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[a," of ",i," steps completed"]}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[u,"%"]})]}),e.jsx("div",{className:"mt-2 relative",children:e.jsx("div",{className:"h-2 bg-gray-100 rounded-full",children:e.jsx("div",{className:`absolute left-0 h-2 rounded-full ${u===100?"bg-green-500":"bg-blue-500"}`,style:{width:`${u}%`}})})})]}),l&&e.jsxs("div",{className:"mt-4 flex items-center text-sm text-gray-600",children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),e.jsxs("span",{children:["Estimated time remaining: ",l]})]})]}),n.length>0&&e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900",children:"Active Red Flags"}),e.jsxs("div",{className:"space-y-3",children:[y.map(o=>e.jsx(he,{redFlag:o,onDismiss:s?()=>s(o.id):void 0},o.id)),p.map(o=>e.jsx(he,{redFlag:o,onDismiss:s?()=>s(o.id):void 0},o.id))]})]}),c.length>0&&e.jsxs("div",{className:"p-6",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900",children:"Next Required Actions"}),e.jsx("ul",{className:"mt-4 space-y-3",children:c.map((o,h)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx(X,{className:"w-5 h-5 text-gray-400 mt-0.5 mr-3"}),e.jsx("span",{className:"text-gray-600",children:o})]},h))})]}),e.jsx("div",{className:"p-6",children:e.jsxs("button",{className:"w-full flex justify-center items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",onClick:()=>{console.log("Generate AI suggestions")},children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"Get AI Suggestions"]})})]})},gt=({pathway:t})=>{const[s,i]=g.useState("initial"),[a,n]=g.useState({completedSteps:[],currentStep:"initial",redFlagsTriggered:[],timeStarted:Date.now()}),l=t.steps.find(p=>p.id===s),c=()=>{const p=t.steps.length,o=a.completedSteps.length,h=t.steps.filter(f=>a.redFlagsTriggered.some(S=>{var w;return(w=f.redFlags)==null?void 0:w.some(P=>P.id===S)})).flatMap(f=>f.redFlags||[]).filter(f=>a.redFlagsTriggered.includes(f.id)),C=t.recommendedTimeframe?`${t.recommendedTimeframe} (estimated)`:void 0,v=l?[l.description,...(l.redFlags||[]).flatMap(f=>f.recommendations)]:[];return{totalSteps:p,completedSteps:o,activeRedFlags:h,estimatedTimeRemaining:C,nextRequiredActions:v}},u=(p,o)=>{n(h=>({...h,completedSteps:[...h.completedSteps,s],currentStep:p,redFlagsTriggered:[...h.redFlagsTriggered,...o||[]]})),i(p)},y=p=>{n(o=>({...o,redFlagsTriggered:o.redFlagsTriggered.filter(h=>h!==p)}))};return l?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:l.title}),e.jsx("p",{className:"mt-2 text-gray-700",children:l.description})]}),l.tooltip&&e.jsxs("div",{className:"group relative",children:[e.jsx(li,{className:"w-5 h-5 text-gray-400 hover:text-gray-500 cursor-help"}),e.jsx("div",{className:"invisible group-hover:visible absolute right-0 w-64 p-2 mt-2 text-sm text-gray-600 bg-white rounded-lg shadow-lg border border-gray-200",children:l.tooltip})]})]}),l.expectedDuration&&e.jsxs("div",{className:"mt-4 text-sm text-gray-600",children:["Expected duration: ",l.expectedDuration]})]}),e.jsx(mt,{summary:c(),onRedFlagDismiss:y}),e.jsx("div",{className:"space-y-4",children:l.options.map((p,o)=>e.jsx("button",{onClick:()=>u(p.next,p.triggers),className:"w-full py-3 px-4 rounded-md bg-indigo-600 hover:bg-indigo-700 text-white font-medium text-left",children:p.text},o))})]}):e.jsxs("div",{className:"p-4 rounded-md bg-red-50 text-red-700",children:['Error: Step not found for ID "',s,'"']})},$e=()=>{const[t,s]=g.useState(null),i={breast:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),prostate:e.jsx(yi,{className:"w-6 h-6"}),lung:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11c0-4.4-3.6-8-8-8S3 6.6 3 11c0 2.5 1.2 4.8 3 6.2V21h12v-3.8c1.8-1.4 3-3.7 3-6.2z"})}),ovarian:e.jsx(ui,{className:"w-6 h-6"}),gastric:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 13.87C6 16.15 7.57 18 9.46 18H14.54C16.43 18 18 16.15 18 13.87C18 10.5 14 9 12 9C10 9 6 10.5 6 13.87Z"})}),head_neck:e.jsx(pi,{className:"w-6 h-6"}),pancreatic:e.jsx(gi,{className:"w-6 h-6"}),bladder:e.jsx(mi,{className:"w-6 h-6"}),colorectal:e.jsx(di,{className:"w-6 h-6"}),lymphoma:e.jsx(L,{className:"w-6 h-6"})};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Diagnostic Pathways"}),t&&e.jsxs("button",{onClick:()=>s(null),className:"text-sm text-gray-600 hover:text-gray-800 flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Back to Cancer Types"]})]}),t?e.jsx("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-6",children:e.jsx(gt,{pathway:ye[t]})}):e.jsxs("div",{className:"grid gap-6",children:[e.jsxs("div",{className:"p-4 bg-white rounded-lg shadow border border-gray-200",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Select Cancer Type"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Object.entries(ye).map(([a,n])=>e.jsxs("button",{onClick:()=>s(a),className:"p-4 text-left bg-blue-50 hover:bg-blue-100 rounded-lg border border-blue-200 flex items-start space-x-3",children:[e.jsx("div",{className:"text-blue-600",children:i[a]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-800",children:n.name}),e.jsx("p",{className:"text-sm text-blue-600 mt-1",children:n.description}),n.recommendedTimeframe&&e.jsxs("p",{className:"text-sm text-blue-500 mt-2",children:["Typical timeline: ",n.recommendedTimeframe]})]})]},a))})]}),e.jsx("div",{className:"p-4 bg-white rounded-lg shadow border border-gray-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(ci,{className:"w-6 h-6 text-gray-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"About Diagnostic Pathways"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Select a cancer type above to view its specific diagnostic pathway. Each pathway provides:"}),e.jsxs("ul",{className:"mt-2 space-y-2 text-gray-600 list-disc list-inside",children:[e.jsx("li",{children:"Step-by-step diagnostic guidance"}),e.jsx("li",{children:"Red flag alerts for critical findings"}),e.jsx("li",{children:"Expected timelines and progress tracking"}),e.jsx("li",{children:"AI-powered suggestions and summaries"})]})]})]})})]})]})},fe="gemini-pro",xe=3,pt=1e3,ut=[{category:W.HARM_CATEGORY_HARASSMENT,threshold:Y.BLOCK_MEDIUM_AND_ABOVE},{category:W.HARM_CATEGORY_HATE_SPEECH,threshold:Y.BLOCK_MEDIUM_AND_ABOVE},{category:W.HARM_CATEGORY_SEXUALLY_EXPLICIT,threshold:Y.BLOCK_MEDIUM_AND_ABOVE},{category:W.HARM_CATEGORY_DANGEROUS_CONTENT,threshold:Y.BLOCK_MEDIUM_AND_ABOVE}];class G extends Error{constructor(i,a,n=500){super(i);ie(this,"code");ie(this,"statusCode");this.name="GeminiError",this.code=a,this.statusCode=n}}function yt(){var s,i,a;const t=((i=(s=import.meta)==null?void 0:s.env)==null?void 0:i.VITE_GEMINI_API_KEY)??((a=process==null?void 0:process.env)==null?void 0:a.VITE_GEMINI_API_KEY)??"";if(!t)throw new G("Gemini API key not configured","API_KEY_MISSING",400);return t}const ht=t=>new Promise(s=>setTimeout(s,t));async function Ve(t,s=xe){try{return await t()}catch(i){if(s<=0||i instanceof G&&["API_KEY_MISSING","INVALID_RESPONSE","RATE_LIMIT_EXCEEDED"].includes(i.code))throw i;return await ht(pt*(xe-s+1)),Ve(t,s-1)}}function ft(t){try{return{valid:!0,sanitized:JSON.parse(JSON.stringify(t))}}catch{return{valid:!1}}}async function xt(t,s,i){const a=yt();return Ve(async()=>{try{const l=new Vi(a).getGenerativeModel({model:fe,safetySettings:ut}),c=[];i!=null&&i.length,c.push({role:"user",parts:[{text:t}]});const o=(await(await l.startChat({history:c,generationConfig:{temperature:.7,topK:40,topP:.95,maxOutputTokens:1024}}).sendMessage(t)).response).text(),h=ft(o);if(!h.valid||!h.sanitized)throw new Error("Response contains invalid JSON characters");return{id:de(),content:h.sanitized,timestamp:new Date().toISOString(),metadata:{model:fe}}}catch(n){throw n instanceof G?n:n instanceof Error?n.message.includes("API quota exceeded")||n.message.includes("Network error")||n.message.includes("Response contains invalid JSON characters")?new Error(n.message):n.message.toLowerCase().includes("network")||n.message.toLowerCase().includes("fetch")||n.message.toLowerCase().includes("connection")?new Error("Network error"):new G(`Failed to generate response: ${n.message}`,"GENERATION_FAILED",500):new G("Unknown error occurred","UNKNOWN_ERROR",500)}})}const vt={OPD:{screening:["Based on the patient's age and risk factors, recommended screening includes annual mammography and colonoscopy every 10 years.","Given the family history, consider genetic counseling and BRCA testing."],triage:["Patient requires urgent evaluation due to severe symptoms.","Routine follow-up recommended in 3 months."]},CDU:{toxicity:["Grade 3 neutropenia detected. Consider G-CSF support and dose reduction.","Mild peripheral neuropathy - continue monitoring, consider vitamin B6."]},Inpatient:{},Palliative:{},RadOnc:{}};new hi({apiKey:"your-openai-api-key-here",dangerouslyAllowBrowser:!0});let bt=class extends Error{constructor(s,i){super(s),this.code=i,this.name="APIError"}};function wt(t,s){const i=vt[t];if(!i)return"Mock response not found for this module.";const a=i[s];if(!a)return"Mock response not found for this intent.";const n=Math.floor(Math.random()*a.length);return a[n]}async function pe({module:t,intent:s,prompt:i,context:a,mockMode:n,iterationCount:l=0,previousResponse:c,feedbackType:u,history:y=[]}){if(n)return{id:de(),content:wt(t,s),timestamp:new Date,metadata:{module:t,intent:s,model:"mock"}};let p=i;if(l>0&&c){const h=`Previous response:
${c}

User feedback:
${i}`;p=u==="refine"?`Please refine and improve the previous response, focusing on accuracy and clarity.
${h}`:u==="elaborate"?`Please provide more detailed information and examples to elaborate on the previous response.
${h}`:u==="correct"?`Please correct any errors or inaccuracies in the previous response, ensuring medical accuracy.
${h}`:`Please continue with this additional context:
${h}`}const o=`
Context:
${a||"No specific context provided"}

Module: ${t}
Intent: ${s}

History:
${y.length>0?y.join(`

`):"No previous history"}

Current Task:
${p}

Please provide a comprehensive response suitable for a medical professional.`;try{const h=await xt(o);return{id:de(),content:h,timestamp:new Date,metadata:{module:t,intent:s,model:"gemini"}}}catch(h){throw new bt(h instanceof Error?h.message:"Failed to get AI response","GEMINI_API_ERROR")}}const ze=()=>{const[t,s]=g.useState(!1),[i,a]=g.useState({age:0,gender:"female",smokingHistory:!1,packYears:0,isHighRisk:!1,riskFactors:{priorCancer:!1,immunocompromised:!1,radiationExposure:!1,geneticRisk:{brcaPositive:!1,lynchSyndrome:!1}},familyHistory:{breast:!1,colorectal:!1,prostate:!1,ovarian:!1},lastScreening:{mammogram:"",colonoscopy:"",papSmear:"",ldct:"",psa:"",breastMri:"",endoscopy:"",ctAbdomen:""},activeSymptoms:{weightLoss:!1,abdominalPain:!1,backPain:!1,jaundice:!1,bloating:!1,earlySatiety:!1,hoarseness:!1,dysphagia:!1,earPain:!1,vomiting:!1,bleeding:!1,fever:!1,nightSweats:!1}}),[n,l]=g.useState({breast:!0,cervical:!0,colorectal:!0,lung:!0,prostate:!0}),[c,u]=g.useState(!1),y=r=>r.target.checked,p=r=>r!=null&&r.length>0,o=r=>p(r)?new Date().getFullYear()-new Date(r).getFullYear():1/0,h=()=>{const r=i.activeSymptoms,m=[];return r.weightLoss&&(r.backPain||r.jaundice)&&m.push("pancreatic"),r.bloating&&r.earlySatiety&&i.gender==="female"&&m.push("ovarian"),(r.hoarseness||r.dysphagia||r.earPain)&&m.push("headNeck"),(r.vomiting||r.bleeding)&&m.push("gastric"),(r.fever||r.nightSweats)&&r.weightLoss&&m.push("lymphoma"),m},C=()=>{const r={colorectal:{cancerType:"colorectal",status:"not-indicated",reason:"Age below screening threshold"},lung:{cancerType:"lung",status:"not-indicated",reason:"Not meeting screening criteria"}};if(i.age>=45){const d=i.lastScreening.colonoscopy,_=o(d);p(d)?_>=10?r.colorectal={cancerType:"colorectal",status:"due",reason:"Follow-up colonoscopy needed",isOverdue:!0}:_>=8&&(r.colorectal={cancerType:"colorectal",status:"upcoming",reason:"Colonoscopy due within 2 years",nextDue:d}):r.colorectal={cancerType:"colorectal",status:"due",reason:"Initial screening colonoscopy needed",isOverdue:i.age>45}}const m=h();if(m.length>0&&m.forEach(d=>{r[d]={cancerType:d,status:"due",reason:"Concerning symptoms present - requires immediate evaluation",isOverdue:!0}}),i.gender==="female"){if(i.age>=40&&i.age<=74){const d=i.lastScreening.mammogram;r.breast={cancerType:"breast",status:!p(d)||o(d)>=1?"due":"upcoming",reason:i.familyHistory.breast?"High-risk patient requires more frequent screening":i.isHighRisk?"Modified screening interval due to risk factors":"Regular annual screening recommended",isOverdue:p(d)&&o(d)>1}}if(i.age>=21&&i.age<=65){const d=i.lastScreening.papSmear;r.cervical={cancerType:"cervical",status:!p(d)||o(d)>=3?"due":"upcoming",reason:i.age>=30?"Co-testing with HPV recommended every 5 years":"Pap smear recommended every 3 years",isOverdue:p(d)&&o(d)>3}}}if(i.gender==="male"&&i.age>=50){const d=i.lastScreening.psa;r.prostate={cancerType:"prostate",status:!p(d)||o(d)>=1?"due":"upcoming",reason:i.familyHistory.prostate?"High-risk patient requires annual PSA screening":"Consider PSA screening based on shared decision making",isOverdue:p(d)&&o(d)>1}}if(i.age>=50&&i.age<=80&&i.smokingHistory&&(i.packYears??0)>=20){const d=i.lastScreening.ldct;r.lung={cancerType:"lung",status:!p(d)||o(d)>=1?"due":"upcoming",reason:"Annual LDCT recommended for high-risk patients",isOverdue:p(d)&&o(d)>1}}return r},v=async({prompt:r,context:m})=>{try{return(await pe({module:"OPD",intent:"screening",prompt:r,context:m,mockMode:t})).content}catch(d){if(console.error("Generate Summary Error:",d),d.name==="APIError")switch(d.code){case"INVALID_JSON":case"INVALID_RESPONSE":throw new Error("The AI service returned an invalid response. Please try again.");case"RATE_LIMIT":throw new Error("Too many requests. Please wait a moment and try again.");case"CONNECTION_ERROR":throw new Error("Unable to connect to the AI service. Please check your connection.");default:throw new Error(d.message||"Failed to generate summary")}throw new Error("Failed to generate summary")}},f=C(),S=({title:r,description:m,duration:d=5e3,variant:_="default"})=>{ei(m,{type:_==="destructive"?"error":"info",autoClose:d,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0})},w=async r=>{u(!0);const m=f[r.toLowerCase()];if(m)try{const d=`
Patient Information:
- Age: ${i.age}
- Gender: ${i.gender}
- Smoking History: ${i.smokingHistory?`Yes (${i.packYears} pack years)`:"No"}
- High Risk: ${i.isHighRisk?"Yes":"No"}
- Family History: ${Object.entries(i.familyHistory).filter(([R,Q])=>Q).map(([R])=>R).join(", ")}

Screening Status:
Cancer Type: ${r}
Current Status: ${m.status}
Reason: ${m.reason}
Last Screening: ${i.lastScreening[r.toLowerCase()]||"Never"}
${m.isOverdue?"OVERDUE FOR SCREENING":""}
`,_=await v({prompt:"Analyze this patient's cancer screening status and provide personalized recommendations.",context:d});S({title:`${r} Screening Analysis`,description:_,duration:1e4})}catch(d){console.error("AI Consultation Error:",d),S({title:"Consultation Failed",description:d.message||"Unable to provide AI consultation at this time. Please try again later.",variant:"destructive"})}finally{u(!1)}},P=()=>{console.log("Exporting recommendations...")},B=(r,m)=>{if(m)return"text-red-600 bg-red-50";switch(r){case"due":return"text-yellow-600 bg-yellow-50";case"upcoming":return"text-blue-600 bg-blue-50";case"not-indicated":return"text-gray-600 bg-gray-50";default:return"text-gray-600 bg-gray-50"}};return e.jsxs("div",{className:"space-y-6 max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Cancer Screening Assistant"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>s(!t),className:`px-3 py-1 rounded-full text-sm font-medium ${t?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:t?"🧪 Mock Mode":"🤖 Gemini Mode"}),e.jsxs("button",{onClick:P,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(ge,{size:16}),"Export PDF"]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"High Risk Assessment"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i.isHighRisk,onChange:r=>a(m=>({...m,isHighRisk:y(r)})),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 peer-checked:after:translate-x-full peer-checked:bg-blue-600 after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all"}),e.jsx("span",{className:"ml-3 text-sm font-medium text-gray-700",children:"High Risk Patient"})]})]}),i.isHighRisk&&e.jsx("div",{className:"mt-4 space-y-4",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",checked:i.riskFactors.geneticRisk.brcaPositive,onChange:r=>a(m=>({...m,riskFactors:{...m.riskFactors,geneticRisk:{...m.riskFactors.geneticRisk,brcaPositive:y(r)}}})),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{children:"BRCA1/2 Positive"})]}),e.jsxs("label",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",checked:i.riskFactors.geneticRisk.lynchSyndrome,onChange:r=>a(m=>({...m,riskFactors:{...m.riskFactors,geneticRisk:{...m.riskFactors.geneticRisk,lynchSyndrome:y(r)}}})),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{children:"Lynch Syndrome"})]}),e.jsxs("label",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",checked:i.riskFactors.priorCancer,onChange:r=>a(m=>({...m,riskFactors:{...m.riskFactors,priorCancer:y(r)}})),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{children:"Prior Cancer History"})]}),e.jsxs("label",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",checked:i.riskFactors.immunocompromised,onChange:r=>a(m=>({...m,riskFactors:{...m.riskFactors,immunocompromised:y(r)}})),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{children:"Immunocompromised"})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Patient Information"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Age"}),e.jsx("input",{type:"number",value:i.age||"",onChange:r=>a(m=>({...m,age:parseInt(r.target.value)||0})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Gender"}),e.jsxs("select",{value:i.gender,onChange:r=>a(m=>({...m,gender:r.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"male",children:"Male"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Smoking History"}),e.jsxs("div",{className:"mt-1 space-y-2",children:[e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",checked:i.smokingHistory,onChange:r=>a(m=>({...m,smokingHistory:y(r)})),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"ml-2",children:"Current or Former Smoker"})]}),i.smokingHistory&&e.jsx("input",{type:"number",placeholder:"Pack Years",value:i.packYears||"",onChange:r=>a(m=>({...m,packYears:parseInt(r.target.value)||0})),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Family History"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:Object.keys(i.familyHistory).map(r=>e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",checked:i.familyHistory[r],onChange:m=>a(d=>({...d,familyHistory:{...d.familyHistory,[r]:y(m)}})),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsxs("span",{className:"ml-2 capitalize",children:[r," Cancer"]})]},r))})]}),e.jsxs("div",{className:"mt-4 border-t pt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Active Symptoms"}),e.jsx("div",{className:"grid md:grid-cols-3 gap-4",children:Object.entries(i.activeSymptoms).map(([r,m])=>e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:d=>a(_=>({..._,activeSymptoms:{..._.activeSymptoms,[r]:y(d)}})),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 capitalize",children:r.replace(/([A-Z])/g," $1").toLowerCase()})]},r))})]}),e.jsxs("div",{className:"mt-4 border-t pt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Last Screening Dates"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:Object.keys(i.lastScreening).map(r=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 capitalize",children:r.replace(/([A-Z])/g," $1").trim()}),e.jsx("input",{type:"date",value:i.lastScreening[r]||"",onChange:m=>a(d=>({...d,lastScreening:{...d.lastScreening,[r]:m.target.value}})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]},r))})]})]}),e.jsx("div",{className:"space-y-4",children:Object.entries(f).map(([r,m])=>!m||(r==="breast"||r==="cervical")&&i.gender==="male"||r==="prostate"&&i.gender==="female"?null:e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"p-4 flex items-center justify-between cursor-pointer",onClick:()=>l(d=>({...d,[r]:!d[r]})),children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 capitalize",children:[r," Cancer Screening"]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-sm font-medium ${B(m.status,m.isOverdue)}`,children:m.status.toUpperCase()}),m.isOverdue&&e.jsx(A,{className:"text-red-500",size:20})]}),n[r]?e.jsx(fi,{size:20}):e.jsx(xi,{size:20})]}),n[r]&&e.jsxs("div",{className:"p-4 border-t border-gray-200 space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:m.reason}),(m==null?void 0:m.nextDue)&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Next screening due: ",new Date(m.nextDue).toLocaleDateString()]}),e.jsxs("button",{onClick:()=>w(m.cancerType),className:"flex items-center gap-2 px-3 py-2 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",disabled:c,children:[e.jsx(vi,{size:16}),"Ask AI about ",r," screening"]})]})]},r))})]})};function Nt({guideline:t}){return console.log("ReferralCard guideline prop:",t),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:t.condition}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${t.urgency.includes("Urgent")?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:t.urgency})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Referral Criteria:"}),e.jsx("ul",{className:"mt-1 space-y-1",children:t.criteria.map((s,i)=>e.jsxs("li",{className:"text-gray-900 flex items-start",children:[e.jsx("span",{className:"mr-2",children:"•"}),s]},i))})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Required Workup:"}),e.jsx("ul",{className:"mt-1 space-y-1",children:t.workup.map((s,i)=>e.jsxs("li",{className:"text-gray-900 flex items-start",children:[e.jsx("span",{className:"mr-2",children:"•"}),s]},i))})]})]})]})}const Ct=({formData:t,setFormData:s})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"age",className:"block text-sm font-medium text-gray-700",children:"Age"}),e.jsx("input",{type:"number",id:"age",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",value:t.age,onChange:i=>s(a=>({...a,age:i.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"symptoms",className:"block text-sm font-medium text-gray-700",children:"Symptoms"}),e.jsx("textarea",{id:"symptoms",rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",value:t.symptoms,onChange:i=>s(a=>({...a,symptoms:i.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"duration",className:"block text-sm font-medium text-gray-700",children:"Duration of Symptoms"}),e.jsx("input",{type:"text",id:"duration",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"e.g., 2 weeks",value:t.duration,onChange:i=>s(a=>({...a,duration:i.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"clinicalFindings",className:"block text-sm font-medium text-gray-700",children:"Clinical Findings"}),e.jsx("textarea",{id:"clinicalFindings",rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",value:t.clinicalFindings,onChange:i=>s(a=>({...a,clinicalFindings:i.target.value}))})]})]}),St=({aiTriageResult:t})=>{if(!t)return null;const s={Urgent:"bg-red-50 text-red-600",Soon:"bg-yellow-50 text-yellow-600",Routine:"bg-green-50 text-green-600"},i=t.urgency==="Urgent"?A:t.urgency==="Soon"?De:me;return e.jsxs("div",{className:`p-4 rounded-md ${s[t.urgency]}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{className:"h-5 w-5"}),e.jsxs("h4",{className:"font-medium",children:[t.urgency," Referral"]})]}),e.jsxs("div",{className:"mt-2 text-sm",children:[e.jsxs("p",{children:["Timeframe: ",t.timeframe]}),e.jsx("ul",{className:"mt-2 pl-5 list-disc",children:t.reasoning.map((a,n)=>e.jsx("li",{children:a},n))})]})]})},ve=[{id:"breast-001",cancerType:"Breast Cancer",pathwayName:"Suspected Breast Cancer Pathway",urgencyLevel:"Calculated",aiTriageFactors:{highRiskFactors:["Palpable lump","Skin changes (peau d'orange)","Nipple discharge (bloody)"],moderateRiskFactors:["Axillary lymphadenopathy","Persistent breast pain"],lowRiskFactors:["Family history (low risk)","Fibrocystic changes"],redFlags:[{trigger:["Palpable lump","Skin changes"],message:"🚨 Red Flag: High suspicion for inflammatory breast cancer."}]},requiredInformation:{clinical:["Age","Symptoms","Duration","Clinical Findings"]},slaTimeframes:{urgent:"See within 2 weeks",soon:"See within 4 weeks",routine:"See within 6 weeks"}},{id:"lung-001",cancerType:"Lung Cancer",pathwayName:"Suspected Lung Cancer Pathway",urgencyLevel:"Calculated",aiTriageFactors:{highRiskFactors:["Hemoptysis","Unexplained weight loss (>10%)","Chest X-ray suggestive of malignancy"],moderateRiskFactors:["Persistent cough (>3 weeks)","Smoker (>20 pack-years)","Hoarseness"],lowRiskFactors:["Shortness of breath (stable)","Resolved pneumonia"],redFlags:[{trigger:["Hemoptysis","Weight loss"],message:"🚨 Red Flag: High suspicion for malignancy. Expedite referral."},{trigger:["Hoarseness","Persistent cough"],message:"🚨 Red Flag: Possible recurrent laryngeal nerve involvement."}]},requiredInformation:{clinical:["Age","Symptoms","Duration","Smoking history","Clinical Findings"]},slaTimeframes:{urgent:"See within 1 week",soon:"See within 3 weeks",routine:"See within 5 weeks"}},{id:"colorectal-001",cancerType:"Colorectal Cancer",pathwayName:"Suspected Colorectal Cancer Pathway",urgencyLevel:"Calculated",aiTriageFactors:{highRiskFactors:["Rectal bleeding with change in bowel habit","Palpable abdominal mass","Iron deficiency anemia (unexplained)"],moderateRiskFactors:["Change in bowel habit (>6 weeks)","Family history (first-degree relative)","Weight loss"],lowRiskFactors:["Hemorrhoids (confirmed)","Anal fissure"],redFlags:[{trigger:["Rectal bleeding","Change in bowel habit","Age > 50"],message:"🚨 Red Flag: High suspicion for colorectal cancer. Urgent colonoscopy needed."}]},requiredInformation:{clinical:["Age","Symptoms","Duration","Family history","Clinical Findings"]},slaTimeframes:{urgent:"See within 2 weeks",soon:"See within 4 weeks",routine:"See within 6 weeks"}}],jt=t=>{let s=0;return t.highRiskFactors.forEach(i=>{(t.clinicalFindings.toLowerCase().includes(i.toLowerCase())||t.symptoms.toLowerCase().includes(i.toLowerCase()))&&(s+=3)}),t.moderateRiskFactors.forEach(i=>{(t.clinicalFindings.toLowerCase().includes(i.toLowerCase())||t.symptoms.toLowerCase().includes(i.toLowerCase()))&&(s+=2)}),t.age>60&&(s+=1),t.age>75&&(s+=1),(t.duration.includes("month")||t.duration.includes("week")&&parseInt(t.duration)>6)&&(s+=1),s},kt=(t,s)=>{const i=jt(t),a=i>=7?"Urgent":i>=4?"Soon":"Routine",n=[];i>=7?(n.push("Multiple high-risk factors identified"),n.push("Requires urgent assessment")):i>=4?(n.push("Moderate risk factors present"),n.push("Early assessment recommended")):(n.push("Routine assessment appropriate"),n.push("Low-risk presentation"));const l=a==="Urgent"?s.urgent:s.routine||"Not specified";return{urgency:a,reasoning:n,timeframe:l}};function Ke(){const[t,s]=g.useState(!1),[i,a]=g.useState(""),[n,l]=g.useState({age:"",symptoms:"",duration:"",clinicalFindings:""}),[c,u]=g.useState(null),[y,p]=g.useState([]),[o,h]=g.useState(!1),C=g.useMemo(()=>[...new Set(ve.map(w=>w.cancerType))],[]),v=g.useMemo(()=>ve.find(w=>w.cancerType===i),[i]),f=async()=>{if(!v)return;const w={age:parseInt(n.age)||0,symptoms:n.symptoms,duration:n.duration,clinicalFindings:n.clinicalFindings,highRiskFactors:v.aiTriageFactors.highRiskFactors,moderateRiskFactors:v.aiTriageFactors.moderateRiskFactors},P={urgent:v.slaTimeframes.urgent,routine:v.slaTimeframes.routine},B=kt(w,P);u(B);const r=[],m=`${n.symptoms.toLowerCase()} ${n.clinicalFindings.toLowerCase()}`;v.aiTriageFactors.redFlags.forEach(d=>{d.trigger.every(R=>m.includes(R.toLowerCase()))&&r.push(d.message)}),p(r),S()},S=async()=>{if(!(!v||!c)){h(!0);try{const w=`
Cancer Type: ${v.pathwayName}
Patient Age: ${n.age}
Presenting Symptoms: ${n.symptoms}
Duration: ${n.duration}
Clinical Findings: ${n.clinicalFindings}

Initial Triage Result: ${c.urgency}
Red Flags Present: ${y.length>0?y.join(", "):"None"}

High Risk Factors to Consider:
${v.aiTriageFactors.highRiskFactors.join(`
`)}

Moderate Risk Factors to Consider:
${v.aiTriageFactors.moderateRiskFactors.join(`
`)}
`,P=await pe({module:"OPD",intent:"triage",prompt:"Analyze this oncology referral and provide additional insights. Consider the urgency level, risk factors, and any concerning features that might need immediate attention. Suggest additional workup if needed.",context:w,mockMode:t});H({title:"AI Clinical Insights",description:P.content,duration:1e4})}catch(w){console.error("AI Analysis Error:",w),H({title:"AI Analysis Error",description:"Unable to get AI insights at this time. Using local triage results only.",variant:"destructive"})}finally{h(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(k.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"📋 Referral Guidelines"}),e.jsx("button",{onClick:()=>s(!t),className:`px-3 py-1 rounded-full text-sm font-medium ${t?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:t?"🧪 Mock Mode":"🤖 Gemini Mode"})]})}),e.jsxs(k.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-lg shadow-lg",children:e.jsx(Fe,{className:"h-6 w-6 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent",children:"Referral Guideline Assistant"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4 p-6 backdrop-blur-sm bg-white bg-opacity-40 rounded-xl shadow-lg border border-gray-200 border-opacity-40 transition-all duration-300 hover:shadow-xl",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Clinical Information"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cancerType",className:"block text-sm font-medium text-gray-700",children:"Select Cancer Type / Pathway"}),e.jsxs("select",{id:"cancerType",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",value:i,onChange:w=>{a(w.target.value),u(null),p([])},children:[e.jsx("option",{value:"",children:"Please select"}),C.map(w=>e.jsx("option",{value:w,children:w},w))]})]}),i&&e.jsxs(e.Fragment,{children:[e.jsx(Ct,{formData:n,setFormData:l}),e.jsxs("button",{onClick:f,disabled:!i||o,className:"w-full py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[o&&e.jsx(J,{className:"w-4 h-4 animate-spin"}),o?"Analyzing...":"Determine Suggested Action"]}),y.length>0&&e.jsx("div",{className:"space-y-2",children:y.map((w,P)=>e.jsxs("div",{className:"p-3 bg-red-100 border border-red-300 rounded-md flex items-center gap-2 text-red-700",children:[e.jsx(A,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm font-medium",children:w})]},P))}),c&&e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsx("h4",{className:"text-md font-semibold text-gray-700",children:"Suggested Action:"}),e.jsx(St,{aiTriageResult:c})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Guideline Details"}),v?e.jsx(Nt,{guideline:{condition:v.pathwayName,urgency:v.urgencyLevel,criteria:v.requiredInformation.clinical,workup:[...v.aiTriageFactors.highRiskFactors.map(w=>`High Risk: ${w}`),...v.aiTriageFactors.moderateRiskFactors.map(w=>`Moderate Risk: ${w}`)]}},v.id):e.jsx("div",{className:"p-4 text-center text-gray-500 bg-gray-50 rounded-lg",children:"Select a cancer type to view guideline details."})]})]})]})}const _t=[{type:"breast",label:"Breast Cancer",icon:"🎀"},{type:"lung",label:"Lung Cancer",icon:"🫁"},{type:"colorectal",label:"Colorectal Cancer",icon:"🎯"}],Tt=({onSelect:t,selected:s})=>e.jsx("div",{className:"grid grid-cols-3 gap-4",children:_t.map(({type:i,label:a,icon:n})=>e.jsxs(k.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:`p-4 rounded-lg ${s===i?"bg-blue-100 border-blue-500":"bg-gray-50"} border-2 flex flex-col items-center`,onClick:()=>t(i),children:[e.jsx("span",{className:"text-2xl mb-2",children:n}),e.jsx("span",{className:"text-sm font-medium",children:a})]},i))}),It={first_visit:Me,imaging:Ci,biopsy:Ni,histopathology:wi,molecular:Fe,final:bi},Pt={first_visit:"First Visit",imaging:"Imaging",biopsy:"Biopsy",histopathology:"Histopathology",molecular:"Molecular Testing",final:"Final Diagnosis"},At=({events:t})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Me,{className:"w-5 h-5 text-indigo-600"}),"Diagnostic Timeline"]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-4 top-0 bottom-0 w-0.5 bg-gray-200"}),e.jsx("div",{className:"space-y-6",children:t.map((s,i)=>{const a=It[s.type];return e.jsxs(k.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:i*.1},className:"relative flex items-start gap-4 pl-8",children:[e.jsx("div",{className:`absolute left-0 p-1 rounded-full bg-white ring-2 ${s.status==="completed"?"ring-green-500":s.status==="scheduled"?"ring-blue-500":"ring-gray-300"}`,children:e.jsx(a,{className:`w-4 h-4 ${s.status==="completed"?"text-green-500":s.status==="scheduled"?"text-blue-500":"text-gray-400"}`})}),e.jsx("div",{className:"flex-1 bg-white rounded-lg border p-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:Pt[s.type]}),e.jsx("p",{className:"text-sm text-gray-600",children:s.detail})]}),e.jsx("time",{className:"text-sm text-gray-500",children:s.date})]})})]},s.type)})})]})]});Si.register(ji,ki,_i,Ti,Ii,Pi,Ai);const Et=({data:t})=>{const s={labels:t.map(a=>new Date(a.date).toLocaleDateString()),datasets:[{label:"ECOG Score",data:t.map(a=>a.ecog),borderColor:"rgb(79, 70, 229)",backgroundColor:"rgba(79, 70, 229, 0.1)",yAxisID:"y"},{label:"KPS Score",data:t.map(a=>a.kps),borderColor:"rgb(16, 185, 129)",backgroundColor:"rgba(16, 185, 129, 0.1)",yAxisID:"y1"}]},i={responsive:!0,interaction:{mode:"index",intersect:!1},scales:{y:{type:"linear",display:!0,position:"left",title:{display:!0,text:"ECOG Score"},min:0,max:4,grid:{color:"rgba(0, 0, 0, 0.1)"}},y1:{type:"linear",display:!0,position:"right",title:{display:!0,text:"KPS Score"},min:0,max:100,grid:{drawOnChartArea:!1}}},plugins:{legend:{position:"top"},title:{display:!0,text:"Performance Status Trends"}}};return e.jsxs("div",{className:"p-4 bg-white rounded-lg border",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Performance Score Trends"}),e.jsx("div",{className:"h-64",children:e.jsx(ii,{options:i,data:s})}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-4 text-sm text-gray-600",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"ECOG Score Interpretation:"}),e.jsxs("ul",{className:"list-disc list-inside",children:[e.jsx("li",{children:"0: Fully active"}),e.jsx("li",{children:"1: Restricted but ambulatory"}),e.jsx("li",{children:"2: Ambulatory, capable of self-care"}),e.jsx("li",{children:"3: Limited self-care"}),e.jsx("li",{children:"4: Completely disabled"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"KPS Score Interpretation:"}),e.jsxs("ul",{className:"list-disc list-inside",children:[e.jsx("li",{children:"100-90: Normal activity"}),e.jsx("li",{children:"80-70: Normal activity with effort"}),e.jsx("li",{children:"60-50: Occasional assistance needed"}),e.jsx("li",{children:"40-30: Disabled, special care needed"}),e.jsx("li",{children:"20-10: Very sick, hospitalization"})]})]})]})]})},Rt=({cancerType:t,stage:s,tnmStage:i,diagnosisDate:a,currentECOG:n,currentKPS:l,onGenerate:c,followUpPlan:u})=>{const[y,p]=g.useState(""),[o,h]=g.useState(!1),C=async()=>{h(!0);try{const f=await c();p(f)}catch(f){console.error("Error generating summary:",f)}finally{h(!1)}},v=()=>{const f=document.createElement("a"),S=new Blob([y],{type:"text/markdown"});f.href=URL.createObjectURL(S),f.download=`follow-up-summary-${new Date().toISOString().split("T")[0]}.md`,document.body.appendChild(f),f.click(),document.body.removeChild(f)};return e.jsxs(k.div,{className:"p-4 bg-white rounded-lg border shadow-sm",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5 text-indigo-600"}),"Smart Follow-Up Summary"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:C,disabled:o,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-50 flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4"}),o?"Generating...":"Generate Summary"]}),y&&e.jsxs("button",{onClick:v,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4"}),"Export"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-600",children:["Cancer Type: ",e.jsx("span",{className:"font-medium text-gray-900",children:t})]}),e.jsxs("p",{className:"text-gray-600",children:["Stage: ",e.jsx("span",{className:"font-medium text-gray-900",children:s})]}),e.jsxs("p",{className:"text-gray-600",children:["TNM: ",e.jsxs("span",{className:"font-medium text-gray-900",children:["T",i.t,"N",i.n,"M",i.m]})]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-600",children:["Diagnosis Date: ",e.jsx("span",{className:"font-medium text-gray-900",children:new Date(a).toLocaleDateString()})]}),e.jsxs("p",{className:"text-gray-600",children:["Current ECOG: ",e.jsx("span",{className:"font-medium text-gray-900",children:n})]}),e.jsxs("p",{className:"text-gray-600",children:["Current KPS: ",e.jsx("span",{className:"font-medium text-gray-900",children:l})]})]})]}),y&&e.jsx("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg prose prose-sm max-w-none",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:y}})}),!y&&!o&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:'Click "Generate Summary" to create a comprehensive follow-up summary based on current patient data'}),o&&e.jsx("div",{className:"text-center py-8 text-gray-500 animate-pulse",children:"Generating comprehensive follow-up summary..."})]})},Dt={breast:[{type:"first_visit",date:"2025-03-15",detail:"Initial consultation for breast lump",status:"completed"},{type:"imaging",date:"2025-03-18",detail:"Mammogram and breast ultrasound",status:"completed"},{type:"biopsy",date:"2025-03-22",detail:"Core needle biopsy performed",status:"completed"},{type:"histopathology",date:"2025-03-28",detail:"Invasive ductal carcinoma confirmed",status:"completed"},{type:"molecular",date:"2025-04-02",detail:"ER+/PR+, HER2-, Ki-67 25%",status:"completed"},{type:"final",date:"2025-04-05",detail:"Stage IIA (T2N0M0) breast cancer diagnosis",status:"completed"}],lung:[{type:"first_visit",date:"2025-03-10",detail:"Referral for persistent cough and weight loss",status:"completed"},{type:"imaging",date:"2025-03-12",detail:"Chest CT showing RUL mass",status:"completed"},{type:"biopsy",date:"2025-03-16",detail:"CT-guided needle biopsy",status:"completed"},{type:"histopathology",date:"2025-03-20",detail:"Non-small cell lung cancer (adenocarcinoma)",status:"completed"},{type:"molecular",date:"2025-03-25",detail:"Pending molecular testing results",status:"scheduled"},{type:"final",date:"2025-03-28",detail:"Awaiting complete staging workup",status:"pending"}]},Ft={breast:[{date:"2025-03-15",ecog:0,kps:100},{date:"2025-03-28",ecog:0,kps:90},{date:"2025-04-10",ecog:1,kps:80},{date:"2025-04-25",ecog:1,kps:80},{date:"2025-05-01",ecog:0,kps:90}],lung:[{date:"2025-03-10",ecog:1,kps:80},{date:"2025-03-24",ecog:1,kps:70},{date:"2025-04-07",ecog:2,kps:60},{date:"2025-04-21",ecog:1,kps:70},{date:"2025-05-01",ecog:1,kps:80}]},Mt={breast:{metadata:{version:"1.0.0",lastUpdated:"2024-01-20"},intervals:{curative:{"3mo":[{title:"Clinical breast exam",frequency:"Every 3-4 months for 3 years"},{title:"Review symptoms",frequency:"Every visit"}],"6mo":[{title:"Mammogram",frequency:"Every 6-12 months"},{title:"Blood tests",frequency:"As clinically indicated"}],"1yr":[],"2yr":[],"5yr":[]},palliative:{"3mo":[{title:"Symptom assessment",frequency:"Every visit"},{title:"Pain evaluation",frequency:"Every visit"}],"6mo":[],"1yr":[],"2yr":[],"5yr":[]}},stageGuidelines:{early:{surveillance:[{title:"Mammogram",frequency:"Every 12 months",duration:"5 years"},{title:"Clinical exam",frequency:"Every 3-4 months",duration:"2 years"}],imaging:[{title:"Breast MRI",frequency:"As indicated"}],labTests:[{title:"Blood tests",frequency:"As clinically indicated"}]},advanced:{surveillance:[{title:"CT scan",frequency:"Every 6 months",duration:"2 years"},{title:"Bone scan",frequency:"As clinically indicated"}],imaging:[{title:"PET scan",frequency:"As clinically indicated"}],labTests:[{title:"Tumor markers",frequency:"As clinically indicated"}]}},surveillance:{investigations:[],examinations:[]},redFlags:[{symptom:"New breast lumps",severity:"urgent",action:"Immediate referral"},{symptom:"Bone pain",severity:"warning",action:"Further investigation"},{symptom:"Persistent cough",severity:"warning",action:"Further investigation"},{symptom:"Unexplained weight loss",severity:"warning",action:"Further investigation"}],urgentFlags:[],qolTopics:[{topic:"Lymphedema",description:"Swelling in arm or breast",recommendations:["Exercise","Compression garments","Specialist referral"],applicableStages:["early","advanced"]}],commonSymptoms:[{symptom:"Fatigue",severity:"medium"},{symptom:"Arm swelling",severity:"medium"},{symptom:"Hot flashes",severity:"low"}]},lung:{metadata:{version:"1.0.0",lastUpdated:"2024-01-20"},intervals:{curative:{"3mo":[{title:"Chest CT",frequency:"Every 3-6 months for 2 years"},{title:"Physical exam",frequency:"Every 3 months"}],"6mo":[],"1yr":[],"2yr":[],"5yr":[]},palliative:{"3mo":[],"6mo":[],"1yr":[],"2yr":[],"5yr":[]}},stageGuidelines:{early:{surveillance:[{title:"Chest X-ray",frequency:"Every 6 months",duration:"2 years"}],imaging:[{title:"CT scan",frequency:"As clinically indicated"}],labTests:[{title:"Blood tests",frequency:"As clinically indicated"}]},advanced:{surveillance:[{title:"PET scan",frequency:"As clinically indicated"}],imaging:[{title:"MRI",frequency:"As clinically indicated"}],labTests:[{title:"Tumor markers",frequency:"As clinically indicated"}]}},surveillance:{investigations:[],examinations:[]},redFlags:[{symptom:"New cough",severity:"urgent",action:"Immediate referral"},{symptom:"Hemoptysis",severity:"urgent",action:"Immediate referral"},{symptom:"Shortness of breath",severity:"warning",action:"Further investigation"}],urgentFlags:[],qolTopics:[{topic:"Smoking cessation",description:"Support to quit smoking",recommendations:["Counseling","Nicotine replacement","Medications"],applicableStages:["early","advanced"]}],commonSymptoms:[{symptom:"Cough",severity:"medium"},{symptom:"Shortness of breath",severity:"high"},{symptom:"Chest pain",severity:"medium"}]},colorectal:{metadata:{version:"1.0.0",lastUpdated:"2024-01-20"},intervals:{curative:{"3mo":[{title:"CEA test",frequency:"Every 3-6 months for 5 years"},{title:"CT scan",frequency:"Every 6-12 months for 5 years"}],"6mo":[],"1yr":[],"2yr":[],"5yr":[]},palliative:{"3mo":[],"6mo":[],"1yr":[],"2yr":[],"5yr":[]}},stageGuidelines:{early:{surveillance:[{title:"Colonoscopy",frequency:"Every 1 year",duration:"5 years"}],imaging:[{title:"CT scan",frequency:"As clinically indicated"}],labTests:[{title:"Blood tests",frequency:"As clinically indicated"}]},advanced:{surveillance:[{title:"PET scan",frequency:"As clinically indicated"}],imaging:[{title:"MRI",frequency:"As clinically indicated"}],labTests:[{title:"Tumor markers",frequency:"As clinically indicated"}]}},surveillance:{investigations:[],examinations:[]},redFlags:[{symptom:"Rectal bleeding",severity:"urgent",action:"Immediate referral"},{symptom:"Abdominal pain",severity:"warning",action:"Further investigation"},{symptom:"Change in bowel habits",severity:"warning",action:"Further investigation"}],urgentFlags:[],qolTopics:[{topic:"Dietary advice",description:"Nutritional support",recommendations:["High fiber diet","Hydration","Specialist referral"],applicableStages:["early","advanced"]}],commonSymptoms:[{symptom:"Fatigue",severity:"medium"},{symptom:"Abdominal pain",severity:"high"},{symptom:"Weight loss",severity:"medium"}]},prostate:{metadata:{version:"1.0.0",lastUpdated:"2024-01-20"},intervals:{curative:{"3mo":[{title:"PSA test",frequency:"Every 3 months for 2 years"}],"6mo":[{title:"Physical exam",frequency:"Every 6 months"}],"1yr":[],"2yr":[],"5yr":[]},palliative:{"3mo":[],"6mo":[],"1yr":[],"2yr":[],"5yr":[]}},stageGuidelines:{early:{surveillance:[{title:"PSA test",frequency:"Every 6 months",duration:"5 years"}],imaging:[{title:"MRI",frequency:"As clinically indicated"}],labTests:[{title:"Blood tests",frequency:"As clinically indicated"}]},advanced:{surveillance:[{title:"Bone scan",frequency:"As clinically indicated"}],imaging:[{title:"CT scan",frequency:"As clinically indicated"}],labTests:[{title:"Tumor markers",frequency:"As clinically indicated"}]}},surveillance:{investigations:[],examinations:[]},redFlags:[{symptom:"Urinary retention",severity:"urgent",action:"Immediate referral"},{symptom:"Bone pain",severity:"warning",action:"Further investigation"},{symptom:"Weight loss",severity:"warning",action:"Further investigation"}],urgentFlags:[],qolTopics:[{topic:"Sexual health",description:"Support for sexual health",recommendations:["Counseling","Medications","Specialist referral"],applicableStages:["early","advanced"]}],commonSymptoms:[{symptom:"Fatigue",severity:"medium"},{symptom:"Urinary issues",severity:"high"},{symptom:"Erectile dysfunction",severity:"medium"}]},pancreatic:{metadata:{version:"1.0.0",lastUpdated:"2024-01-20"},intervals:{curative:{"3mo":[{title:"CA 19-9",frequency:"Every 3 months",duration:"2 years"},{title:"CT abdomen",frequency:"Every 3-6 months",duration:"2 years"}],"6mo":[],"1yr":[],"2yr":[],"5yr":[]},palliative:{"3mo":[],"6mo":[],"1yr":[],"2yr":[],"5yr":[]}},stageGuidelines:{early:{surveillance:[{title:"CA 19-9",frequency:"Every 3 months",duration:"2 years"}],imaging:[{title:"CT scan",frequency:"As clinically indicated"}],labTests:[{title:"Blood tests",frequency:"As clinically indicated"}]},advanced:{surveillance:[{title:"PET scan",frequency:"As clinically indicated"}],imaging:[{title:"MRI",frequency:"As clinically indicated"}],labTests:[{title:"Tumor markers",frequency:"As clinically indicated"}]}},surveillance:{investigations:[],examinations:[]},redFlags:[{symptom:"Jaundice",severity:"urgent",action:"Immediate referral"},{symptom:"Abdominal pain",severity:"warning",action:"Further investigation"},{symptom:"Weight loss",severity:"warning",action:"Further investigation"}],urgentFlags:[],qolTopics:[{topic:"Nutritional support",description:"Support for maintaining nutrition",recommendations:["High calorie diet","Enzyme supplements","Specialist referral"],applicableStages:["early","advanced"]}],commonSymptoms:[{symptom:"Fatigue",severity:"medium"},{symptom:"Abdominal pain",severity:"high"},{symptom:"Weight loss",severity:"medium"}]},esophageal:{metadata:{version:"1.0.0",lastUpdated:"2024-01-20"},intervals:{curative:{"3mo":[{title:"CT chest/abdomen",frequency:"Every 3-6 months",duration:"2 years"},{title:"Endoscopy",frequency:"Every 6 months",duration:"2 years"}],"6mo":[{title:"Physical exam",frequency:"Every 6 months",duration:"3 years"},{title:"Nutritional assessment",frequency:"Every 6 months"}],"1yr":[],"2yr":[],"5yr":[]},palliative:{"3mo":[{title:"Symptom assessment",frequency:"Every 3 months"},{title:"Weight monitoring",frequency:"Every visit"}],"6mo":[],"1yr":[],"2yr":[],"5yr":[]}},stageGuidelines:{early:{surveillance:[],imaging:[],labTests:[]},advanced:{surveillance:[],imaging:[],labTests:[]}},surveillance:{investigations:[],examinations:[]},redFlags:[{symptom:"Progressive dysphagia",severity:"urgent",action:"Immediate evaluation"},{symptom:"Weight loss > 5%",severity:"warning",action:"Early review"}],urgentFlags:[],qolTopics:[{topic:"Nutrition",description:"Managing eating difficulties and maintaining weight",recommendations:["Small frequent meals","Soft diet when needed"],applicableStages:["early","advanced"]}],commonSymptoms:[{symptom:"Swallowing difficulty",severity:"high",relatedFlags:["Progressive dysphagia"]}]},bladder:{metadata:{version:"1.0.0",lastUpdated:"2024-01-20"},intervals:{curative:{"3mo":[],"6mo":[],"1yr":[],"2yr":[],"5yr":[]},palliative:{"3mo":[],"6mo":[],"1yr":[],"2yr":[],"5yr":[]}},stageGuidelines:{early:{surveillance:[],imaging:[],labTests:[]},advanced:{surveillance:[],imaging:[],labTests:[]}},surveillance:{investigations:[],examinations:[]},redFlags:[],urgentFlags:[],qolTopics:[],commonSymptoms:[]},headneck:{metadata:{version:"1.0.0",lastUpdated:"2024-01-20"},intervals:{curative:{"3mo":[],"6mo":[],"1yr":[],"2yr":[],"5yr":[]},palliative:{"3mo":[],"6mo":[],"1yr":[],"2yr":[],"5yr":[]}},stageGuidelines:{early:{surveillance:[],imaging:[],labTests:[]},advanced:{surveillance:[],imaging:[],labTests:[]}},surveillance:{investigations:[],examinations:[]},redFlags:[],urgentFlags:[],qolTopics:[],commonSymptoms:[]},ovarian:{metadata:{version:"1.0.0",lastUpdated:"2024-01-20"},intervals:{curative:{"3mo":[],"6mo":[],"1yr":[],"2yr":[],"5yr":[]},palliative:{"3mo":[],"6mo":[],"1yr":[],"2yr":[],"5yr":[]}},stageGuidelines:{early:{surveillance:[],imaging:[],labTests:[]},advanced:{surveillance:[],imaging:[],labTests:[]}},surveillance:{investigations:[],examinations:[]},redFlags:[],urgentFlags:[],qolTopics:[],commonSymptoms:[]},gastric:{metadata:{version:"1.0.0",lastUpdated:"2024-01-20"},intervals:{curative:{"3mo":[],"6mo":[],"1yr":[],"2yr":[],"5yr":[]},palliative:{"3mo":[],"6mo":[],"1yr":[],"2yr":[],"5yr":[]}},stageGuidelines:{early:{surveillance:[],imaging:[],labTests:[]},advanced:{surveillance:[],imaging:[],labTests:[]}},surveillance:{investigations:[],examinations:[]},redFlags:[],urgentFlags:[],qolTopics:[],commonSymptoms:[]},lymphoma:{metadata:{version:"1.0.0",lastUpdated:"2024-01-20"},intervals:{curative:{"3mo":[],"6mo":[],"1yr":[],"2yr":[],"5yr":[]},palliative:{"3mo":[],"6mo":[],"1yr":[],"2yr":[],"5yr":[]}},stageGuidelines:{early:{surveillance:[],imaging:[],labTests:[]},advanced:{surveillance:[],imaging:[],labTests:[]}},surveillance:{investigations:[],examinations:[]},redFlags:[],urgentFlags:[],qolTopics:[],commonSymptoms:[]},melanoma:{metadata:{version:"1.0.0",lastUpdated:"2024-01-20"},intervals:{curative:{"3mo":[],"6mo":[],"1yr":[],"2yr":[],"5yr":[]},palliative:{"3mo":[],"6mo":[],"1yr":[],"2yr":[],"5yr":[]}},stageGuidelines:{early:{surveillance:[],imaging:[],labTests:[]},advanced:{surveillance:[],imaging:[],labTests:[]}},surveillance:{investigations:[],examinations:[]},redFlags:[],urgentFlags:[],qolTopics:[],commonSymptoms:[]},thyroid:{metadata:{version:"1.0.0",lastUpdated:"2024-01-20"},intervals:{curative:{"3mo":[],"6mo":[],"1yr":[],"2yr":[],"5yr":[]},palliative:{"3mo":[],"6mo":[],"1yr":[],"2yr":[],"5yr":[]}},stageGuidelines:{early:{surveillance:[],imaging:[],labTests:[]},advanced:{surveillance:[],imaging:[],labTests:[]}},surveillance:{investigations:[],examinations:[]},redFlags:[],urgentFlags:[],qolTopics:[],commonSymptoms:[]},hepatocellular:{metadata:{version:"1.0.0",lastUpdated:"2024-01-20"},intervals:{curative:{"3mo":[],"6mo":[],"1yr":[],"2yr":[],"5yr":[]},palliative:{"3mo":[],"6mo":[],"1yr":[],"2yr":[],"5yr":[]}},stageGuidelines:{early:{surveillance:[],imaging:[],labTests:[]},advanced:{surveillance:[],imaging:[],labTests:[]}},surveillance:{investigations:[],examinations:[]},redFlags:[],urgentFlags:[],qolTopics:[],commonSymptoms:[]},testicular:{metadata:{version:"1.0.0",lastUpdated:"2024-01-20"},intervals:{curative:{"3mo":[],"6mo":[],"1yr":[],"2yr":[],"5yr":[]},palliative:{"3mo":[],"6mo":[],"1yr":[],"2yr":[],"5yr":[]}},stageGuidelines:{early:{surveillance:[],imaging:[],labTests:[]},advanced:{surveillance:[],imaging:[],labTests:[]}},surveillance:{investigations:[],examinations:[]},redFlags:[],urgentFlags:[],qolTopics:[],commonSymptoms:[]},brain:{metadata:{version:"1.0.0",lastUpdated:"2024-01-20"},intervals:{curative:{"3mo":[],"6mo":[],"1yr":[],"2yr":[],"5yr":[]},palliative:{"3mo":[],"6mo":[],"1yr":[],"2yr":[],"5yr":[]}},stageGuidelines:{early:{surveillance:[],imaging:[],labTests:[]},advanced:{surveillance:[],imaging:[],labTests:[]}},surveillance:{investigations:[],examinations:[]},redFlags:[],urgentFlags:[],qolTopics:[],commonSymptoms:[]},sarcoma:{metadata:{version:"1.0.0",lastUpdated:"2024-01-20"},intervals:{curative:{"3mo":[],"6mo":[],"1yr":[],"2yr":[],"5yr":[]},palliative:{"3mo":[],"6mo":[],"1yr":[],"2yr":[],"5yr":[]}},stageGuidelines:{early:{surveillance:[],imaging:[],labTests:[]},advanced:{surveillance:[],imaging:[],labTests:[]}},surveillance:{investigations:[],examinations:[]},redFlags:[],urgentFlags:[],qolTopics:[],commonSymptoms:[]}},qt=(t,s)=>{var l;const i=[],a=[];return["intervals","surveillance","redFlags","urgentFlags","qolTopics","commonSymptoms"].forEach(c=>{t[c]||i.push(`Missing required section: ${c}`)}),(l=t.metadata)!=null&&l.version||i.push("Missing template version"),Object.entries(t.intervals).forEach(([c,u])=>{Object.keys(u).length===0&&i.push(`No follow-up intervals defined for ${c} intent`)}),t.commonSymptoms.forEach(c=>{["low","medium","high"].includes(c.severity)||i.push(`Invalid severity for symptom: ${c.symptom}`)}),t.redFlags.forEach(c=>{t.commonSymptoms.some(u=>{var y;return(y=u.relatedFlags)==null?void 0:y.includes(c.symptom)})||a.push(`Red flag "${c.symptom}" not linked to any common symptoms`)}),t.qolTopics.length===0&&i.push("No quality of life topics defined"),{isValid:i.length===0,errors:i,warnings:a}},re=t=>({"3m":"3 months","6m":"6 months","1y":"1 year"})[t]||t,Ot=(t,s,i)=>{const a=Mt[t],{isValid:n,errors:l}=qt(a);if(!n)throw console.error(`Template validation failed for ${t}:`,l),new Error("Invalid follow-up template");const c=`${s.t}${s.n}${s.m}`,u=a.stageGuidelines[c],y=[...((u==null?void 0:u.surveillance)||[]).map(o=>({frequency:o.frequency})),...((u==null?void 0:u.imaging)||[]).map(o=>({frequency:o.frequency})),...((u==null?void 0:u.labTests)||[]).map(o=>({frequency:o.frequency}))],p=a.intervals[i]||{};return{timeline:Object.entries(p).map(([o,h])=>({interval:re(o),actions:h.map(C=>`${C.title} (${re(C.frequency)})`),guidelines:y.map(C=>re(C.frequency))})),surveillance:{investigations:a.surveillance.investigations.map(o=>({...o,isDue:!1})),examinations:a.surveillance.examinations.map(o=>({...o,isDue:!1}))},redFlags:a.redFlags.map(o=>o.symptom),urgentFlags:a.urgentFlags.map(o=>o.condition),qolTopics:a.qolTopics,commonSymptoms:a.commonSymptoms}},be=1,Lt=1e3;class oe extends Error{constructor(s,i,a){super(s),this.statusCode=i,this.details=a,this.name="AIAssistantError"}}const Bt=t=>new Promise(s=>setTimeout(s,t));async function Ut(t){let s;for(let i=0;i<=be;i++)try{i>0&&await Bt(Lt);const a=await fetch("/api/ai/generate-summary",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok){const l=await a.json();throw a.status===429?new oe("Rate limit exceeded. Please try again later.",429):new oe(l.error||"Failed to generate summary",a.status,l.details)}return(await a.json()).summary}catch(a){if(console.error(`AI Summary Generation Error (Attempt ${i+1}/${be+1}):`,a),s=a,a.statusCode===429||a.statusCode===400)throw a}throw s||new oe("Failed to generate summary after retries")}const Gt=({cancerType:t,stage:s,intent:i,plan:a,onInsightsReady:n})=>{const[l,c]=g.useState(!1),[u,y]=g.useState(null),[p,o]=g.useState(null);g.useEffect(()=>{async function C(){if(a){c(!0),y(null),o(null);try{const v=`
Cancer Type: ${t}
Disease Stage: ${s}
Treatment Intent: ${i}

Follow-up Plan:
Timeline: ${a.timeline.map(S=>`${S.interval}: ${S.actions.join(", ")}`).join(`
`)}

Surveillance:
Investigations: ${a.surveillance.investigations.map(S=>S.title).join(", ")}
Examinations: ${a.surveillance.examinations.map(S=>S.title).join(", ")}

Red Flags to Monitor: ${a.redFlags.join(", ")}
Urgent Flags: ${a.urgentFlags.join(", ")}

Quality of Life Topics: ${a.qolTopics.map(S=>S.topic).join(", ")}
Common Symptoms to Monitor: ${a.commonSymptoms.map(S=>S.symptom).join(", ")}
`,f=await Ut({prompt:"Review this oncology follow-up plan and provide enhanced recommendations. Consider surveillance frequency, symptom monitoring, quality of life aspects, and potential areas needing closer monitoring. Suggest any additional screenings or monitoring based on current guidelines.",context:v});o(f),n&&n(f),H({title:"AI Follow-up Insights",description:f,duration:1e4})}catch(v){console.error("AI Analysis Error:",v),y(v.message||"Failed to analyze follow-up plan"),H({title:"AI Analysis Failed",description:"Unable to provide AI insights at this time. Using standard follow-up plan.",variant:"destructive"})}finally{c(!1)}}}C()},[t,s,i,a,n]);const h=()=>{if(!p)return;const C=new Blob([p],{type:"text/markdown"}),v=URL.createObjectURL(C),f=document.createElement("a");f.href=v,f.download=`followup-summary-${t}.md`,f.click(),URL.revokeObjectURL(v)};return l?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-indigo-600 dark:text-indigo-300 animate-pulse",children:[e.jsx(J,{className:"w-4 h-4 animate-spin"}),"AI analyzing follow-up plan..."]}):u?e.jsx("div",{className:"text-sm text-red-600 dark:text-red-400",children:u}):p?e.jsxs("div",{className:"mt-2 flex flex-col gap-2",children:[e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none border rounded p-2 bg-gray-50 dark:bg-gray-800",children:e.jsx("pre",{className:"whitespace-pre-wrap text-xs",children:p})}),e.jsxs(Hi,{variant:"outline",size:"sm",onClick:h,className:"self-end flex items-center gap-1",title:"Export summary as Markdown",children:[e.jsx(ge,{className:"w-4 h-4"})," Export Markdown"]})]}):null};function Ht(t,s){return s in t}function we(t,s){return Ht(t,s)?t[s]:void 0}const Ye=()=>{const[t,s]=g.useState(!1),[i,a]=g.useState(null),[n,l]=g.useState({t:"",n:"",m:""}),[c,u]=g.useState("curative"),[y,p]=g.useState(!1),[o,h]=g.useState(null),[C,v]=g.useState(null);return g.useEffect(()=>{if(i){p(!0);try{const f=Ot(i,n,c);h(f)}catch{H({title:"Error",description:"Failed to generate follow-up plan. Please try again.",variant:"destructive"})}finally{p(!1)}}},[i,n,c]),e.jsx(Oe,{children:e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-200",children:"Follow-up Oncology"}),e.jsx("button",{onClick:()=>s(!t),className:`px-3 py-1 rounded-full text-sm font-medium ${t?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:t?"🧪 Mock Mode":"🤖 Gemini Mode"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx(k.div,{className:"p-4 bg-white dark:bg-gray-800 rounded-lg shadow",initial:{opacity:0},animate:{opacity:1},children:e.jsx(Tt,{selected:i,onSelect:a})}),i&&!y&&e.jsxs(e.Fragment,{children:[e.jsx(k.div,{className:"p-4 bg-white dark:bg-gray-800 rounded-lg shadow",initial:{opacity:0},animate:{opacity:1},children:e.jsxs(te,{className:"dark:bg-gray-900 shadow-lg",children:[e.jsx(se,{children:e.jsx(ae,{children:e.jsx(M,{children:e.jsxs(q,{children:[e.jsx(O,{asChild:!0,children:e.jsx("span",{children:"Diagnostic Timeline"})}),e.jsx(D,{children:e.jsx("p",{children:"Key milestones in the diagnostic journey"})})]})})})}),e.jsx(ne,{children:e.jsx(At,{events:we(Dt,i)||[]})})]})}),e.jsx(k.div,{className:"lg:col-span-2 p-4 bg-white dark:bg-gray-800 rounded-lg shadow",initial:{opacity:0},animate:{opacity:1},children:e.jsxs(te,{className:"dark:bg-gray-900 shadow-lg",children:[e.jsx(se,{children:e.jsx(ae,{children:e.jsx(M,{children:e.jsxs(q,{children:[e.jsx(O,{asChild:!0,children:e.jsx("span",{children:"Performance Score Trends"})}),e.jsx(D,{children:e.jsx("p",{children:"ECOG and KPS scores over time"})})]})})})}),e.jsx(ne,{children:e.jsx(Et,{data:we(Ft,i)||[]})})]})}),e.jsx(k.div,{className:"lg:col-span-2 p-4 bg-white dark:bg-gray-800 rounded-lg shadow",initial:{opacity:0},animate:{opacity:1},children:e.jsxs(te,{className:"dark:bg-gray-900 shadow-lg",children:[e.jsx(se,{children:e.jsx(ae,{children:e.jsx(M,{children:e.jsxs(q,{children:[e.jsx(O,{asChild:!0,children:e.jsx("span",{children:"Smart Follow-Up Summary"})}),e.jsx(D,{children:e.jsx("p",{children:"AI-generated follow-up summary and recommendations"})})]})})})}),e.jsxs(ne,{children:[e.jsx(Rt,{cancerType:i,stage:`${n.t}${n.n}${n.m}`,tnmStage:n,diagnosisDate:"2025-04-01",currentECOG:0,currentKPS:90,onGenerate:async()=>{try{return(await pe({module:"OPD",intent:"follow-up",prompt:"Generate a follow-up summary and recommendations",context:`Cancer Type: ${i}
Stage: ${n.t}${n.n}${n.m}
Intent: ${c}`,mockMode:t})).content}catch(f){throw console.error("Error generating AI summary:",f),f}}}),e.jsx(Gt,{cancerType:i,stage:n,intent:"follow-up",plan:o,onInsightsReady:v})]})]})})]}),y&&e.jsx(k.div,{className:"flex justify-center items-center p-12",initial:{opacity:0},animate:{opacity:1},children:e.jsxs("div",{className:"animate-pulse flex space-x-4",children:[e.jsx("div",{className:"h-12 w-12 bg-gray-200 dark:bg-gray-700 rounded-full"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-24"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-32"})]})]})})]})]})})},Ne=[{label:"Patient Evaluation",icon:Ei,component:tt,card:Xi},{label:"Diagnostic Pathways",icon:Ri,component:$e,card:Ji},{label:"Cancer Screening",icon:Di,component:ze,card:Qi},{label:"Referral Guidelines",icon:Fi,component:Ke,card:Zi},{label:"Follow-Up Oncology",icon:Mi,component:Ye,card:et}],$t=()=>{const t={age:58,gender:"female",chiefComplaint:"Persistent cough and weight loss",riskFactors:["Smoking history","Family history of lung cancer"]};return e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-8 flex items-center gap-2",children:"🏥 Oncology OPD Module"}),e.jsxs(U.Group,{children:[e.jsx(U.List,{className:"flex space-x-2 mb-8",children:Ne.map(({label:s,icon:i})=>e.jsxs(U,{className:({selected:a})=>`
                opd-tab flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all
                ${a?"bg-gradient-to-r from-purple-600 to-indigo-600 text-white shadow-md scale-[1.02]":"bg-white text-gray-700 hover:bg-gray-50 hover:text-indigo-600"}
              `,children:[e.jsx(i,{className:"w-4 h-4"}),s]},s))}),e.jsx(U.Panels,{children:Ne.map(({label:s,component:i,card:a})=>e.jsx(U.Panel,{children:e.jsxs(a,{children:[e.jsx(i,{}),e.jsx(it,{patientData:t,isEnabled:!0})]})},s))})]})]})},Vt=({children:t})=>e.jsx("div",{className:"opd-module",children:e.jsx("div",{className:"opd-content p-6",children:e.jsx("div",{className:"max-w-5xl mx-auto",children:t})})}),zt=({template:t,formData:s})=>{const i=t.sections.flatMap((n,l)=>n.items.map((c,u)=>({item:c,id:`section-${l}-item-${u}`}))).filter(({item:n,id:l})=>n.required&&(!s[l]||s[l].trim()==="")),a=i.length===0;return e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Evaluation Summary"}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a?e.jsx(X,{className:"w-5 h-5 text-green-500"}):e.jsx(A,{className:"w-5 h-5 text-amber-500"}),e.jsx("span",{className:a?"text-green-700":"text-amber-700",children:a?"All required fields are completed":`${i.length} required field(s) need attention`})]}),!a&&e.jsx("div",{className:"mt-2 pl-7",children:e.jsx("ul",{className:"list-disc text-sm text-amber-700",children:i.map(({item:n,id:l})=>e.jsx("li",{children:n.text},l))})}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(A,{className:"w-5 h-5 text-red-500"}),e.jsx("span",{className:"text-red-700 font-medium",children:"Red Flag Checks"})]}),e.jsx("ul",{className:"pl-7 list-disc text-sm text-red-700 space-y-1",children:t.redFlags.map((n,l)=>e.jsx("li",{children:n},l))})]})]})},Kt={breast:{sections:[{title:"Clinical Presentation",items:[{text:"Breast Mass Characteristics",tooltip:"Size, location, mobility, skin changes, nipple changes",required:!0,redFlags:["Skin ulceration","Peau d'orange","Fixed mass"]},{text:"Lymph Node Status",tooltip:"Axillary, supraclavicular, cervical nodes",required:!0}],cancerSpecificNotes:["Document distance from nipple","Check for bilateral findings"]},{title:"Risk Assessment",items:[{text:"Family History",tooltip:"First-degree relatives with breast/ovarian cancer, age at diagnosis",required:!0,redFlags:["Multiple affected relatives","Young age at diagnosis"]},{text:"Genetic Factors",tooltip:"Known BRCA status, other genetic syndromes",required:!1}]}],notes:["Consider mammogram ± ultrasound for imaging","Assess BIRADS category if imaging available","Consider genetic counseling if strong family history"],redFlags:["Inflammatory breast cancer signs","Nipple discharge/retraction","Axillary lymphadenopathy"]},lung:{sections:[{title:"Respiratory Symptoms",items:[{text:"Cough Characteristics",tooltip:"Duration, type, hemoptysis",required:!0,redFlags:["Hemoptysis","Stridor"]},{text:"Systemic Symptoms",tooltip:"Weight loss, fatigue, chest pain",required:!0}],cancerSpecificNotes:["Quantify pack-years if smoker","Note occupational exposures"]},{title:"Metastatic Symptoms",items:[{text:"Neurological Symptoms",tooltip:"Headache, weakness, confusion",required:!0,redFlags:["New neurological symptoms","Severe headache"]},{text:"Bone Pain",tooltip:"Location, severity, duration",required:!0}]}],notes:["Order chest CT if suspicious","Consider PET-CT for staging","Assess smoking cessation support needs"],redFlags:["Superior vena cava syndrome","Severe dyspnea","Significant hemoptysis"]},prostate:{sections:[{title:"Urinary Symptoms",items:[{text:"LUTS Assessment",tooltip:"Frequency, urgency, nocturia, stream",required:!0,redFlags:["Acute retention","Severe urinary symptoms"]},{text:"Obstructive Symptoms",tooltip:"Hesitancy, poor stream, retention",required:!0,redFlags:["Complete obstruction"]}],cancerSpecificNotes:["Document IPSS score","Record voiding diary findings"]},{title:"Physical Examination",items:[{text:"Digital Rectal Examination",tooltip:"Size, consistency, nodules, tenderness",required:!0,redFlags:["Hard nodular prostate","Fixed mass"]}]},{title:"Metastatic Assessment",items:[{text:"Bone Pain",tooltip:"Location, severity, duration",required:!0,redFlags:["Severe back pain","Pathological fracture risk"]},{text:"Neurological Symptoms",tooltip:"Lower limb weakness, sensory changes",required:!0,redFlags:["Cord compression symptoms"]}]}],notes:["Check PSA level","Consider bone scan if indicated","Family history documentation essential","Consider hereditary cancer syndromes"],redFlags:["Spinal cord compression","Urinary retention","Rapidly rising PSA","Pathological fracture risk"]},lymphoma:{sections:[{title:"Lymphadenopathy Assessment",items:[{text:"Node Characteristics",tooltip:"Size, location, consistency, mobility",required:!0,redFlags:["Rapid enlargement","Rock-hard nodes"]},{text:"Distribution Pattern",tooltip:"Document all involved sites systematically",required:!0}],cancerSpecificNotes:["Map out all involved nodes","Compare with previous examinations"]},{title:"B Symptoms",items:[{text:"Fever Pattern",tooltip:"Document temperature, duration, pattern",required:!0},{text:"Night Sweats",tooltip:"Severity, frequency, impact on daily life",required:!0},{text:"Weight Loss",tooltip:"Amount, duration, associated symptoms",required:!0,redFlags:[">10% in 6 months"]}]},{title:"Systemic Examination",items:[{text:"Hepatosplenomegaly",tooltip:"Size, tenderness, associated symptoms",required:!0},{text:"Extra-nodal Involvement",tooltip:"Skin lesions, bone pain, CNS symptoms",required:!0,redFlags:["CNS involvement","Airway compromise"]}]}],notes:["Document performance status","Consider PET-CT staging","Plan for bone marrow assessment","Check EBV status in young patients"],redFlags:["Superior vena cava syndrome","Airway compromise","CNS involvement","Significant B symptoms"]},colon:{sections:[{title:"Gastrointestinal Symptoms",items:[{text:"Bowel Habits",tooltip:"Changes in frequency, caliber, blood in stool",required:!0,redFlags:["Rectal bleeding","Severe constipation"]},{text:"Abdominal Symptoms",tooltip:"Pain, distention, mass",required:!0}],cancerSpecificNotes:["Document Bristol stool scale","Note any screening history"]},{title:"Risk Assessment",items:[{text:"Family History",tooltip:"History of colorectal cancer or polyps",required:!0},{text:"Lynch Syndrome Screening",tooltip:"Family history of associated cancers",required:!1}]}],notes:["Check hemoglobin level","Consider colonoscopy referral","Assess for Lynch syndrome criteria"],redFlags:["Bowel obstruction","Significant weight loss","Iron deficiency anemia"]},ovarian:{sections:[{title:"Symptoms & History",items:[{text:"Abdominal/Pelvic Symptoms",tooltip:"Bloating, early satiety, abdominal pain",required:!0,redFlags:["Rapidly increasing abdominal girth","Severe pain"]},{text:"Menstrual History",tooltip:"Pattern changes, irregular bleeding",required:!0,redFlags:["Post-menopausal bleeding"]},{text:"Constitutional Symptoms",tooltip:"Weight loss, fatigue, appetite changes",required:!0}],cancerSpecificNotes:["Document family history of ovarian/breast cancer","Check BRCA status if applicable"]},{title:"Physical Examination",items:[{text:"Abdominal Assessment",tooltip:"Ascites, masses, organomegaly",required:!0,redFlags:["Fixed pelvic mass","Omental cake"]},{text:"Pelvic Examination",tooltip:"Adnexal masses, tenderness",required:!0}]}],notes:["Check CA-125 if postmenopausal","Consider CT abdomen/pelvis","Consider genetic counseling referral"],redFlags:["Fixed pelvic mass","Rapidly growing abdominal distention","Significant ascites"]},gastric:{sections:[{title:"Upper GI Symptoms",items:[{text:"Epigastric Symptoms",tooltip:"Pain pattern, relation to food, duration",required:!0,redFlags:["Persistent pain","Progressive dysphagia"]},{text:"Eating Difficulties",tooltip:"Loss of appetite, early satiety, weight loss",required:!0,redFlags:["Significant weight loss","Complete dysphagia"]},{text:"GI Bleeding Signs",tooltip:"Hematemesis, melena, chronic blood loss",required:!0,redFlags:["Active bleeding","Severe anemia"]}],cancerSpecificNotes:["Note H. pylori status if known","Document family history"]}],notes:["Check for Virchow's node","Consider urgent gastroscopy","Check H. pylori status"],redFlags:["Persistent vomiting","Gastrointestinal bleeding","Severe weight loss","Iron deficiency anemia"]},"head-and-neck":{sections:[{title:"ENT Symptoms",items:[{text:"Voice Changes",tooltip:"Hoarseness, duration, progression",required:!0,redFlags:["Progressive hoarseness","Stridor"]},{text:"Swallowing Issues",tooltip:"Dysphagia pattern, odynophagia",required:!0,redFlags:["Complete dysphagia","Aspiration"]},{text:"Neck Masses",tooltip:"Location, size, duration, mobility",required:!0,redFlags:["Rapidly growing mass","Fixed mass"]}],cancerSpecificNotes:["Document smoking/alcohol history","Note occupational exposures"]},{title:"Physical Examination",items:[{text:"Oral Cavity Exam",tooltip:"Mucosal lesions, ulcers, masses",required:!0,redFlags:["Non-healing ulcers","Bleeding lesions"]},{text:"Neck Examination",tooltip:"Systematic lymph node assessment",required:!0,redFlags:["Fixed nodes","Multiple levels involved"]}]}],notes:["Complete head and neck exam essential","Consider nasendoscopy if indicated","Document risk factors carefully"],redFlags:["Stridor or airway compromise","Unilateral ear pain","Progressive dysphagia","Cranial nerve involvement"]}},Yt=({id:t,label:s,tooltip:i,required:a=!1,value:n,onChange:l,error:c=!1,redFlags:u=[],rows:y=3,inputClassName:p})=>{const o={};return a&&(o["aria-required"]="true"),c&&(o["aria-invalid"]="true"),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsxs("label",{htmlFor:t,className:"text-sm font-medium text-gray-900",children:[s,a&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]})}),e.jsx("textarea",{id:t,value:n,onChange:h=>l(h.target.value),placeholder:i,rows:y,className:`w-full p-2 border rounded-md focus:ring-2 focus:ring-indigo-500 ${c?"border-red-300 bg-red-50":""} ${p||""}`,required:a,...o}),u.length>0&&e.jsxs("div",{className:"mt-1 text-sm text-red-600",children:["Monitor for: ",u.join(", ")]})]})},le=({children:t,variant:s="primary",size:i="md",isLoading:a=!1,disabled:n=!1,icon:l,fullWidth:c=!1,className:u="",...y})=>{const p="rounded-md inline-flex items-center justify-center transition-colors font-medium",o={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2",lg:"px-6 py-3 text-lg"},h={primary:"bg-indigo-600 text-white hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 shadow-sm",secondary:"bg-gray-100 text-gray-700 hover:bg-gray-200 focus:ring-2 focus:ring-gray-500 focus:ring-offset-2",outline:"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50 focus:ring-2 focus:ring-gray-500 focus:ring-offset-2",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-2 focus:ring-red-500 focus:ring-offset-2 shadow-sm"},C=n||a?"opacity-70 cursor-not-allowed":"",v=c?"w-full":"",f=[p,o[i],h[s],C,v,u].join(" ");return e.jsxs("button",{className:f,disabled:n||a,...y,children:[a&&e.jsx(J,{className:"mr-2 h-4 w-4 animate-spin"}),!a&&l&&e.jsx("span",{className:"mr-2",children:l}),t]})},We=g.createContext(void 0),Wt=()=>{const t=g.useContext(We);if(!t)throw new Error("useEvaluation must be used within an EvaluationProvider");return t},Xt=({children:t})=>{const[s,i]=g.useState({}),[a,n]=g.useState(""),[l,c]=g.useState(!1),[u,y]=g.useState(null),[p,o]=g.useState(!1),h=g.useCallback((f,S)=>{i(w=>({...w,[f]:S})),p&&o(!1),u&&y(null)},[p,u]),C=g.useCallback(()=>{window.confirm("Are you sure you want to clear all form data?")&&(i({}),y(null),o(!1))},[]),v={formData:s,updateFormField:h,clearFormData:C,selectedCancerType:a,setSelectedCancerType:n,isFormSubmitting:l,setIsFormSubmitting:c,formError:u,setFormError:y,formSuccess:p,setFormSuccess:o};return e.jsx(We.Provider,{value:v,children:t})};class Jt extends Error{constructor(s){super(s),this.name="APIError"}}async function Qt(t){const{error:s}=await $i.from("patient_evaluations").insert([{cancer_type:t.cancerType,form_data:t.formData,timestamp:t.timestamp}]);if(s)throw console.error("Failed to save patient evaluation:",s),new Jt(s.message)}const Zt=({steps:t,currentStep:s})=>e.jsx("nav",{"aria-label":"Progress",className:"mb-8",children:e.jsx("ol",{className:"flex items-center",children:t.map((i,a)=>e.jsxs("li",{className:`relative ${a!==t.length-1?"flex-1":""}`,children:[i.status==="complete"?e.jsx(k.div,{className:"group",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"relative flex h-8 w-8 items-center justify-center rounded-full bg-indigo-600",children:e.jsx(me,{className:"h-5 w-5 text-white","aria-hidden":"true"})}),e.jsx("span",{className:"ml-3 text-sm font-medium text-gray-900",children:i.name})]})}):i.status==="current"?e.jsxs(k.div,{className:"flex items-center",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3},children:[e.jsx("span",{className:"relative flex h-8 w-8 items-center justify-center rounded-full border-2 border-indigo-600",children:e.jsx("span",{className:"h-2.5 w-2.5 rounded-full bg-indigo-600"})}),e.jsx("span",{className:"ml-3 text-sm font-medium text-indigo-600",children:i.name})]}):e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"relative flex h-8 w-8 items-center justify-center rounded-full border-2 border-gray-300",children:e.jsx("span",{className:"h-2.5 w-2.5 rounded-full bg-transparent"})}),e.jsx("span",{className:"ml-3 text-sm font-medium text-gray-500",children:i.name})]}),a!==t.length-1&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"absolute left-4 top-4 -ml-px mt-0.5 h-0.5 w-full bg-gray-300",children:e.jsx("div",{className:"h-full bg-indigo-600 transition-all duration-500",style:{width:i.status==="complete"?"100%":"0%"}})})})]},i.id))})}),Ce={"Chief Complaint":["Consider duration and pattern of symptoms","Note any associated symptoms","Document severity and impact on daily life"],"History of Present Illness":["Include timeline of symptom progression","Note previous treatments and responses","Document diagnostic tests already done"],"Physical Examination":["Always document ECOG/PS score","Note lymph node regions systematically","Document any B symptoms","Consider paraneoplastic manifestations"],"Performance Status":["Patients with ECOG ≥2 may need early palliative consult","Document any recent changes in performance","Consider impact on treatment choices"],"Past Medical History":["Note any contraindications to therapy","Document previous malignancies","Include relevant surgeries and procedures"]},es=({isOpen:t,onClose:s,currentSection:i})=>e.jsx(qi,{children:t&&e.jsxs(k.div,{initial:{x:"100%",opacity:0},animate:{x:0,opacity:1},exit:{x:"100%",opacity:0},transition:{type:"spring",damping:20},className:"fixed right-0 top-0 h-screen w-80 bg-white/95 backdrop-blur-sm shadow-xl border-l border-gray-200 z-50",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5 text-indigo-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"AI Assistant Tips"})]}),e.jsx("button",{onClick:s,className:"p-1 hover:bg-gray-100 rounded-full",children:e.jsx(Ae,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"p-4 space-y-6 overflow-y-auto max-h-[calc(100vh-64px)]",children:i&&Ce[i]?e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(Oi,{className:"w-4 h-4 text-yellow-500"}),"Tips for: ",i]}),e.jsx("ul",{className:"space-y-2",children:Ce[i].map((a,n)=>e.jsx(k.li,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:n*.1},className:"p-3 bg-indigo-50 rounded-lg text-sm text-indigo-700",children:a},n))})]}):e.jsxs("div",{className:"text-center text-gray-500 py-8",children:[e.jsx(L,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),e.jsx("p",{children:"Select a section to see relevant AI tips"})]})})]})}),is=({cancerType:t,value:s,onChange:i})=>{const a=c=>["X","is","0","1","1a","1b","2","2a","2b","3","3a","3b","4","4a","4b"],n=()=>["X","0","1","2","3"],l=()=>["X","0","1","1a","1b"];return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"TNM Staging"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"T Stage"}),e.jsxs("select",{value:s.t,onChange:c=>i({...s,t:c.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Select T Stage"}),a().map(c=>e.jsxs("option",{value:c,children:["T",c]},c))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"N Stage"}),e.jsxs("select",{value:s.n,onChange:c=>i({...s,n:c.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Select N Stage"}),n().map(c=>e.jsxs("option",{value:c,children:["N",c]},c))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"M Stage"}),e.jsxs("select",{value:s.m,onChange:c=>i({...s,m:c.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Select M Stage"}),l().map(c=>e.jsxs("option",{value:c,children:["M",c]},c))]})]})]})]})},ts=[{score:0,description:"Fully active, able to carry on all pre-disease performance without restriction"},{score:1,description:"Restricted in physically strenuous activity but ambulatory and able to carry out work of a light or sedentary nature"},{score:2,description:"Ambulatory and capable of all self-care but unable to carry out any work activities; up and about more than 50% of waking hours"},{score:3,description:"Capable of only limited self-care; confined to bed or chair more than 50% of waking hours"},{score:4,description:"Completely disabled; cannot carry on any self-care; totally confined to bed or chair"},{score:5,description:"Dead"}],ss=({value:t,onChange:s})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"ECOG Performance Status"}),e.jsx(M,{children:e.jsxs(q,{children:[e.jsx(O,{children:e.jsx($,{className:"w-4 h-4 text-blue-500"})}),e.jsx(D,{children:e.jsx("p",{className:"max-w-xs text-sm",children:"Eastern Cooperative Oncology Group (ECOG) performance status. Used to assess disease progress and how it affects daily living abilities."})})]})})]}),e.jsx("div",{className:"grid gap-4",children:ts.map(({score:i,description:a})=>e.jsx("div",{className:`p-4 rounded-lg border cursor-pointer transition-colors ${t===i?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:border-indigo-200"}`,onClick:()=>s(i),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-semibold ${t===i?"bg-indigo-500 text-white":"bg-gray-100 text-gray-700"}`,children:i}),e.jsx("p",{className:"text-sm text-gray-600",children:a})]})},i))})]}),as=t=>t>=90?"Able to carry on normal activities; minor signs or symptoms of disease":t>=70?"Able to care for self but unable to carry on normal activities or work":t>=50?"Requires considerable assistance and frequent medical care":t>=30?"Severely disabled; hospitalization indicated though death not imminent":"Very sick; hospital admission necessary; active supportive treatment necessary",Se=t=>t>=90?"bg-green-500":t>=70?"bg-blue-500":t>=50?"bg-yellow-500":t>=30?"bg-orange-500":"bg-red-500",ns=({value:t,onChange:s})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Karnofsky Performance Status"}),e.jsx(M,{children:e.jsxs(q,{children:[e.jsx(O,{children:e.jsx($,{className:"w-4 h-4 text-blue-500"})}),e.jsx(D,{children:e.jsx("p",{className:"max-w-xs text-sm",children:"Karnofsky Performance Status (KPS) scale quantifies cancer patients' general well-being and activities of daily life. Scores range from 0-100."})})]})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-2xl font-bold text-gray-700",children:[t,"%"]}),e.jsx("span",{className:"text-sm text-gray-500",children:as(t)})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"range",min:0,max:100,step:10,value:t,onChange:i=>s(parseInt(i.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${Se(t)} 0%, ${Se(t)} ${t}%, #e5e7eb ${t}%, #e5e7eb 100%)`}}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 px-1 mt-2",children:[e.jsx("span",{children:"0"}),e.jsx("span",{children:"20"}),e.jsx("span",{children:"40"}),e.jsx("span",{children:"60"}),e.jsx("span",{children:"80"}),e.jsx("span",{children:"100"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-2 w-full bg-red-500 rounded mb-1"}),e.jsx("span",{className:"text-gray-600",children:"Critical"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-2 w-full bg-yellow-500 rounded mb-1"}),e.jsx("span",{className:"text-gray-600",children:"Moderate"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-2 w-full bg-green-500 rounded mb-1"}),e.jsx("span",{className:"text-gray-600",children:"Good"})]})]})]})]}),rs=[{value:"breast",label:"Breast Cancer"},{value:"lung",label:"Lung Cancer"},{value:"colorectal",label:"Colorectal Cancer"},{value:"prostate",label:"Prostate Cancer"},{value:"lymphoma",label:"Lymphoma"},{value:"ovarian",label:"Ovarian Cancer"},{value:"gastric",label:"Gastric Cancer"},{value:"head_neck",label:"Head and Neck Cancer"}],ce="patient-evaluation-autosave",os=3e4,ls=()=>{const t=je(),{toast:s}=qe(),{formData:i,updateFormField:a,clearFormData:n,selectedCancerType:l,setSelectedCancerType:c,isFormSubmitting:u,setIsFormSubmitting:y,formError:p,setFormError:o,formSuccess:h,setFormSuccess:C}=Wt(),[v,f]=g.useState(!1),[S,w]=g.useState(),[P,B]=g.useState({t:"",n:"",m:""}),[r,m]=g.useState({ecog:0,kps:100}),d=g.useMemo(()=>l?Kt[l]:null,[l]),_=g.useCallback(x=>{if(!d)return"upcoming";const b=d.sections[x].items.map((T,I)=>`section-${x}-item-${I}`),N=b.every(T=>{var I;return(I=i[T])==null?void 0:I.trim()}),j=!N&&b.some(T=>{var I;return(I=i[T])==null?void 0:I.trim()});return N?"complete":j?"current":"upcoming"},[d,i]),R=g.useMemo(()=>d?d.sections.map((x,b)=>{var N;return{id:b+1,name:x.title,description:((N=x.cancerSpecificNotes)==null?void 0:N[0])||"",status:_(b)}}):[],[d,i,_]),Q=()=>{const x=window.open("","_blank");if(!x)return;const b=`
      <style>
        body { font-family: system-ui; line-height: 1.5; padding: 2rem; }
        h1 { color: #4f46e5; margin-bottom: 1.5rem; }
        .section { margin-bottom: 2rem; }
        .field { margin-bottom: 1rem; }
        .label { font-weight: 600; color: #374151; }
        .value { margin-top: 0.25rem; }
        .red-flag { color: #dc2626; padding: 0.5rem; background: #fee2e2; border-radius: 0.25rem; }
        @media print {
          body { padding: 0; }
          .page-break { page-break-before: always; }
        }
      </style>
    `;let N=`
      <h1>Patient Evaluation - ${l}</h1>
      <div class="content">
    `;d&&d.sections.forEach((j,T)=>{N+=`<div class="section">
          <h2>${j.title}</h2>`,j.items.forEach((I,Z)=>{var E;const z=`section-${T}-item-${Z}`,K=i[z]||"Not provided";N+=`
            <div class="field">
              <div class="label">${I.text}</div>
              <div class="value">${K}</div>
              ${((E=I.redFlags)==null?void 0:E.map(ee=>`<div class="red-flag">⚠️ ${ee}</div>`).join(""))||""}
            </div>
          `}),N+="</div>"}),N+="</div>",x.document.write(`
      <!DOCTYPE html>
      <html>
        <head>${b}</head>
        <body>${N}</body>
      </html>
    `),x.document.close(),x.print()};g.useEffect(()=>{const x=localStorage.getItem(ce);if(x)try{const{cancerType:b,data:N}=JSON.parse(x);c(b),Object.entries(N).forEach(([j,T])=>{a(j,T)}),s({title:"Form Data Restored",description:"Your previous progress has been loaded.",duration:3e3})}catch(b){console.error("Error loading saved form data:",b)}},[]),g.useEffect(()=>{if(!l||Object.keys(i).length===0)return;const b=setInterval(()=>{localStorage.setItem(ce,JSON.stringify({cancerType:l,data:i,timestamp:new Date().toISOString()}))},os);return()=>clearInterval(b)},[l,i]);const ue=()=>{localStorage.removeItem(ce)},V=g.useMemo(()=>d?d.sections.flatMap((x,b)=>x.items.map((N,j)=>({item:N,id:`section-${b}-item-${j}`}))).filter(({item:x,id:b})=>x.required&&(!i[b]||i[b].trim()==="")):[],[d,i]),Xe=async x=>{if(x.preventDefault(),o(null),C(!1),!l){o("Please select a cancer type."),s({variant:"destructive",title:"Validation Error",description:"Please select a cancer type to proceed."});return}if(V.length>0){const b=`Please complete all required fields (${V.length} missing).`;o(b),s({variant:"destructive",title:"Missing Required Fields",description:b});const N=V[0].id,j=document.getElementById(N);j&&(j.scrollIntoView({behavior:"smooth",block:"center"}),j.focus());return}try{y(!0),await Qt({cancerType:l,formData:i,timestamp:new Date().toISOString()}),ue(),C(!0),s({title:"Success",description:"Patient evaluation saved successfully.",duration:3e3}),setTimeout(()=>{t("/opd")},1e3)}catch(b){console.error("Form submission error:",b);const N=b instanceof Error?b.message:"Failed to save evaluation. Please try again.";o(N),s({variant:"destructive",title:"Save Error",description:N,duration:5e3})}finally{y(!1)}},Je=()=>{window.confirm("Are you sure you want to clear all form data? This cannot be undone.")&&(n(),ue(),s({title:"Form Cleared",description:"All form data has been cleared.",duration:3e3}))};return e.jsxs("form",{onSubmit:Xe,className:"space-y-8",children:[e.jsx("div",{className:"fixed right-4 top-4 z-50",children:e.jsxs("button",{type:"button",onClick:()=>f(!0),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-full shadow-lg hover:bg-indigo-700 transition-colors",children:[e.jsx(L,{className:"w-5 h-5"}),e.jsx("span",{children:"AI Assistant"})]})}),e.jsx(es,{isOpen:v,onClose:()=>f(!1),currentSection:S}),d&&e.jsx(Zt,{steps:R,currentStep:R.findIndex(x=>x.status==="current")}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200 shadow-sm",children:[e.jsx("label",{htmlFor:"cancer-type-select",className:"block text-lg font-semibold text-gray-900 mb-4",children:"Select Cancer Type"}),e.jsxs("select",{id:"cancer-type-select","aria-label":"Cancer Type",value:l||"",onChange:x=>c(x.target.value),className:"w-full p-2 border rounded-md focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Select cancer type..."}),rs.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))]})]}),d&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"🩺 Oncologist's Comprehensive OPD Evaluation"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Use this structured form to guide your clinical judgment and capture essential information during patient evaluation in oncology OPD."}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsxs("h3",{className:"text-blue-800 font-semibold flex items-center gap-2 mb-2",children:[e.jsx(X,{className:"w-5 h-5"}),"Clinical Guidance"]}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-blue-700",children:d.notes.map((x,b)=>e.jsx("li",{children:x},b))})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[e.jsxs("h3",{className:"text-red-800 font-semibold flex items-center gap-2 mb-2",children:[e.jsx(A,{className:"w-5 h-5"}),"Red Flags to Monitor"]}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-red-700",children:d.redFlags.map((x,b)=>e.jsx("li",{children:x},b))})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200 shadow-sm space-y-6",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Disease Staging & Performance Status"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Document current disease stage and patient's functional status"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(is,{cancerType:l,value:P,onChange:B}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(ss,{value:r.ecog,onChange:x=>m(b=>({...b,ecog:x}))}),e.jsx(ns,{value:r.kps,onChange:x=>m(b=>({...b,kps:x}))})]})]})]}),d.sections.map((x,b)=>e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200 shadow-sm space-y-6",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:x.title}),x.cancerSpecificNotes&&e.jsx("div",{className:"mt-2 text-sm text-gray-600",children:x.cancerSpecificNotes.map((N,j)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4 text-blue-500"}),N]},j))})]}),e.jsx("div",{className:"space-y-4",children:x.items.map((N,j)=>{var K;const T=`section-${b}-item-${j}`,I=!!N.required,Z=V.some(E=>E.id===T),z=N.redFlags&&N.redFlags.length>0;return e.jsxs("div",{className:"relative",children:[e.jsx(Yt,{id:T,label:N.text,required:I,value:i[T]||"",onChange:E=>a(T,E),error:Z,redFlags:N.redFlags||[],inputClassName:z?"border-red-200 focus:ring-red-500 focus:border-red-500":""}),z&&e.jsx(M,{children:e.jsxs(q,{children:[e.jsx(O,{asChild:!0,children:e.jsx("div",{className:"absolute right-3 top-3",children:e.jsx(A,{className:"w-5 h-5 text-red-500"})})}),e.jsxs(D,{className:"bg-red-50 border border-red-200 p-3 max-w-xs",children:[e.jsx("div",{className:"font-medium mb-1 text-red-800",children:"Clinical Red Flags:"}),e.jsx("ul",{className:"list-disc pl-4 text-sm text-red-700",children:(K=N.redFlags)==null?void 0:K.map((E,ee)=>e.jsx("li",{children:E},ee))})]})]})})]},j)})})]},b)),e.jsx("div",{className:"mt-6",children:e.jsx(zt,{template:d,formData:i})}),p&&e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md text-red-700 flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5"}),p]}),h&&e.jsxs("div",{className:"p-3 bg-green-50 border border-green-200 rounded-md text-green-700 flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5"}),"Evaluation saved successfully! Redirecting..."]}),e.jsxs("div",{className:"flex justify-end gap-4 sticky bottom-0 bg-white p-4 border-t mt-6",children:[e.jsx(le,{type:"button",variant:"secondary",onClick:Q,icon:e.jsx(Li,{className:"w-4 h-4"}),children:"Print Summary"}),e.jsx(le,{type:"button",variant:"secondary",onClick:Je,disabled:u,icon:e.jsx(Bi,{className:"w-4 h-4"}),children:"Clear Form"}),e.jsx(le,{type:"submit",variant:"primary",isLoading:u,icon:u?void 0:e.jsx(Ui,{className:"w-4 h-4"}),children:u?"Saving...":"Save Evaluation"})]})]})]})},ys=()=>e.jsx(Oe,{moduleName:"Oncology OPD",children:e.jsx(Xt,{children:e.jsxs(Vt,{children:[e.jsxs(ti,{children:[e.jsx(F,{path:"/",element:e.jsx($t,{})}),e.jsx(F,{path:"/patient-evaluation-form",element:e.jsx(ls,{})}),e.jsx(F,{path:"/diagnostic-pathways",element:e.jsx($e,{})}),e.jsx(F,{path:"/cancer-screening",element:e.jsx(ze,{})}),e.jsx(F,{path:"/referral-guidelines",element:e.jsx(Ke,{})}),e.jsx(F,{path:"/follow-up-oncology",element:e.jsx(Ye,{})})]}),e.jsx(Wi,{})]})})});export{ys as O,M as T,q as a,O as b,D as c,zi as d,Be as e};
//# sourceMappingURL=module-opd-0xQ-JYRh.js.map
