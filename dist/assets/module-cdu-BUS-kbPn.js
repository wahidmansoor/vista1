var mt=Object.defineProperty;var xt=(s,t,a)=>t in s?mt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a;var ee=(s,t,a)=>xt(s,typeof t!="symbol"?t+"":t,a);import{r as i,j as e,R as G,u as Ps,a as gt,b as ht,c as ut,d as _s}from"./react-vendor-B1d8dduC.js";import{t as pt,c as yt,L as te,P as Oe,B as je,a as ft,O as jt,T as Ce,C as Xe,S as bt,b as Ms,d as Rs,e as Os,f as Ls,R as Nt,g as Fs,h as vt,i as Bs,j as wt,X as ae,k as $s,D as Vs,l as kt,m as _t,n as St,o as we,p as Ct,q as Ye,r as Ks,s as Tt,u as At,v as Dt,w as It,I as Et,x as Pt,y as xe,z as Mt,$ as A,A as Rt,E as Ne,F as Ot,G as Lt,H as Ft,J as Us,V as Bt,K as $t,M as qs,N as Vt,Q as Kt,U as Ss,W as Ut,Y as qt,Z as Je,_ as Ze,a0 as zt,a1 as Ht,a2 as zs,a3 as Gt,a4 as Yt,a5 as Jt,a6 as Wt,a7 as Xt,a8 as Zt,a9 as Qt,aa as Te,ab as Cs,ac as Le,ad as Fe,ae as Be,af as Ae,ag as $e,ah as Ts,ai as ea,aj as sa,ak as ta,al as aa,am as ra}from"./vendor-COw5p1kA.js";function D(...s){return pt(yt(s))}const ia={BASE_URL:"/",DEV:!0,MODE:"production",PROD:!1,SSR:!1,VITE_GEMINI_API_KEY:"AIzaSyBMbuv9SC-5j2BUuCDskrROlw_ETk213Yc",VITE_OPENAI_API_KEY:"your-openai-api-key-here",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhkcnNmeWxqZ2FibXh3eG1wYml4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDIwNjc5NDAsImV4cCI6MjA1NzY0Mzk0MH0.VPnBZfe-BFSZ3L-YyWJUHYZz4fwt7uyY57KWYYAa3C4",VITE_SUPABASE_URL:"https://hdrsfyljgabmxwxmpbix.supabase.co",VITE_USER_NODE_ENV:"development"};var na={};const la=typeof window>"u",oa=!la;function ca(s){return oa?ia[`VITE_${s}`]:na[`VITE_${s}`]}function da(s,t,a={}){const{moduleName:r="global",retryCount:n=0,extra:g={}}=a;ca("NODE_ENV")==="development"&&(console.group("Error logged by logError utility:"),console.error("Error:",s),t&&console.error("Component Stack:",t.componentStack),console.error("Module:",r),console.error("Retry Count:",n),Object.keys(g).length>0&&console.error("Extra Information:",g),console.groupEnd()),te.captureException(s,{tags:{module:r,errorName:s.name,errorType:s.constructor.name,retryCount:n.toString()},extra:{componentStack:(t==null?void 0:t.componentStack)||"No component stack available",...g}})}let Ve=0;const ma=5;function xa(s,t){return{message:s==null?void 0:s.message,name:s==null?void 0:s.name,stack:s==null?void 0:s.stack,componentStack:t==null?void 0:t.componentStack}}class Hs extends i.Component{constructor(a){super(a);ee(this,"_recoveryTimeout");ee(this,"handleReset",()=>{this.setState(a=>({hasError:!1,error:null,errorInfo:null,retryCount:a.retryCount+1,resetKey:a.resetKey+1,isDetailsOpen:!1,isRetrying:!0}))});ee(this,"handleNavigateHome",()=>{window.location.href="/"});ee(this,"handleToggleDetails",()=>{this.setState(a=>({isDetailsOpen:!a.isDetailsOpen}))});ee(this,"renderErrorUI",()=>e.jsx(je,{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",zIndex:1300,display:"flex",alignItems:"center",justifyContent:"center",p:4,bgcolor:"rgba(255,255,255,0.8)",style:{backdropFilter:"blur(4px)"},children:e.jsx(ft,{elevation:24,sx:{maxWidth:600,width:"100%",p:6,borderRadius:4,border:1,borderColor:"grey.100",bgcolor:"background.paper"},children:e.jsxs(je,{display:"flex",flexDirection:"column",alignItems:"center",gap:3,children:[e.jsx(je,{width:80,height:80,mb:2,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",bgcolor:"error.light",children:e.jsx(jt,{className:"w-10 h-10",color:"#d32f2f"})}),e.jsx(Ce,{variant:"h4",fontWeight:700,color:"text.primary",mb:2,align:"center",children:this.props.moduleName?`Error in ${this.props.moduleName}`:"Something went wrong"}),e.jsx(Ce,{color:"text.secondary",mb:3,align:"center",children:"We apologize for the inconvenience. Our team has been notified and is working to resolve this issue."}),this.state.error&&e.jsxs("details",{open:this.state.isDetailsOpen,onToggle:this.handleToggleDetails,style:{width:"100%",marginBottom:24},children:[e.jsxs("summary",{style:{cursor:"pointer",fontWeight:500,color:"#616161"},children:[e.jsx(Xe,{className:"w-4 h-4",style:{verticalAlign:"middle",marginRight:8,transition:"transform 0.2s",transform:this.state.isDetailsOpen?"rotate(180deg)":"none"}}),"Technical Details"]}),e.jsxs(je,{mt:2,color:"text.secondary","data-testid":"error-details-box",children:[e.jsx(Ce,{variant:"subtitle2",children:"Error:"}),e.jsx("pre",{style:{whiteSpace:"pre-wrap",marginBottom:16,paddingLeft:16,borderLeft:"2px solid #f44336"},children:this.state.error&&this.state.error.toString()}),this.state.errorInfo&&e.jsxs(e.Fragment,{children:[e.jsx(Ce,{variant:"subtitle2",children:"Component Stack:"}),e.jsx("pre",{style:{whiteSpace:"pre-wrap",paddingLeft:16,borderLeft:"2px solid #90caf9"},children:this.state.errorInfo.componentStack})]})]})]}),e.jsxs(je,{display:"flex",gap:2,mt:2,children:[e.jsxs("button",{type:"button",onClick:this.handleNavigateHome,className:"MuiButtonBase-root MuiButton-root MuiButton-outlined MuiButton-outlinedPrimary MuiButton-sizeMedium MuiButton-outlinedSizeMedium MuiButton-colorPrimary",children:[e.jsx("span",{className:"MuiButton-icon MuiButton-startIcon MuiButton-iconSizeMedium",children:e.jsxs("svg",{className:"lucide lucide-arrow-left",fill:"none",height:"24",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",width:"24",children:[e.jsx("path",{d:"m12 19-7-7 7-7"}),e.jsx("path",{d:"M19 12H5"})]})}),"Go Home"]}),e.jsxs("button",{type:"button",onClick:this.handleReset,disabled:this.state.isRetrying,className:`MuiButtonBase-root MuiButton-root MuiButton-contained MuiButton-containedError MuiButton-sizeMedium MuiButton-containedSizeMedium MuiButton-colorError${this.state.isRetrying?" Mui-disabled":""}`,children:[e.jsx("span",{className:"MuiButton-icon MuiButton-startIcon MuiButton-iconSizeMedium",children:e.jsxs("svg",{className:`lucide lucide-refresh-ccw${this.state.isRetrying?" animate-spin":""}`,fill:"none",height:"24",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",width:"24",children:[e.jsx("path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}),e.jsx("path",{d:"M3 3v5h5"}),e.jsx("path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"}),e.jsx("path",{d:"M16 16h5v5"})]})}),this.state.isRetrying?"Retrying...":"Try Again"]})]}),e.jsxs("a",{className:"MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover",href:"mailto:support@oncovista.com",children:[e.jsxs("svg",{className:"lucide lucide-life-buoy w-4 h-4",fill:"none",height:"24",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",width:"24",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"m4.93 4.93 4.24 4.24"}),e.jsx("path",{d:"m14.83 9.17 4.24-4.24"}),e.jsx("path",{d:"m14.83 14.83 4.24 4.24"}),e.jsx("path",{d:"m9.17 14.83-4.24 4.24"}),e.jsx("circle",{cx:"12",cy:"12",r:"4"})]}),"Contact technical support"]})]})})}));this.state={hasError:!1,error:null,errorInfo:null,retryCount:0,resetKey:0,isDetailsOpen:!1,isRetrying:!1}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,r){var n,g;this.setState({error:a,errorInfo:r}),da(a,r,{moduleName:this.props.moduleName,retryCount:this.state.retryCount}),typeof te<"u"&&((n=te)!=null&&n.error)&&te.error("ErrorBoundary",xa(a,r)),Ve++,Ve>=ma&&typeof te<"u"&&((g=te)!=null&&g.track)&&te.track("error-rate-threshold",{count:Ve})}componentDidUpdate(a,r){this.state.hasError&&!r.hasError&&(this._recoveryTimeout=setTimeout(()=>{this.state.hasError&&this.handleReset()},1e4)),!this.state.hasError&&r.hasError&&this._recoveryTimeout&&(clearTimeout(this._recoveryTimeout),this._recoveryTimeout=void 0),!this.state.hasError&&r.hasError&&this.state.isRetrying&&this.setState({isRetrying:!1})}componentWillUnmount(){this._recoveryTimeout&&clearTimeout(this._recoveryTimeout)}render(){return this.state.hasError&&this.props.fallback?this.props.fallback:this.state.hasError?this.renderErrorUI():e.jsx(G.Fragment,{children:this.props.children},this.state.resetKey)}}ee(Hs,"propTypes",{children:Oe.node,moduleName:Oe.string,fallback:Oe.node});const ga=Ms("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),re=i.forwardRef(({className:s,variant:t,size:a,asChild:r=!1,...n},g)=>{const h=r?bt:"button";return e.jsx(h,{className:D(ga({variant:t,size:a,className:s})),ref:g,...n})});re.displayName="Button";const Pe=i.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:D("rounded-lg border bg-card text-card-foreground shadow-sm",s),...t}));Pe.displayName="Card";const ha=i.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:D("flex flex-col space-y-1.5 p-6",s),...t}));ha.displayName="CardHeader";const ua=i.forwardRef(({className:s,...t},a)=>e.jsx("h3",{ref:a,className:D("text-lg font-semibold leading-none tracking-tight",s),...t}));ua.displayName="CardTitle";const pa=i.forwardRef(({className:s,...t},a)=>e.jsx("p",{ref:a,className:D("text-sm text-muted-foreground",s),...t}));pa.displayName="CardDescription";const ya=i.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:D("p-6 pt-0",s),...t}));ya.displayName="CardContent";const fa=i.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:D("flex items-center p-6 pt-0",s),...t}));fa.displayName="CardFooter";const ja=Ms("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function P({className:s,variant:t,...a}){return e.jsx("div",{className:D(ja({variant:t}),s),...a})}const ba=Nt,Gs=i.forwardRef(({className:s,...t},a)=>e.jsx(Rs,{ref:a,className:D("inline-flex items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...t}));Gs.displayName=Rs.displayName;const z=i.forwardRef(({className:s,...t},a)=>e.jsx(Os,{ref:a,className:D("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all hover:text-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground",s),...t}));z.displayName=Os.displayName;const H=i.forwardRef(({className:s,...t},a)=>e.jsx(Ls,{ref:a,className:D("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...t}));H.displayName=Ls.displayName;const De=kt,jr=_t,Na=vt,Ys=i.forwardRef(({className:s,...t},a)=>e.jsx(Fs,{ref:a,className:D("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t}));Ys.displayName=Fs.displayName;const ke=i.forwardRef(({className:s,children:t,...a},r)=>e.jsxs(Na,{children:[e.jsx(Ys,{}),e.jsxs(Bs,{ref:r,className:D("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...a,children:[t,e.jsxs(wt,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));ke.displayName=Bs.displayName;const Me=({className:s,...t})=>e.jsx("div",{className:D("flex flex-col space-y-1.5 text-center sm:text-left",s),...t});Me.displayName="DialogHeader";const Qe=i.forwardRef(({className:s,...t},a)=>e.jsx($s,{ref:a,className:D("text-lg font-semibold leading-none tracking-tight",s),...t}));Qe.displayName=$s.displayName;const Js=i.forwardRef(({className:s,...t},a)=>e.jsx(Vs,{ref:a,className:D("text-sm text-muted-foreground",s),...t}));Js.displayName=Vs.displayName;const va=1,wa=1e3;let Ke=0;function ka(){return Ke=(Ke+1)%Number.MAX_VALUE,Ke.toString()}const Ue=new Map,As=s=>{if(Ue.has(s))return;const t=setTimeout(()=>{Ue.delete(s),ve({type:"REMOVE_TOAST",toastId:s})},wa);Ue.set(s,t)},_a=(s,t)=>{switch(t.type){case"ADD_TOAST":return{...s,toasts:[t.toast,...s.toasts].slice(0,va)};case"UPDATE_TOAST":return{...s,toasts:s.toasts.map(a=>a.id===t.toast.id?{...a,...t.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=t;return a?As(a):s.toasts.forEach(r=>{As(r.id)}),{...s,toasts:s.toasts.map(r=>r.id===a||a===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return t.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(a=>a.id!==t.toastId)}}},Ie=[];let Ee={toasts:[]};function ve(s){Ee=_a(Ee,s),Ie.forEach(t=>{t(Ee)})}function Sa({...s}){const t=ka(),a=n=>ve({type:"UPDATE_TOAST",toast:{...n,id:t}}),r=()=>ve({type:"DISMISS_TOAST",toastId:t});return ve({type:"ADD_TOAST",toast:{...s,id:t,open:!0,onOpenChange:n=>{n||r()}}}),{id:t,dismiss:r,update:a}}function Ca(){const[s,t]=i.useState(Ee);return i.useEffect(()=>(Ie.push(t),()=>{const a=Ie.indexOf(t);a>-1&&Ie.splice(a,1)}),[s]),{...s,toast:Sa,dismiss:a=>ve({type:"DISMISS_TOAST",toastId:a})}}const Ta="https://hdrsfyljgabmxwxmpbix.supabase.co",Aa="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhkcnNmeWxqZ2FibXh3eG1wYml4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDIwNjc5NDAsImV4cCI6MjA1NzY0Mzk0MH0.VPnBZfe-BFSZ3L-YyWJUHYZz4fwt7uyY57KWYYAa3C4";let qe=null;const Da=()=>{if(!qe)try{qe=St(Ta,Aa,{auth:{detectSessionInUrl:!0,persistSession:!0,autoRefreshToken:!0}}),console.info("✅ Supabase client initialized")}catch(s){throw console.error("❌ Failed to create Supabase client:",s),new Error("Failed to initialize Supabase client")}return qe},es=Da(),Ia=({protocol:s})=>{var n,g,h,m,j;const[t,a]=i.useState(!1),r=()=>a(!t);return e.jsxs(Pe,{className:"p-6 space-y-6 bg-white dark:bg-gray-900 shadow-md rounded-lg",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:s.code}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[e.jsx(P,{variant:"outline",className:"text-sm font-medium",children:s.tumour_group}),s.treatment_intent&&e.jsx(P,{variant:"secondary",className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:s.treatment_intent})]})]})}),e.jsxs("div",{className:"space-y-4",children:[s.summary&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200",children:"Summary"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:s.summary})]}),s.notes&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200",children:"Notes"}),e.jsx("ul",{className:"list-disc list-inside text-sm text-muted-foreground",children:s.notes.map((l,x)=>e.jsx("li",{className:"text-sm text-muted-foreground",children:typeof l=="string"?l:`${l.title??"Note"}: ${l.description??""}`},`note-${x}`))})]}),s.version&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200",children:"Version"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:s.version})]}),s.eligibility&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200",children:"Eligibility"}),e.jsxs("ul",{className:"list-disc list-inside text-sm text-gray-700 dark:text-gray-300",children:[(n=s.eligibility.inclusion_criteria)==null?void 0:n.map((l,x)=>e.jsxs("li",{children:["Inclusion: ",l]},`inclusion-${x}`)),(g=s.eligibility.exclusion_criteria)==null?void 0:g.map((l,x)=>e.jsxs("li",{children:["Exclusion: ",l]},`exclusion-${x}`))]})]}),s.precautions&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200",children:"Precautions"}),e.jsx("ul",{className:"list-disc list-inside text-sm text-muted-foreground",children:s.precautions.map((l,x)=>e.jsx("li",{className:"text-sm text-muted-foreground",children:l},`precaution-${x}`))})]})]}),((h=s.treatment)==null?void 0:h.drugs)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200",children:"Treatment"}),e.jsx("ul",{className:"space-y-2",children:(t?s.treatment.drugs:s.treatment.drugs.slice(0,3)).map((l,x)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx(we,{className:"w-4 h-4 text-indigo-600 dark:text-indigo-400"}),e.jsx("span",{className:"font-medium text-gray-800 dark:text-gray-200",children:l.name}),l.dose&&e.jsxs("span",{className:"text-gray-500 dark:text-gray-400 ml-2 text-xs",children:[l.dose,l.administration&&e.jsxs("span",{children:[" (",l.administration,")"]})]}),l.special_notes&&e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-700 dark:text-gray-300 ml-4",children:l.special_notes.map((u,_)=>e.jsx("li",{className:"text-sm text-muted-foreground",children:typeof u=="string"?u:`${u.title??"Note"}: ${u.description??""}`},`drug-special-note-${_}`))}),l.supportiveCare&&e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-700 dark:text-gray-300 ml-4",children:l.supportiveCare.map((u,_)=>e.jsx("li",{className:"text-sm text-muted-foreground",children:typeof u=="string"?u:`${u.title??"Care"}: ${u.description??""}`},`drug-supportive-care-${_}`))})]},`drug-${x}`))}),s.treatment.drugs.length>3&&e.jsxs("button",{onClick:r,className:"text-sm text-blue-600 dark:text-blue-400 mt-2 flex items-center gap-1",children:[t?"Show Less":"Show More",t?e.jsx(Ct,{className:"w-4 h-4"}):e.jsx(Xe,{className:"w-4 h-4"})]})]}),e.jsxs("div",{className:"space-y-4",children:[s.monitoring&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200",children:"Monitoring"}),s.monitoring.baseline&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-gray-800 dark:text-gray-200",children:"Baseline"}),e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-700 dark:text-gray-300",children:s.monitoring.baseline.map((l,x)=>e.jsx("li",{className:"text-sm text-muted-foreground",children:typeof l=="string"?l:`${l.title??"Item"}: ${l.description??""}`},`baseline-${x}`))})]}),s.monitoring.ongoing&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-gray-800 dark:text-gray-200",children:"Ongoing"}),e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-700 dark:text-gray-300",children:s.monitoring.ongoing.map((l,x)=>e.jsx("li",{className:"text-sm text-muted-foreground",children:typeof l=="string"?l:`${l.title??"Item"}: ${l.description??""}`},`ongoing-${x}`))})]})]}),s.supportive_care&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200",children:"Supportive Care"}),e.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Required: ",((m=s.supportive_care.required)==null?void 0:m.length)||0,", Optional: ",((j=s.supportive_care.optional)==null?void 0:j.length)||0]})]})]}),e.jsxs("div",{className:"space-y-4",children:[s.toxicity_monitoring&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200",children:"Toxicity Monitoring"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Details available"})]}),s.dose_modifications&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200",children:"Dose Modifications"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Details available"})]})]}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("p",{children:["Created by: ",s.created_by||"Unknown"]}),e.jsxs("p",{children:["Updated by: ",s.updated_by||"Unknown"]})]})]})},Ea=s=>{if(!s||typeof s!="object")return!1;const t=s;return typeof t.id=="string"&&typeof t.code=="string"&&typeof t.tumour_group=="string"},Pa=s=>{const t=r=>{if(typeof r=="string"){const n=r.trim();if(n.startsWith("{")&&n.endsWith("}")||n.startsWith("[")&&n.endsWith("]"))try{return JSON.parse(n)}catch{return console.warn("Invalid JSON:",r),r}return r}return r};console.log("Raw treatment data:",s.treatment);const a={id:s.id,code:s.code,tumour_group:s.tumour_group,treatment_intent:s.treatment_intent||"",eligibility:t(s.eligibility),treatment:t(s.treatment),tests:t(s.tests),dose_modifications:t(s.dose_modifications),precautions:t(s.precautions),reference_list:t(s.reference_list),toxicity_monitoring:t(s.toxicity_monitoring),supportive_care:t(s.supportive_care),drug_class:t(s.drug_class),interactions:t(s.interactions),administration_notes:s.administration_notes||[],pre_medications:t(s.pre_medications),post_medications:t(s.post_medications),rescue_agents:t(s.rescue_agents)};return console.log("Transformed protocol:",{id:a.id,code:a.code,treatment:a.treatment}),a},ss=async s=>{try{let t=es.from("cd_protocols").select("*");s&&(s.tumorGroup&&(t=t.eq("tumour_group",s.tumorGroup)),s.treatmentIntent&&(t=t.eq("treatment_intent",s.treatmentIntent)),s.drugName&&(t=t.contains("treatment->>drugs",s.drugName)));const{data:a,error:r}=await t;if(console.log("[CDU] cd_protocols data:",a),r)throw r;if(!(a!=null&&a.length))return[];a.forEach((g,h)=>{["id","code","tumour_group","treatment"].forEach(m=>{m in g||console.warn(`[CDU] cd_protocols row missing field: ${m} (row #${h})`,g)})});const n=[];return a.forEach((g,h)=>{if(Ea(g))try{const m=Pa(g);n.push(m)}catch(m){console.warn(`Failed to process protocol at index ${h}:`,m)}else console.warn(`Invalid protocol data at index ${h}`)}),n}catch(t){throw console.error("Error fetching protocols:",t),new Error(`Failed to fetch protocols: ${t instanceof Error?t.message:String(t)}`)}},We=({error:s="An error occurred while loading the protocol.",type:t="error",onRetry:a})=>{const r=Ps(),g={"not-found":{icon:Ye,title:"Protocol Not Found",message:"The requested protocol could not be found.",color:"text-yellow-500",actionText:"Back to Protocols"},error:{icon:Ks,title:"Error Loading Protocol",message:s,color:"text-red-600",actionText:"Retry"},"no-results":{icon:Ye,title:"No Results Found",message:"No protocols match your search criteria.",color:"text-gray-500",actionText:"Clear Filters"}}[t],h=g.icon;return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] p-6",children:[e.jsx(h,{className:`w-12 h-12 mb-4 ${g.color}`}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:g.title}),e.jsx("p",{className:"text-gray-600 text-center mb-6",children:g.message}),e.jsx("div",{className:"flex gap-4",children:t==="error"&&a?e.jsxs(re,{onClick:a,variant:"outline",children:[e.jsx(Tt,{className:"w-4 h-4 mr-2"}),g.actionText]}):e.jsx(re,{onClick:()=>r("/protocols"),variant:"outline",children:g.actionText})})]})};function K({className:s,...t}){return e.jsx("div",{className:D("animate-pulse rounded-md bg-primary-foreground/10",s),...t})}const Ws=()=>e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(K,{className:"h-8 w-48"})," ",e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{className:"h-5 w-24"})," ",e.jsx(K,{className:"h-5 w-24"})," "]})]}),e.jsx(K,{className:"h-9 w-32"})," "]}),e.jsx("div",{className:"bg-white rounded-lg p-6 space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(K,{className:"h-6 w-24"})," ",e.jsxs("div",{className:"space-y-3",children:[e.jsx(K,{className:"h-4 w-full"}),e.jsx(K,{className:"h-4 w-3/4"}),e.jsx(K,{className:"h-4 w-5/6"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(K,{className:"h-6 w-24"})," ",e.jsx("div",{className:"space-y-3",children:[1,2].map(s=>e.jsxs("div",{className:"p-2 bg-gray-50 rounded",children:[e.jsx(K,{className:"h-5 w-32 mb-2"}),e.jsx(K,{className:"h-4 w-48"})]},s))})]})]})})]}),Ma=()=>{const[s,t]=i.useState([]),[a,r]=i.useState(!0),[n,g]=i.useState(null);return i.useEffect(()=>{(async()=>{try{r(!0),g(null),console.log("Fetching protocols...");const m=await ss({tumorGroup:null,drugName:null,treatmentIntent:null});console.log("Protocols:",m),t(m)}catch(m){console.error("Error fetching protocols:",m),g("Failed to load protocols. Please try again.")}finally{r(!1)}})()},[]),a?e.jsx(Ws,{}):n?e.jsx(We,{error:n,type:"error"}):e.jsx(At.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},className:"min-h-screen bg-gradient-to-br from-gray-50 to-white dark:from-gray-900 dark:to-gray-800 p-4",children:s.length===0?e.jsx("div",{className:"text-center text-gray-500 dark:text-gray-400 mt-8",children:"No protocols found."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(h=>e.jsx(Ia,{protocol:h},h.code))})})},Ra=({monitoring:s,onAddNew:t})=>{var g,h;if(!s||!((g=s.baseline)!=null&&g.length)&&!((h=s.ongoing)!=null&&h.length))return e.jsxs("div",{className:"text-muted-foreground space-y-4",children:[e.jsx("p",{children:"No monitoring tests defined."}),t&&e.jsxs(re,{onClick:t,variant:"outline",className:"text-sm",children:[e.jsx(Dt,{className:"w-4 h-4 mr-1"}),"Add New Monitoring Test"]})]});const r=(s==null?void 0:s.baseline)&&s.baseline.length>0,n=(s==null?void 0:s.ongoing)&&s.ongoing.length>0;return e.jsxs("div",{className:"space-y-4",children:[r&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm text-muted-foreground",children:"Baseline Tests"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:s.baseline.map((m,j)=>e.jsxs("li",{children:[e.jsx("strong",{children:"Test:"})," ",m.test,", ",e.jsx("strong",{children:"Purpose:"})," ",m.purpose,", ",e.jsx("strong",{children:"Frequency:"})," ",m.frequency]},`baseline-${j}`))})]}),n&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm text-muted-foreground",children:"Ongoing Monitoring"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:s.ongoing.map((m,j)=>e.jsxs("li",{children:[e.jsx("strong",{children:"Test:"})," ",m.test,", ",e.jsx("strong",{children:"Purpose:"})," ",m.purpose,", ",e.jsx("strong",{children:"Frequency:"})," ",m.frequency]},`ongoing-${j}`))})]})]})},Oa=({treatment:s})=>{if(!s)return e.jsx("p",{className:"text-muted-foreground",children:"No treatment information available."});const{drugs:t=[],schedule:a,cycles:r,notes:n}=s;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Drugs"}),t&&t.length>0?e.jsx("ul",{className:"list-disc list-inside space-y-1",children:t.map((g,h)=>e.jsxs("li",{children:[e.jsx("strong",{children:g.name}),g.dose?` – ${g.dose}`:"",g.administration?` (${g.administration})`:""]},h))}):e.jsx("p",{className:"text-muted-foreground",children:"No drugs specified."})]}),a&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Schedule"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:a})]}),r&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Cycles"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:r})]}),n&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Notes"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 whitespace-pre-line",children:n})]})]})},La=({tests:s})=>{if(!s)return e.jsx("p",{className:"text-muted-foreground",children:"No tests information available."});if(!Array.isArray(s)){const{baseline:t=[],monitoring:a=[]}=s;return t.length===0&&a.length===0?e.jsx("p",{className:"text-muted-foreground",children:"No tests information available."}):e.jsxs("div",{className:"space-y-6",children:[t.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Baseline Tests"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:t.map((r,n)=>e.jsx("li",{children:r},`baseline-${n}`))})]}),a.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Ongoing Tests"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:a.map((r,n)=>e.jsx("li",{children:r},`monitoring-${n}`))})]})]})}return s.length===0?e.jsx("p",{className:"text-muted-foreground",children:"No tests information available."}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Required Tests"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Test"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Timing"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Notes"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:s.map((t,a)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:t.name||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:t.timing||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-pre-line text-sm text-gray-500 dark:text-gray-400",children:t.notes||"N/A"})]},a))})]})})]})},Fa=({doseModifications:s=[]})=>!s||s.length===0?e.jsx("p",{className:"text-muted-foreground",children:"No dose modification information available."}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Dose Modification Guidelines"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Condition"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Recommended Modification"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:s.map((t,a)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-pre-line text-sm text-gray-900 dark:text-gray-100",children:t.condition||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-pre-line text-sm text-gray-500 dark:text-gray-400",children:t.modification||"N/A"})]},a))})]})})]}),Ba=({supportiveCare:s=[]})=>!s||s.length===0?e.jsx("p",{className:"text-muted-foreground",children:"No supportive care information available."}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Supportive Care Guidelines"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Type"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Description"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Timing"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:s.map((t,a)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:t.type||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-pre-line text-sm text-gray-500 dark:text-gray-400",children:t.description||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:t.timing||"N/A"})]},a))})]})})]}),$a=({overview:s})=>e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Overview"}),s?e.jsx("p",{className:"text-gray-700 dark:text-gray-300 whitespace-pre-line",children:s}):e.jsx("p",{className:"text-muted-foreground",children:"No overview information."})]}),Va=({lastReviewed:s,version:t,status:a,createdBy:r,updatedBy:n,createdAt:g,updatedAt:h})=>e.jsxs("div",{className:"space-y-4",children:[t&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Version"}),e.jsx("p",{children:t})]}),a&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Status"}),e.jsx("p",{children:a})]}),s&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Last Reviewed"}),e.jsx("p",{children:new Date(s).toLocaleDateString()})]}),(r||g)&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Created"}),r&&e.jsxs("p",{children:["By: ",r]}),g&&e.jsxs("p",{children:["On: ",new Date(g).toLocaleDateString()]})]}),(n||h)&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Last Updated"}),n&&e.jsxs("p",{children:["By: ",n]}),h&&e.jsxs("p",{children:["On: ",new Date(h).toLocaleDateString()]})]})]}),Ka=({protocol:s,open:t,onOpenChange:a})=>{var x,u,_,C,I,M;const r=G.useMemo(()=>s.monitoring||{baseline:[],ongoing:[]},[s.monitoring]),n=G.useMemo(()=>s.treatment||{drugs:[]},[s.treatment]),g=G.useMemo(()=>Array.isArray(s.tests)?{baseline:[],monitoring:[]}:s.tests||{baseline:[],monitoring:[]},[s.tests]),h=G.useMemo(()=>s.dose_modifications||{hematological:[],nonHematological:[],renal:[],hepatic:[]},[s.dose_modifications]),m=G.useMemo(()=>s.toxicity_monitoring||{expected_toxicities:[],monitoring_parameters:"",frequency_details:"",thresholds_for_action:{}},[s.toxicity_monitoring]),j=G.useMemo(()=>s.supportive_care||{required:[],optional:[],monitoring:[]},[s.supportive_care]),l=G.useMemo(()=>s.interactions||{drugs_to_avoid:[],contraindications:[],precautions_with_other_drugs:[]},[s.interactions]);return e.jsx(De,{open:t,onOpenChange:a,children:e.jsxs(ke,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Me,{children:[e.jsx(Qe,{children:s.code||"Protocol Details"}),e.jsx(Js,{children:s.summary||"Treatment protocol details"})]}),e.jsxs(ba,{defaultValue:"overview",className:"w-full",children:[e.jsxs(Gs,{className:"mb-4 flex flex-wrap",children:[e.jsx(z,{value:"overview",children:"Overview"}),e.jsx(z,{value:"treatment",children:"Treatment"}),e.jsx(z,{value:"tests",children:"Tests"}),e.jsx(z,{value:"monitoring",children:"Monitoring"}),e.jsx(z,{value:"doseModifications",children:"Dose Modifications"}),e.jsx(z,{value:"toxicity",children:"Toxicity"}),e.jsx(z,{value:"interactions",children:"Interactions"}),e.jsx(z,{value:"supportiveCare",children:"Supportive Care"}),e.jsx(z,{value:"info",children:"Info"})]}),e.jsx(H,{value:"overview",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx($a,{overview:s.summary}),s.eligibility&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Eligibility Criteria"}),Array.isArray(s.eligibility)?e.jsx("ul",{className:"list-disc list-inside",children:s.eligibility.map((p,d)=>e.jsx("li",{children:p},d))}):e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"font-medium mb-1",children:"Inclusion Criteria"}),e.jsx("ul",{className:"list-disc list-inside mb-2",children:(x=s.eligibility.inclusion_criteria)==null?void 0:x.map((p,d)=>e.jsx("li",{children:p},d))}),e.jsx("h4",{className:"font-medium mb-1",children:"Exclusion Criteria"}),e.jsx("ul",{className:"list-disc list-inside",children:(u=s.eligibility.exclusion_criteria)==null?void 0:u.map((p,d)=>e.jsx("li",{children:p},d))})]})]})]})}),e.jsx(H,{value:"treatment",children:e.jsx(Oa,{treatment:n})}),e.jsx(H,{value:"tests",children:e.jsx(La,{tests:g})}),e.jsx(H,{value:"monitoring",children:e.jsx(Ra,{monitoring:r})}),e.jsx(H,{value:"doseModifications",children:e.jsx(Fa,{doseModifications:h})}),e.jsx(H,{value:"toxicity",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Expected Toxicities"}),((_=m.expected_toxicities)==null?void 0:_.length)>0?e.jsx("ul",{className:"list-disc list-inside",children:m.expected_toxicities.map((p,d)=>e.jsx("li",{children:p},d))}):e.jsx("p",{className:"text-muted-foreground",children:"No expected toxicities specified."})]}),m.monitoring_parameters&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Monitoring Parameters"}),e.jsx("p",{className:"whitespace-pre-line",children:m.monitoring_parameters})]}),m.frequency_details&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Monitoring Frequency"}),e.jsx("p",{className:"whitespace-pre-line",children:m.frequency_details})]}),Object.keys(m.thresholds_for_action||{}).length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Action Thresholds"}),e.jsx("div",{className:"grid gap-2",children:Object.entries(m.thresholds_for_action).map(([p,d],f)=>e.jsxs("div",{className:"bg-muted p-2 rounded-md",children:[e.jsxs("span",{className:"font-medium",children:[p,":"]})," ",d]},f))})]})]})}),e.jsx(H,{value:"interactions",children:e.jsxs("div",{className:"space-y-6",children:[((C=l.drugs_to_avoid)==null?void 0:C.length)>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Drugs to Avoid"}),e.jsx("ul",{className:"list-disc list-inside",children:l.drugs_to_avoid.map((p,d)=>e.jsx("li",{children:p},d))})]}),((I=l.contraindications)==null?void 0:I.length)>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Contraindications"}),e.jsx("ul",{className:"list-disc list-inside",children:l.contraindications.map((p,d)=>e.jsx("li",{children:p},d))})]}),((M=l.precautions_with_other_drugs)==null?void 0:M.length)>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Precautions with Other Drugs"}),e.jsx("ul",{className:"list-disc list-inside",children:l.precautions_with_other_drugs.map((p,d)=>e.jsx("li",{children:p},d))})]})]})}),e.jsx(H,{value:"supportiveCare",children:e.jsx(Ba,{supportiveCare:j})}),e.jsx(H,{value:"info",children:e.jsx(Va,{lastReviewed:s.last_reviewed,version:s.version,status:s.status,createdBy:s.created_by,updatedBy:s.updated_by,createdAt:s.created_at,updatedAt:s.updated_at})})]})]})})},Ua=({protocol:s})=>{var m,j,l;const t=Ps(),[a,r]=i.useState("overview"),[n,g]=i.useState(!1),h=()=>{t(-1)};return s.code,s.tumour_group,s.treatment_intent&&s.treatment_intent,s.eligibility&&(Array.isArray(s.eligibility)?s.eligibility.map((x,u)=>e.jsx("li",{children:x},u)):Object.entries(s.eligibility).map(([x,u])=>e.jsxs("li",{children:[e.jsxs("strong",{children:[x,":"]})," ",Array.isArray(u)?u.join(", "):u]},x))),(m=s.treatment)!=null&&m.drugs&&s.treatment.drugs.length>0?s.treatment.drugs.map((x,u)=>e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-slate-200 hover:border-slate-300 transition-colors",children:[e.jsx("h3",{className:"font-semibold text-lg text-indigo-700 dark:text-indigo-400",children:x.name}),e.jsxs("div",{className:"mt-3 space-y-3",children:[x.dose&&e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx("span",{className:"font-medium min-w-[80px]",children:"Dose:"}),e.jsx("span",{className:"text-gray-700",children:x.dose})]}),x.administration&&e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx("span",{className:"font-medium min-w-[80px]",children:"Administration:"}),e.jsx("span",{className:"text-gray-700",children:x.administration})]}),x.timing&&e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx("span",{className:"font-medium min-w-[80px]",children:"Timing:"}),e.jsx("span",{className:"text-gray-700",children:x.timing})]}),x.alternative_switches&&x.alternative_switches.length>0&&e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx("span",{className:"font-medium min-w-[80px]",children:"Alternatives:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:x.alternative_switches.map((_,C)=>e.jsx(P,{variant:"secondary",children:_},C))})]}),x.special_notes&&x.special_notes.length>0&&e.jsxs("div",{className:"mt-3 bg-blue-50 p-3 rounded-lg",children:[e.jsx("div",{className:"font-medium text-blue-800 mb-2",children:"Special Notes"}),e.jsx("ul",{className:"list-disc pl-4 space-y-1",children:x.special_notes.map((_,C)=>e.jsx("li",{className:"text-sm text-blue-700",children:_},C))})]})]})]},u)):we,s.tests&&(e.Fragment,s.tests.baseline&&s.tests.baseline.length>0&&s.tests.baseline.map((x,u)=>e.jsx("li",{className:"text-gray-700",children:x},u)),s.tests.monitoring&&s.tests.monitoring.length>0&&s.tests.monitoring.map((x,u)=>e.jsxs("li",{children:[e.jsx("strong",{children:"Test:"})," ",x.test,", ",e.jsx("strong",{children:"Purpose:"})," ",x.purpose,", ",e.jsx("strong",{children:"Frequency:"})," ",x.frequency]},u))),s.toxicity_monitoring&&(s.toxicity_monitoring.expected_toxicities&&s.toxicity_monitoring.expected_toxicities.length>0&&s.toxicity_monitoring.expected_toxicities.map((x,u)=>e.jsx("li",{className:"text-amber-700",children:x},u))),s.precautions&&s.precautions.length>0&&s.precautions.map((x,u)=>e.jsx("li",{className:"text-red-600",children:x},u)),e.jsx("div",{className:"container mx-auto max-w-7xl p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(re,{variant:"ghost",onClick:h,children:[e.jsx(It,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:s.code}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx(P,{variant:"outline",children:s.tumour_group}),s.treatment_intent&&e.jsx(P,{children:s.treatment_intent})]})]})]}),e.jsx(re,{onClick:()=>g(!0),children:"View Full Details"})]}),e.jsx(Ka,{protocol:s,open:n,onOpenChange:g}),e.jsx("div",{className:"bg-white rounded-lg p-6 space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Overview"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Code:"})," ",s.code]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Tumor Group:"})," ",s.tumour_group]}),s.treatment_intent&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Intent:"})," ",s.treatment_intent]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Drugs"}),e.jsxs("div",{className:"space-y-2",children:[(j=s.treatment)!=null&&j.drugs&&s.treatment.drugs.length>0?s.treatment.drugs.slice(0,2).map((x,u)=>e.jsxs("div",{className:"p-2 bg-gray-50 rounded",children:[e.jsx("p",{className:"font-medium text-indigo-600",children:x.name}),x.dose&&e.jsx("p",{className:"text-sm text-gray-600",children:x.dose})]},u)):e.jsx("p",{className:"text-gray-500",children:"No drugs specified"}),((l=s.treatment)==null?void 0:l.drugs)&&s.treatment.drugs.length>2&&e.jsx(re,{variant:"link",onClick:()=>g(!0),children:"View all drugs..."})]})]})]})})]})})},qa=()=>{const s=gt(),{id:t}=ht(),[a,r]=i.useState(null),[n,g]=i.useState(!0),[h,m]=i.useState(null),j=i.useCallback(async()=>{var l,x,u;console.log("🔍 Protocol Detail Container - Fetching protocol:",{id:t,hasLocationState:!!s.state,locationProtocol:(l=s.state)==null?void 0:l.protocol}),g(!0),m(null);try{if((x=s.state)!=null&&x.protocol){console.log("📋 Using protocol from location state"),r(s.state.protocol),g(!1);return}if(!t)throw new Error("No protocol ID provided");const _=await ss(t);if(!_){r(null),m("Protocol not found");return}console.log("📋 Protocol loaded:",{id:_.id,code:_.code,hasDrugs:(((u=_.treatment)==null?void 0:u.drugs)||[]).length>0}),r(_)}catch(_){console.error("❌ Error loading protocol:",_),r(null),m(_ instanceof Error?_.message:"Failed to load protocol")}finally{g(!1)}},[t,s.state]);return i.useEffect(()=>{j()},[j]),n?e.jsx(Ws,{}):h?e.jsx(We,{error:h,type:h==="Protocol not found"?"not-found":"error",onRetry:j}):a?e.jsx(Ua,{protocol:a}):e.jsx(We,{type:"not-found"})},za=s=>{var t,a,r;return{id:s.id||crypto.randomUUID(),name:s.name||"Not specified",severity:s.severity||"Not specified",grading_scale:s.grading_scale||"CTCAE v5.0",recognition:s.recognition||"",symptoms:Array.isArray(s.symptoms)?s.symptoms:[],signs:Array.isArray(s.signs)?s.signs:[],imaging:Array.isArray(s.imaging)?s.imaging:[],labs:Array.isArray(s.labs)?s.labs:[],clinical_category:s.clinical_category||"Uncategorized",symptom_onset:s.symptom_onset||"",expected_onset:s.expected_onset||"",onset_timing_days:s.onset_timing_days||0,reversibility:s.reversibility||"Unknown",toxicity_type:s.toxicity_type||"Unknown",is_dose_limiting:!!s.is_dose_limiting,requires_hospitalization:!!s.requires_hospitalization,toxicity_risk_factors:Array.isArray(s.toxicity_risk_factors)?s.toxicity_risk_factors:[],management:Array.isArray(s.management)?s.management:[],dose_guidance:Array.isArray(s.dose_guidance)?s.dose_guidance:[],culprit_drugs:Array.isArray(s.culprit_drugs)?s.culprit_drugs:[],culprit_classes:Array.isArray(s.culprit_classes)?s.culprit_classes:[],intervention_required:Array.isArray(s.intervention_required)?s.intervention_required:[],monitoring_recommendations:Array.isArray(s.monitoring_recommendations)?s.monitoring_recommendations:[],lab_triggers:Array.isArray(s.lab_triggers)?s.lab_triggers:[],related_toxicity_ids:Array.isArray(s.related_toxicity_ids)?s.related_toxicity_ids:[],monitoring_frequency:{initial:((t=s.monitoring_frequency)==null?void 0:t.initial)||"Not specified",followup:((a=s.monitoring_frequency)==null?void 0:a.followup)||"Not specified",longterm:((r=s.monitoring_frequency)==null?void 0:r.longterm)||"Not specified"},reference_data:s.reference_data||{},source_reference:s.source_reference||"",notes:s.notes||"",notes_clinical_pearls:s.notes_clinical_pearls||"",notes_ui_display:s.notes_ui_display||"",toxicity_score_weight:s.toxicity_score_weight||0,created_at:s.created_at||new Date().toISOString(),updated_at:s.updated_at||new Date().toISOString()}},Ha=async()=>{try{const{data:s,error:t}=await es.from("toxicities").select(`
        id, name, severity, grading_scale, recognition,
        symptoms, signs, imaging, labs, clinical_category,
        symptom_onset, expected_onset, onset_timing_days,
        reversibility, toxicity_type, is_dose_limiting,
        requires_hospitalization, toxicity_risk_factors,
        management, dose_guidance, culprit_drugs,
        culprit_classes, intervention_required,
        monitoring_recommendations, lab_triggers,
        related_toxicity_ids, monitoring_frequency,
        reference_data, source_reference, notes,
        notes_clinical_pearls, notes_ui_display,
        toxicity_score_weight, created_at, updated_at
      `);if(t)throw new Error(`Toxicity fetch error: ${t.message}`);return(s||[]).map(a=>za(a))}catch(s){throw console.error("Error fetching toxicities:",s),s}},Ga=({type:s,title:t,message:a,className:r=""})=>{const n={warning:"bg-yellow-50 border-yellow-400 text-yellow-800",error:"bg-red-50 border-red-400 text-red-800",success:"bg-green-50 border-green-400 text-green-800",info:"bg-blue-50 border-blue-400 text-blue-800"},g={warning:e.jsx(xe,{className:"w-5 h-5 mr-2"}),error:e.jsx(ae,{className:"w-5 h-5 mr-2"}),success:e.jsx(Pt,{className:"w-5 h-5 mr-2"}),info:e.jsx(Et,{className:"w-5 h-5 mr-2"})},h=Array.isArray(a)?a:[a];return e.jsxs("div",{className:`p-4 mb-4 border-l-4 rounded-r ${n[s]} ${r}`,children:[e.jsxs("div",{className:"flex items-center",children:[g[s],e.jsx("h3",{className:"font-semibold",children:t})]}),e.jsx("div",{className:"mt-2",children:h.map((m,j)=>e.jsx("p",{className:"text-sm leading-snug",children:m},j))})]})},Ya=s=>s.includes("4")?"bg-red-100 text-red-800":s.includes("3")?"bg-orange-100 text-orange-800":s.includes("2")?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800",Ja=s=>s.includes("4")?"border-red-500":s.includes("3")?"border-orange-500":s.includes("2")?"border-yellow-500":"border-green-500",Wa=({toxicity:s,isOpen:t,onToggle:a})=>e.jsxs("div",{className:`bg-white/90 rounded-lg shadow-sm border-l-4 transition-all duration-200 ${Ja(s.severity)}`,children:[e.jsxs("button",{onClick:a,className:"flex items-center justify-between w-full px-3 py-2 text-left hover:bg-gray-50/50","aria-expanded":t,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-base font-medium text-gray-900",children:s.name}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${Ya(s.severity)}`,children:s.severity}),s.is_dose_limiting&&e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-red-50 text-red-700",children:"DLT"})]}),e.jsx(Xe,{className:`h-4 w-4 text-gray-500 transform transition-transform duration-300 ${t?"rotate-180":""}`})]}),t&&e.jsx("div",{className:"px-3 pb-3 text-sm",children:e.jsxs("div",{className:"space-y-3 pt-1",children:[e.jsxs("section",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-1",children:"Clinical Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Category:"}),e.jsx("span",{className:"ml-1 text-gray-900",children:s.clinical_category})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Grade:"}),e.jsx("span",{className:"ml-1 text-gray-900",children:s.grading_scale})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Onset:"}),e.jsx("span",{className:"ml-1 text-gray-900",children:s.expected_onset})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Reversibility:"}),e.jsx("span",{className:"ml-1 text-gray-900",children:s.reversibility})]})]})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-1",children:"Recognition"}),e.jsx("p",{className:"leading-snug text-gray-700 mb-2",children:s.recognition}),s.symptoms.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Symptoms"}),e.jsx("ul",{className:"list-disc pl-4 space-y-0.5",children:s.symptoms.map((r,n)=>e.jsx("li",{className:"text-gray-600",children:r},n))})]})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-1",children:"Management"}),e.jsx("ul",{className:"list-disc pl-4 space-y-0.5",children:s.management.map((r,n)=>e.jsx("li",{className:"text-gray-700 leading-snug",children:r},n))})]}),s.monitoring_recommendations.length>0&&e.jsxs("section",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-1",children:"Monitoring"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block",children:"Initial:"}),e.jsx("span",{className:"text-gray-900",children:s.monitoring_frequency.initial})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block",children:"Follow-up:"}),e.jsx("span",{className:"text-gray-900",children:s.monitoring_frequency.followup})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block",children:"Long-term:"}),e.jsx("span",{className:"text-gray-900",children:s.monitoring_frequency.longterm})]})]}),e.jsx("ul",{className:"list-disc pl-4 space-y-0.5 mt-2",children:s.monitoring_recommendations.map((r,n)=>e.jsx("li",{className:"text-gray-700 leading-snug",children:r},n))})]})]}),(s.labs.length>0||s.imaging.length>0)&&e.jsxs("section",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-1",children:"Investigations"}),s.labs.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Laboratory Tests"}),e.jsx("ul",{className:"list-disc pl-4 space-y-0.5",children:s.labs.map((r,n)=>e.jsx("li",{className:"text-gray-600",children:r},n))})]}),s.imaging.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Imaging"}),e.jsx("ul",{className:"list-disc pl-4 space-y-0.5",children:s.imaging.map((r,n)=>e.jsx("li",{className:"text-gray-600",children:r},n))})]})]}),s.dose_guidance.length>0&&e.jsxs("section",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-1",children:"Dose Modification"}),e.jsx("div",{className:"space-y-0.5",children:s.dose_guidance.map((r,n)=>e.jsx("p",{className:"leading-snug text-gray-700",children:r},n))})]}),(s.culprit_drugs.length>0||s.culprit_classes.length>0)&&e.jsxs("section",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-1",children:"Causative Agents"}),s.culprit_drugs.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mb-1",children:s.culprit_drugs.map((r,n)=>e.jsx("span",{className:"px-2 py-0.5 text-xs bg-purple-50 text-purple-700 rounded-full",children:r},n))}),s.culprit_classes.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:s.culprit_classes.map((r,n)=>e.jsx("span",{className:"px-2 py-0.5 text-xs bg-blue-50 text-blue-700 rounded-full",children:r},n))})]}),s.notes_clinical_pearls&&e.jsxs("section",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-1",children:"Clinical Pearls"}),e.jsx("p",{className:"text-gray-700 leading-snug whitespace-pre-wrap",children:s.notes_clinical_pearls})]})]})})]}),Xa=()=>{const[s,t]=i.useState([]),[a,r]=i.useState(!0),[n,g]=i.useState(null),[h,m]=i.useState(null);return i.useEffect(()=>{async function j(){try{const l=await Ha();t(l)}catch(l){const x=l instanceof Error?l.message:"Unknown error";g(`Failed to load toxicity data: ${x}`),console.error("Error fetching toxicities:",l)}finally{r(!1)}}j()},[]),e.jsxs("div",{className:"h-screen flex flex-col",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white/90 backdrop-blur-sm border-b px-4 py-2",children:e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Toxicity Management"})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx("div",{className:"h-full p-4",children:a?e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx(Mt,{className:"h-6 w-6 text-indigo-600 animate-spin"})}):n?e.jsx(Ga,{type:"error",title:"Error Loading Data",message:n}):s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-500",children:[e.jsx(Ks,{className:"h-8 w-8 mb-2"}),e.jsx("p",{children:"No toxicity data available"})]}):e.jsx("div",{className:"h-full overflow-y-auto scrollbar-thin pr-2",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:s.map((j,l)=>e.jsx(Wa,{toxicity:j,isOpen:h===l,onToggle:()=>m(h===l?null:l)},j.id))})})})})]})},Za=[{diagnosis:"Breast Cancer",stage:"I",name:"AC-T Protocol",premedications:["Dexamethasone","Ondansetron","Diphenhydramine","Fosaprepitant"]},{diagnosis:"Breast Cancer",stage:"II",name:"FEC-T Protocol",premedications:["Dexamethasone","Aprepitant","Ondansetron","Lorazepam"]},{diagnosis:"Breast Cancer",stage:"III",name:"TCHP Protocol",premedications:["Dexamethasone","Ondansetron","Diphenhydramine","Famotidine"]},{diagnosis:"Breast Cancer",stage:"IV",name:"Palliative Capecitabine",premedications:["Dexamethasone","Ondansetron"]},{diagnosis:"Colorectal Cancer",stage:"II",name:"FOLFOX6",premedications:["Dexamethasone","Ondansetron","Calcium gluconate","Magnesium sulfate"]},{diagnosis:"Colorectal Cancer",stage:"III",name:"FOLFOX + Avastin",premedications:["Dexamethasone","Ranitidine","Ondansetron","Calcium gluconate"]},{diagnosis:"Colorectal Cancer",stage:"IV",name:"FOLFIRI + Avastin",premedications:["Dexamethasone","Ondansetron","Atropine","Diphenhydramine"]},{diagnosis:"Lung Cancer",stage:"I",name:"Surgery + Observation",premedications:[]},{diagnosis:"Lung Cancer",stage:"III",name:"Concurrent Chemoradiation",premedications:["Dexamethasone","Ondansetron","Fosaprepitant"]},{diagnosis:"Lung Cancer",stage:"IV",name:"Platinum Doublet",premedications:["Dexamethasone","Granisetron","Fosaprepitant","Lorazepam"]},{diagnosis:"Ovarian Cancer",stage:"III",name:"Carboplatin + Paclitaxel",premedications:["Dexamethasone","Diphenhydramine","Ranitidine","Ondansetron"]},{diagnosis:"Lymphoma",stage:"Any",name:"R-CHOP",premedications:["Acetaminophen","Diphenhydramine","Ondansetron","Mesna"]},{diagnosis:"Leukemia",stage:"Any",name:"7+3 Induction",premedications:["Dexamethasone","Ondansetron","Allopurinol"]},{diagnosis:"Melanoma",stage:"IV",name:"Immunotherapy (PD-1)",premedications:["Acetaminophen","Diphenhydramine"]},{diagnosis:"Prostate Cancer",stage:"IV",name:"ADT + Docetaxel",premedications:["Dexamethasone","Ondansetron","Famotidine"]},{diagnosis:"Other",stage:"Any",name:"Consider Clinical Trial",premedications:[]}],ze="disease-progress-tracker-data",Qa={"Breast Cancer":["AC→T","FEC→D","T-DM1","Kadcyla"],"Colorectal Cancer":["FOLFOX","FOLFIRI","FOLFOXIRI","CAPOX"],"Lung Cancer":["Carbo + Pemetrexed","Osimertinib","Durvalumab"],"Prostate Cancer":["Docetaxel","Abiraterone","Enzalutamide"],Lymphoma:["R-CHOP","ABVD","Bendamustine + Rituximab"],Leukemia:["7+3 Regimen","FLAG-IDA","Blinatumomab"],Melanoma:["Nivolumab + Ipilimumab","Pembrolizumab"],"Ovarian Cancer":["Carboplatin + Paclitaxel","Bevacizumab"],Other:[]},er=["Breast Cancer","Colorectal Cancer","Lung Cancer","Prostate Cancer","Ovarian Cancer","Lymphoma","Leukemia","Melanoma","Other"],sr=["HER2 Positive","KRAS Mutant","EGFR Mutant","ALK Rearrangement","MSI-High","PD-L1 Positive","BRAF V600E","TP53 Mutant","Other"],tr=[{title:"Disease Status",icon:Rt},{title:"Performance Status",icon:Ne},{title:"Progression",icon:Ot},{title:"Lines of Treatment",icon:Lt},{title:"AI Assistant",icon:Ft}],ar=()=>{const{toast:s}=Ca(),[t,a]=i.useState(0),[r,n]=i.useState(!1),[g,h]=i.useState([]),m=()=>!l||!C?[]:Za.filter(o=>o.diagnosis===(l==="Other"?u:l)&&(o.stage===C||o.stage==="Any")),j=()=>{const o=m();return o.length?[...new Set(o.flatMap(k=>k.premedications||[]))]:[]},[l,x]=i.useState(""),[u,_]=i.useState(""),[C,I]=i.useState(""),[M,p]=i.useState(""),[d,f]=i.useState(""),[y,F]=i.useState(""),[W,Y]=i.useState(""),[X,B]=i.useState(""),[Z,O]=i.useState(""),[J,U]=i.useState(""),[c,v]=i.useState(""),[b,E]=i.useState(""),[$,L]=i.useState(""),[V,R]=i.useState(""),[ge,ie]=i.useState(""),[he,ne]=i.useState(""),[ue,le]=i.useState(""),[se,oe]=i.useState(""),[pe,ce]=i.useState(""),[ye,de]=i.useState(""),[fe,me]=i.useState(""),[N,w]=i.useState(""),[as,Re]=i.useState(""),[et,st]=i.useState(""),[rs,tt]=i.useState(null),at=()=>{const o=M==="Other"?d:M;let k=`🧠 Smart Treatment Suggestions:
`;if(o)switch(o){case"HER2 Positive":k+=`- Consider T-DM1 or Trastuzumab-based therapy
`,k+=`- Dual HER2 blockade may be appropriate
`;break;case"KRAS Mutant":k+=`- KRAS mutation limits anti-EGFR therapy options
`,k+=`- Consider MEK inhibitor clinical trials
`;break;case"EGFR Mutant":k+=`- EGFR TKI therapy recommended
`,k+=`- Monitor for T790M resistance mutation
`;break;case"PD-L1 Positive":k+=`- Consider immunotherapy as monotherapy
`,k+=`- Evaluate combination chemo-immunotherapy
`;break;default:k+=`- Consider molecular profiling for targetable mutations
`}if(J){k+=`
💪 Performance Status Considerations:
`;const Q=parseInt(J,10);isNaN(Q)?k+=`- Performance score invalid, please reassess
`:Q<=1?k+=`- Patient fit for full dose therapy
`:Q===2?(k+=`- Consider dose reduction or weekly regimens
`,k+=`- Close monitoring for toxicity needed
`):(k+=`- Best supportive care may be most appropriate
`,k+=`- Avoid aggressive therapy due to poor PS
`)}if(se)switch(k+=`
🎯 Line of Therapy Recommendations:
`,se){case"1st Line":k+=`- Standard first-line protocols preferred
`,k+=`- Consider clinical trial enrollment
`;break;case"2nd Line":k+=`- Review first-line response duration
`,k+=`- Consider alternative drug class
`;break;case"3rd Line":k+=`- Molecular profiling guided therapy
`,k+=`- Early palliative care integration
`;break;case"Maintenance":k+=`- Less intensive continuation approach
`,k+=`- Monitor tolerability closely
`;break}return k},rt=async()=>{try{n(!0);const o=at();await new Promise(k=>setTimeout(k,1e3)),(!l||!C)&&s({title:"Warning",description:"Please provide diagnosis and stage for better suggestions",variant:"destructive"}),tt(o)}catch(o){console.error("AI Suggestion Error:",o),s({title:"Error",description:"Failed to generate AI suggestions",variant:"destructive"})}finally{n(!1)}},it=()=>{var o,k,Q,is,ns,ls,os,cs,ds,ms,xs,gs,hs,us,ps,ys,fs,js,bs,Ns,vs,ws,ks;try{const Se=localStorage.getItem(ze);if(Se){const T=JSON.parse(Se);x(((o=T.diseaseStatus)==null?void 0:o.primaryDiagnosis)||""),_(((k=T.diseaseStatus)==null?void 0:k.otherPrimaryDiagnosis)||""),I(((Q=T.diseaseStatus)==null?void 0:Q.stageAtDiagnosis)||""),p(((is=T.diseaseStatus)==null?void 0:is.histologyMutation)||""),f(((ns=T.diseaseStatus)==null?void 0:ns.otherHistologyMutation)||""),F(((ls=T.diseaseStatus)==null?void 0:ls.dateOfDiagnosis)||""),Y(((os=T.diseaseStatus)==null?void 0:os.diseaseNotes)||""),B(((cs=T.performanceStatus)==null?void 0:cs.assessmentDate)||""),O(((ds=T.performanceStatus)==null?void 0:ds.performanceScale)||""),U(((ms=T.performanceStatus)==null?void 0:ms.performanceScore)||""),v(((xs=T.performanceStatus)==null?void 0:xs.performanceNotes)||""),E(((gs=T.progression)==null?void 0:gs.reassessmentDate)||""),L(((hs=T.progression)==null?void 0:hs.imagingType)||""),R(((us=T.progression)==null?void 0:us.findingsSummary)||""),ie(((ps=T.progression)==null?void 0:ps.markerType)||""),ne(((ys=T.progression)==null?void 0:ys.markerValue)||""),le(((fs=T.progression)==null?void 0:fs.progressionNotes)||""),oe(((js=T.linesOfTreatment)==null?void 0:js.treatmentLine)||""),ce(((bs=T.linesOfTreatment)==null?void 0:bs.treatmentRegimen)||""),de(((Ns=T.linesOfTreatment)==null?void 0:Ns.startDate)||""),me(((vs=T.linesOfTreatment)==null?void 0:vs.endDate)||""),w(((ws=T.linesOfTreatment)==null?void 0:ws.treatmentResponse)||""),Re(((ks=T.linesOfTreatment)==null?void 0:ks.treatmentNotes)||""),s({title:"Success",description:"Previous session data loaded!",variant:"default"})}}catch(Se){console.error("Failed to load from localStorage",Se),s({title:"Warning",description:"Failed to load previous data",variant:"destructive"})}},_e=()=>{const o={diseaseStatus:{primaryDiagnosis:l,otherPrimaryDiagnosis:u,stageAtDiagnosis:C,histologyMutation:M,otherHistologyMutation:d,dateOfDiagnosis:y,diseaseNotes:W},performanceStatus:{assessmentDate:X,performanceScale:Z,performanceScore:J,performanceNotes:c},progression:{reassessmentDate:b,imagingType:$,findingsSummary:V,markerType:ge,markerValue:he,progressionNotes:ue},linesOfTreatment:{treatmentLine:se,treatmentRegimen:pe,startDate:ye,endDate:fe,treatmentResponse:N,treatmentNotes:as}};localStorage.setItem(ze,JSON.stringify(o))};i.useEffect(()=>{it()},[]);const nt=()=>{_e(),s({title:"Success",description:"Disease Status Saved!",variant:"default"})},lt=()=>{_e(),s({title:"Success",description:"Performance Status Saved!",variant:"default"})},ot=()=>{_e(),s({title:"Success",description:"Progression Record Saved!",variant:"default"})},ct=()=>{_e(),s({title:"Success",description:"Line of Treatment Saved!",variant:"default"})},dt=()=>{localStorage.removeItem(ze),x(""),_(""),I(""),p(""),f(""),F(""),Y(""),B(""),O(""),U(""),v(""),E(""),L(""),R(""),ie(""),ne(""),le(""),oe(""),ce(""),de(""),me(""),w(""),Re(""),s({title:"Success",description:"All data cleared!",variant:"default"})};return i.useEffect(()=>{if(l){const o=Qa[l]||[];h(o)}else h([])},[l]),e.jsxs("div",{className:"p-6 bg-white dark:bg-gray-900 rounded-2xl shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-indigo-600 dark:text-indigo-400",children:"📈 Disease & Progress Tracker"}),e.jsx("button",{type:"button",onClick:dt,className:"px-6 py-3 bg-gradient-to-r from-red-500 to-pink-500 text-white font-semibold rounded-lg hover:opacity-90 transition",children:"🗑️ Clear All Data"})]}),e.jsxs(A.Group,{selectedIndex:t,onChange:a,children:[e.jsx(A.List,{className:"flex space-x-4 border-b pb-3 mb-6",children:tr.map((o,k)=>e.jsxs(A,{className:({selected:Q})=>`
              flex items-center gap-2 cursor-pointer py-2 px-4 rounded-lg shadow transition-all duration-300
              ${Q?"bg-gradient-to-r from-indigo-500 to-teal-500 text-white":"bg-white text-gray-600 hover:text-indigo-500 hover:shadow-md"}
            `,children:[e.jsx(o.icon,{className:"w-5 h-5"}),o.title]},k))}),e.jsxs(A.Panels,{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-6",children:[e.jsxs(A.Panel,{children:[e.jsxs("form",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"primary-diagnosis",className:"block text-sm font-medium text-gray-700 mb-1",children:"Primary Diagnosis"}),e.jsxs("select",{id:"primary-diagnosis",value:l,onChange:o=>x(o.target.value),className:"w-full input-field focus:ring-2 focus:ring-indigo-500 transition-all duration-200","aria-label":"Primary Diagnosis",children:[e.jsx("option",{value:"",children:"Select Primary Diagnosis"}),er.map(o=>e.jsx("option",{value:o,children:o},o))]}),l==="Other"&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{htmlFor:"other-diagnosis",className:"block text-sm font-medium text-gray-700 mb-1",children:"Specify Other Diagnosis"}),e.jsx("input",{id:"other-diagnosis",type:"text",value:u,onChange:o=>_(o.target.value),placeholder:"Specify Other Primary Diagnosis",className:"w-full input-field focus:ring-2 focus:ring-indigo-500 transition-all duration-200"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"stage-diagnosis",className:"block text-sm font-medium text-gray-700 mb-1",children:"Stage at Diagnosis"}),e.jsxs("select",{id:"stage-diagnosis",value:C,onChange:o=>I(o.target.value),className:"input-field focus:ring-2 focus:ring-indigo-500 transition-all duration-200","aria-label":"Stage at Diagnosis",children:[e.jsx("option",{value:"",children:"Select Stage"}),e.jsx("option",{value:"I",children:"Stage I"}),e.jsx("option",{value:"II",children:"Stage II"}),e.jsx("option",{value:"III",children:"Stage III"}),e.jsx("option",{value:"IV",children:"Stage IV"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"histology-mutation",className:"block text-sm font-medium text-gray-700 mb-1",children:"Histology/Mutation"}),e.jsxs("select",{id:"histology-mutation",value:M,onChange:o=>p(o.target.value),className:"w-full input-field focus:ring-2 focus:ring-indigo-500 transition-all duration-200","aria-label":"Histology or Mutation",children:[e.jsx("option",{value:"",children:"Select Histology/Mutation"}),sr.map(o=>e.jsx("option",{value:o,children:o},o))]}),M==="Other"&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{htmlFor:"other-mutation",className:"block text-sm font-medium text-gray-700 mb-1",children:"Specify Other Mutation"}),e.jsx("input",{id:"other-mutation",type:"text",value:d,onChange:o=>f(o.target.value),placeholder:"Specify Other Histology/Mutation",className:"w-full input-field focus:ring-2 focus:ring-indigo-500 transition-all duration-200"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"date-diagnosis",className:"block text-sm font-medium text-gray-700 mb-1",children:"Date of Diagnosis"}),e.jsx("input",{id:"date-diagnosis",type:"date",value:y,onChange:o=>F(o.target.value),className:"input-field focus:ring-2 focus:ring-indigo-500 transition-all duration-200","aria-label":"Date of Diagnosis"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"disease-notes",className:"block text-sm font-medium text-gray-700 mb-1",children:"Disease Notes"}),e.jsx("textarea",{id:"disease-notes",value:W,onChange:o=>Y(o.target.value),placeholder:"Disease Notes...",rows:4,className:"textarea-field focus:ring-2 focus:ring-indigo-500 transition-all duration-200"})]})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx("button",{type:"button",onClick:nt,className:"save-button bg-gradient-to-r from-indigo-500 to-purple-500 text-white px-4 py-2 rounded-lg hover:shadow-lg transition-all duration-200",children:"Save Disease Status"})})]}),e.jsxs(A.Panel,{children:[e.jsxs("form",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"assessment-date",className:"block text-sm font-medium text-gray-700 mb-1",children:"Assessment Date"}),e.jsx("input",{id:"assessment-date",type:"date",value:X,onChange:o=>B(o.target.value),className:"input-field focus:ring-2 focus:ring-indigo-500 transition-all duration-200","aria-label":"Assessment Date"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"performance-scale",className:"block text-sm font-medium text-gray-700 mb-1",children:"Performance Scale"}),e.jsxs("select",{id:"performance-scale",value:Z,onChange:o=>O(o.target.value),className:"input-field focus:ring-2 focus:ring-indigo-500 transition-all duration-200","aria-label":"Performance Scale",children:[e.jsx("option",{value:"",children:"Select Scale"}),e.jsx("option",{value:"ecog",children:"ECOG"}),e.jsx("option",{value:"karnofsky",children:"Karnofsky"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"performance-score",className:"block text-sm font-medium text-gray-700 mb-1",children:"Performance Score"}),e.jsxs("select",{id:"performance-score",value:J,onChange:o=>U(o.target.value),className:"input-field focus:ring-2 focus:ring-indigo-500 transition-all duration-200","aria-label":"Performance Score",children:[e.jsx("option",{value:"",children:"Select Score"}),e.jsx("option",{value:"0",children:"0 - Fully active"}),e.jsx("option",{value:"1",children:"1 - Restricted in strenuous activity"}),e.jsx("option",{value:"2",children:"2 - Ambulatory but unable to work"}),e.jsx("option",{value:"3",children:"3 - Limited self-care"}),e.jsx("option",{value:"4",children:"4 - Completely disabled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"performance-notes",className:"block text-sm font-medium text-gray-700 mb-1",children:"Performance Notes"}),e.jsx("textarea",{id:"performance-notes",value:c,onChange:o=>v(o.target.value),placeholder:"Performance Notes...",rows:4,className:"textarea-field focus:ring-2 focus:ring-indigo-500 transition-all duration-200"})]})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx("button",{type:"button",onClick:lt,className:"save-button bg-gradient-to-r from-indigo-500 to-purple-500 text-white px-4 py-2 rounded-lg hover:shadow-lg transition-all duration-200",children:"Save Performance Status"})})]}),e.jsxs(A.Panel,{children:[e.jsxs("form",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"date",value:b,onChange:o=>E(o.target.value),className:"input-field","aria-label":"Reassessment Date",placeholder:"Reassessment Date"}),e.jsxs("select",{value:$,onChange:o=>L(o.target.value),className:"input-field","aria-label":"Imaging Type",children:[e.jsx("option",{value:"",children:"Select Imaging Type"}),e.jsx("option",{value:"CT",children:"CT Scan"}),e.jsx("option",{value:"MRI",children:"MRI"}),e.jsx("option",{value:"PET",children:"PET Scan"}),e.jsx("option",{value:"XRay",children:"X-Ray"})]}),e.jsx("textarea",{value:V,onChange:o=>R(o.target.value),placeholder:"Findings Summary...",rows:4,className:"textarea-field"}),e.jsx("input",{type:"text",value:ge,onChange:o=>ie(o.target.value),placeholder:"Tumor Marker Type",className:"input-field"}),e.jsx("input",{type:"number",value:he,onChange:o=>ne(o.target.value),placeholder:"Tumor Marker Value",className:"input-field"}),e.jsx("textarea",{value:ue,onChange:o=>le(o.target.value),placeholder:"Progression Notes...",rows:4,className:"textarea-field"})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx("button",{type:"button",onClick:ot,className:"save-button",children:"Save Progression"})})]}),e.jsxs(A.Panel,{children:[e.jsxs("form",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("select",{value:se,onChange:o=>oe(o.target.value),className:"input-field","aria-label":"Treatment Line",children:[e.jsx("option",{value:"",children:"Select Line"}),e.jsx("option",{value:"1st Line",children:"1st Line"}),e.jsx("option",{value:"2nd Line",children:"2nd Line"}),e.jsx("option",{value:"3rd Line",children:"3rd Line"}),e.jsx("option",{value:"Maintenance",children:"Maintenance"})]}),e.jsx("input",{type:"text",value:pe,onChange:o=>ce(o.target.value),placeholder:"Treatment Regimen",className:"input-field"}),e.jsx("input",{type:"date",value:ye,onChange:o=>de(o.target.value),className:"input-field","aria-label":"Start Date",placeholder:"Start Date"}),e.jsx("input",{type:"date",value:fe,onChange:o=>me(o.target.value),className:"input-field","aria-label":"End Date",placeholder:"End Date"}),e.jsxs("select",{value:N,onChange:o=>w(o.target.value),className:"input-field","aria-label":"Treatment Response",children:[e.jsx("option",{value:"",children:"Select Response"}),e.jsx("option",{value:"Complete Response",children:"Complete Response (CR)"}),e.jsx("option",{value:"Partial Response",children:"Partial Response (PR)"}),e.jsx("option",{value:"Stable Disease",children:"Stable Disease (SD)"}),e.jsx("option",{value:"Progressive Disease",children:"Progressive Disease (PD)"})]}),e.jsx("textarea",{value:as,onChange:o=>Re(o.target.value),placeholder:"Treatment Notes...",rows:4,className:"textarea-field"})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx("button",{type:"button",onClick:ct,className:"save-button",children:"Save Line of Treatment"})})]}),e.jsx(A.Panel,{children:e.jsxs("div",{className:"space-y-6",children:[m().length>0&&e.jsxs("div",{className:"p-6 bg-gradient-to-r from-indigo-50 to-blue-50 dark:from-indigo-900 dark:to-blue-900 rounded-xl shadow-sm mb-6 transform transition-all duration-300 hover:shadow-md hover:scale-[1.01]",children:[e.jsxs("h4",{className:"text-lg font-bold mb-3 text-indigo-700 dark:text-indigo-300 flex items-center",children:[e.jsx("span",{className:"mr-2 p-1 bg-indigo-100 dark:bg-indigo-800 rounded-full",children:"🎯"}),"Matched Treatment Protocols"]}),e.jsx("ul",{className:"list-disc list-inside text-gray-700 dark:text-gray-300 space-y-1.5",children:m().map((o,k)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"inline-block w-4 h-4 mr-2 mt-1 bg-indigo-400 dark:bg-indigo-600 rounded-full"}),e.jsx("span",{children:o.name})]},k))})]}),g.length>0&&e.jsxs("div",{className:"p-6 bg-gradient-to-r from-purple-50 to-indigo-50 dark:from-purple-900 dark:to-indigo-900 rounded-xl shadow-sm mb-6 transform transition-all duration-300 hover:shadow-md hover:scale-[1.01]",children:[e.jsxs("h4",{className:"text-lg font-bold mb-3 text-purple-600 dark:text-purple-400 flex items-center",children:[e.jsx("span",{className:"mr-2 p-1 bg-purple-100 dark:bg-purple-800 rounded-full",children:"🎯"}),"Standard Protocols for ",l]}),e.jsx("ul",{className:"list-disc list-inside text-gray-700 dark:text-gray-300 space-y-1.5",children:g.map((o,k)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"inline-block w-4 h-4 mr-2 mt-1 bg-purple-400 dark:bg-purple-600 rounded-full"}),e.jsx("span",{children:o})]},k))})]}),j().length>0&&e.jsxs("div",{className:"p-6 bg-gradient-to-r from-emerald-50 to-teal-50 dark:from-emerald-900 dark:to-teal-900 rounded-xl shadow-sm mb-6 transform transition-all duration-300 hover:shadow-md hover:scale-[1.01]",children:[e.jsxs("h4",{className:"text-lg font-bold mb-3 text-emerald-700 dark:text-emerald-300 flex items-center",children:[e.jsx("span",{className:"mr-2 p-1 bg-emerald-100 dark:bg-emerald-800 rounded-full",children:"💉"}),"Suggested Pre-Medications"]}),e.jsx("ul",{className:"list-disc list-inside text-gray-700 dark:text-gray-300 space-y-1.5",children:j().map((o,k)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"inline-block w-4 h-4 mr-2 mt-1 bg-emerald-400 dark:bg-emerald-600 rounded-full"}),e.jsx("span",{children:o})]},k))})]}),e.jsxs("div",{className:"p-6 bg-white dark:bg-gray-800 rounded-xl shadow-md border border-gray-100 dark:border-gray-700",children:[e.jsx("h4",{className:"text-lg font-bold mb-4 text-gray-800 dark:text-gray-200",children:"AI Treatment Assistant"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"ai-input",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Case Summary (Optional)"}),e.jsx("textarea",{id:"ai-input",value:et,onChange:o=>st(o.target.value),placeholder:"Enter case summary (e.g., Metastatic CRC after FOLFIRI)",rows:4,className:"w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100 shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400"})]}),e.jsx("button",{onClick:rt,disabled:r,className:"w-full px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-semibold rounded-lg shadow-md hover:shadow-lg transition-all duration-300 flex items-center justify-center",children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-3 border-t-transparent border-white rounded-full animate-spin mr-3"}),e.jsx("span",{children:"Analyzing Patient Data..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mr-2",children:"🧠"}),e.jsx("span",{children:"Ask AI for Personalized Suggestions"})]})}),rs&&e.jsxs("div",{className:"p-6 mt-6 bg-gradient-to-br from-gray-50 to-blue-50 dark:from-gray-800 dark:to-blue-900 rounded-xl shadow-lg border border-blue-100 dark:border-blue-800 transform transition-all duration-500 animate-in fade-in-0 slide-in-from-bottom-4",children:[e.jsxs("h4",{className:"text-lg font-bold mb-3 text-blue-600 dark:text-blue-300 flex items-center",children:[e.jsx("span",{className:"mr-2 p-1 bg-blue-100 dark:bg-blue-800 rounded-full",children:"🧠"}),"AI Personalized Recommendations"]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 whitespace-pre-line leading-relaxed",children:rs})]})]})]})})]})]})]})},ts=i.forwardRef(({className:s,children:t,...a},r)=>e.jsxs(Us,{ref:r,className:D("relative overflow-hidden",s),...a,children:[e.jsx(Bt,{className:"h-full w-full rounded-[inherit]",children:t}),e.jsx(Xs,{}),e.jsx($t,{})]}));ts.displayName=Us.displayName;const Xs=i.forwardRef(({className:s,orientation:t="vertical",...a},r)=>e.jsx(qs,{ref:r,orientation:t,className:D("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 border-t border-t-transparent p-[1px]",s),...a,children:e.jsx(Vt,{className:"relative flex-1 rounded-full bg-slate-200 dark:bg-slate-800"})}));Xs.displayName=qs.displayName;const rr=()=>e.jsx(ke,{className:"w-[95vw] max-w-4xl h-[95vh] flex flex-col bg-white dark:bg-gray-900 p-0 gap-0",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx(Me,{className:"px-6 py-4 border-b dark:border-gray-800",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-8 w-64 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-4 w-48 bg-gray-200 dark:bg-gray-700 rounded"})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("div",{className:"h-6 w-24 bg-gray-200 dark:bg-gray-700 rounded-full"}),e.jsx("div",{className:"h-6 w-32 bg-gray-200 dark:bg-gray-700 rounded-full"}),e.jsx("div",{className:"h-6 w-28 bg-gray-200 dark:bg-gray-700 rounded-full"})]}),[...Array(3)].map((s,t)=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-6 w-48 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 w-full bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-4 w-5/6 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-4 w-4/6 bg-gray-200 dark:bg-gray-700 rounded"})]})]},t))]})]})}),ir=({error:s,onRetry:t})=>e.jsx(ke,{className:"w-[95vw] max-w-4xl h-[95vh] flex flex-col bg-white dark:bg-gray-900 p-0 gap-0",children:e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"p-6 flex flex-col items-center justify-center text-center space-y-4",children:[e.jsx("div",{className:"p-3 rounded-full bg-red-100 text-red-600 dark:bg-red-900/30 dark:text-red-400",children:e.jsx(xe,{className:"h-6 w-6"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Error Loading Medication Details"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:s})]}),e.jsx("button",{onClick:t,className:"px-4 py-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded-lg transition-colors",children:"Try Again"})]})})}),q=({title:s,icon:t,children:a})=>e.jsxs("div",{className:"relative border border-gray-100 dark:border-gray-800 rounded-xl bg-gradient-to-b from-white/50 to-gray-50/50 dark:from-gray-900/50 dark:to-gray-800/50 p-6 backdrop-blur shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t&&e.jsx("div",{className:"p-2 bg-gray-100/80 dark:bg-gray-800/80 rounded-lg",children:t}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-50",children:s})]}),a]}),S=({title:s,children:t,variant:a="default"})=>e.jsxs("div",{className:D("rounded-lg p-4 backdrop-blur-sm",a==="warning"&&"bg-yellow-100/30 dark:bg-yellow-900/30 border border-yellow-200/50 dark:border-yellow-700/50",a==="danger"&&"bg-red-100/30 dark:bg-red-900/30 border border-red-200/50 dark:border-red-700/50",a==="default"&&"bg-gray-100/30 dark:bg-gray-800/30 border border-gray-200/50 dark:border-gray-700/50"),children:[e.jsx("div",{className:"flex items-center gap-2 mb-3",children:e.jsx("h4",{className:D("text-sm font-medium",a==="warning"&&"text-yellow-800 dark:text-yellow-200",a==="danger"&&"text-red-800 dark:text-red-200",a==="default"&&"text-gray-900 dark:text-gray-100"),children:s})}),e.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:t})]});function nr({medication:s,isOpen:t,onClose:a}){var j,l,x,u,_,C,I,M,p,d,f,y,F,W,Y,X,B,Z,O,J,U,c,v,b,E,$,L,V,R,ge,ie,he,ne,ue,le,se,oe,pe,ce,ye,de,fe,me;const[r,n]=i.useState(!1),[g,h]=i.useState(null),m=()=>{h(null),n(!0),n(!1)};return s?r?e.jsx(De,{open:t,onOpenChange:a,children:e.jsx(rr,{})}):g?e.jsx(De,{open:t,onOpenChange:a,children:e.jsx(ir,{error:g,onRetry:m})}):e.jsx(De,{open:t,onOpenChange:a,"aria-label":`${s.name} Details`,children:e.jsxs(ke,{className:"w-[95vw] max-w-4xl h-[95vh] flex flex-col bg-white dark:bg-gray-900 p-0 gap-0",role:"dialog","aria-modal":"true","aria-labelledby":"medication-title","aria-describedby":"medication-description",children:[e.jsx(Me,{className:"px-6 py-4 border-b dark:border-gray-800 sticky top-0 z-10 bg-white dark:bg-gray-900 backdrop-blur-sm bg-opacity-90",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:["              ",e.jsx(Qe,{id:"medication-title",className:"text-2xl font-bold text-gray-900 dark:text-gray-50 truncate",children:s.name}),e.jsx("p",{id:"medication-description",className:"sr-only",children:"Detailed information about the medication, including dosing, side effects, and monitoring."}),((j=s.brand_names)==null?void 0:j.length)>0&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 truncate",children:s.brand_names.join(", ")})]}),"            ",e.jsx("button",{onClick:a,onKeyDown:N=>{(N.key==="Enter"||N.key===" ")&&(N.preventDefault(),a())},className:"absolute right-4 top-4 text-gray-400 hover:text-gray-700 dark:text-gray-500 dark:hover:text-gray-300 transition-colors rounded-full p-2 hover:bg-gray-100/50 dark:hover:bg-gray-800/50 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900","aria-label":"Close medication details",children:e.jsx(ae,{className:"h-5 w-5"})})]})}),"        ",e.jsx(ts,{className:"flex-1 h-[calc(95vh-4rem)] overflow-y-auto",role:"region","aria-label":"Medication details",children:e.jsxs("div",{className:"p-6 space-y-8",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(P,{variant:"outline",className:"px-2.5 py-1 whitespace-nowrap",children:s.classification}),s.is_chemotherapy&&e.jsxs(P,{variant:"secondary",className:"bg-yellow-500/10 text-yellow-700 dark:bg-yellow-500/20 dark:text-yellow-300",children:[e.jsx(Ne,{className:"w-3.5 h-3.5 mr-1"}),"Chemotherapy"]}),s.is_immunotherapy&&e.jsxs(P,{variant:"secondary",className:"bg-green-500/10 text-green-700 dark:bg-green-500/20 dark:text-green-300",children:[e.jsx(Kt,{className:"w-3.5 h-3.5 mr-1"}),"Immunotherapy"]}),s.is_targeted_therapy&&e.jsxs(P,{variant:"secondary",className:"bg-purple-500/10 text-purple-700 dark:bg-purple-500/20 dark:text-purple-300",children:[e.jsx(we,{className:"w-3.5 h-3.5 mr-1"}),"Targeted Therapy"]}),s.is_orphan_drug&&e.jsxs(P,{variant:"secondary",className:"bg-blue-500/10 text-blue-700 dark:bg-blue-500/20 dark:text-blue-300",children:[e.jsx(Ss,{className:"w-3.5 h-3.5 mr-1"}),"Orphan Drug"]})]}),"            ",s.black_box_warning&&e.jsxs("div",{className:"relative p-6 border-2 border-red-500 dark:border-red-700 bg-gradient-to-br from-red-50 to-red-100/50 dark:from-red-950/50 dark:to-red-900/30 rounded-xl shadow-lg backdrop-blur-sm",children:[e.jsx("div",{className:"absolute -top-3 left-4 px-2 py-0.5 bg-red-500 text-white text-xs font-bold uppercase tracking-wider rounded",children:"Black Box Warning"}),e.jsxs("div",{className:"flex gap-3 items-start mt-2",children:[e.jsx(xe,{className:"w-5 h-5 flex-shrink-0 text-red-500 dark:text-red-400"}),e.jsx("div",{className:"flex-1 text-red-800 dark:text-red-200 whitespace-pre-wrap",children:s.black_box_warning})]})]}),s.mechanism&&e.jsxs(q,{title:"Mechanism of Action",icon:e.jsx(Ss,{className:"h-5 w-5 text-blue-500"}),children:[e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:s.mechanism}),s.summary&&e.jsx("p",{className:"mt-4 text-sm text-gray-600 dark:text-gray-400",children:s.summary})]}),s.indications&&e.jsx(q,{title:"Indications",icon:e.jsx(Ne,{className:"h-5 w-5 text-green-500"}),children:e.jsxs("div",{className:"grid gap-6 sm:grid-cols-2",children:[((x=(l=s.indications)==null?void 0:l.cancer_types)==null?void 0:x.length)>0&&e.jsx(S,{title:"Cancer Types",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:s.indications.cancer_types.map((N,w)=>e.jsx(P,{variant:"secondary",children:N},w))})}),((_=(u=s.indications)==null?void 0:u.biomarkers)==null?void 0:_.length)>0&&e.jsx(S,{title:"Biomarkers",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:s.indications.biomarkers.map((N,w)=>e.jsx(P,{variant:"outline",children:N},w))})}),((I=(C=s.indications)==null?void 0:C.staging)==null?void 0:I.length)>0&&e.jsx(S,{title:"Disease Stage",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:s.indications.staging.map((N,w)=>e.jsx(P,{variant:"secondary",children:N},w))})}),((p=(M=s.indications)==null?void 0:M.line_of_therapy)==null?void 0:p.length)>0&&e.jsx(S,{title:"Line of Therapy",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:s.indications.line_of_therapy.map((N,w)=>e.jsx(P,{variant:"secondary",children:N},w))})})]})}),(s.dosing||s.administration)&&e.jsx(q,{title:"Dosing & Administration",icon:e.jsx(Ut,{className:"h-5 w-5 text-blue-500"}),children:e.jsxs("div",{className:"space-y-4",children:[((d=s.dosing)==null?void 0:d.standard)&&e.jsx(S,{title:"Standard Dose",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:s.dosing.standard}),s.administration&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Administration: ",s.administration]})]})}),((f=s.dosing)==null?void 0:f.schedule)&&e.jsx(S,{title:"Schedule",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:s.dosing.schedule}),s.dosing.cycle_length&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Cycle Length: ",s.dosing.cycle_length]}),s.dosing.duration&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Duration: ",s.dosing.duration]})]})}),((F=(y=s.dosing)==null?void 0:y.adjustments)==null?void 0:F.length)>0&&e.jsx(S,{title:"Dose Adjustments",variant:"warning",children:e.jsx("ul",{className:"list-disc list-inside space-y-1",children:s.dosing.adjustments.map((N,w)=>e.jsx("li",{className:"text-gray-700 dark:text-gray-300",children:N},w))})})]})}),s.side_effects&&e.jsx(q,{title:"Side Effects",icon:e.jsx(qt,{className:"h-5 w-5 text-red-500"}),children:e.jsxs("div",{className:"grid gap-6 sm:grid-cols-2",children:[((W=s.side_effects.common)==null?void 0:W.length)>0&&e.jsx(S,{title:"Common Side Effects",children:e.jsx("ul",{className:"list-disc list-inside space-y-1",children:s.side_effects.common.map((N,w)=>e.jsx("li",{className:"text-gray-700 dark:text-gray-300",children:N},w))})}),((Y=s.side_effects.severe)==null?void 0:Y.length)>0&&e.jsx(S,{title:"Severe Side Effects",variant:"danger",children:e.jsx("ul",{className:"list-disc list-inside space-y-1",children:s.side_effects.severe.map((N,w)=>e.jsx("li",{className:"text-red-700 dark:text-red-300",children:N},w))})}),((X=s.side_effects.monitoring)==null?void 0:X.length)>0&&e.jsx(S,{title:"Monitoring Required",children:e.jsx("ul",{className:"list-disc list-inside space-y-1",children:s.side_effects.monitoring.map((N,w)=>e.jsx("li",{className:"text-gray-700 dark:text-gray-300",children:N},w))})}),((B=s.side_effects.management)==null?void 0:B.length)>0&&e.jsx(S,{title:"Management",children:e.jsx("ul",{className:"list-disc list-inside space-y-1",children:s.side_effects.management.map((N,w)=>e.jsx("li",{className:"text-gray-700 dark:text-gray-300",children:N},w))})})]})}),s.monitoring&&e.jsx(q,{title:"Monitoring",icon:e.jsx(Je,{className:"h-5 w-5 text-indigo-500"}),children:e.jsxs("div",{className:"space-y-4",children:[((Z=s.pre_treatment_tests)==null?void 0:Z.length)>0&&e.jsx(S,{title:"Pre-Treatment Tests",children:e.jsx("ul",{className:"list-disc list-inside space-y-1",children:s.pre_treatment_tests.map((N,w)=>e.jsx("li",{className:"text-gray-700 dark:text-gray-300",children:N},w))})}),((O=s.monitoring.baseline)==null?void 0:O.length)>0&&e.jsx(S,{title:"Baseline Tests",children:e.jsx("ul",{className:"list-disc list-inside space-y-1",children:s.monitoring.baseline.map((N,w)=>e.jsx("li",{className:"text-gray-700 dark:text-gray-300",children:N},w))})}),((J=s.monitoring.ongoing)==null?void 0:J.length)>0&&e.jsx(S,{title:"Ongoing Monitoring",children:e.jsx("ul",{className:"list-disc list-inside space-y-1",children:s.monitoring.ongoing.map((N,w)=>e.jsx("li",{className:"text-gray-700 dark:text-gray-300",children:N},w))})}),"                  ",((c=(U=s.monitoring)==null?void 0:U.parameters)==null?void 0:c.length)>0&&e.jsx(S,{title:"Parameters",children:e.jsx("ul",{className:"list-disc list-inside space-y-1",children:s.monitoring.parameters.map((N,w)=>e.jsx("li",{className:"text-gray-700 dark:text-gray-300",children:N},w))})}),((v=s.monitoring)==null?void 0:v.frequency)&&e.jsx(S,{title:"Frequency",children:e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:s.monitoring.frequency})})]})}),(s.interactions||((b=s.contraindications)==null?void 0:b.length)>0)&&e.jsx(q,{title:"Drug Interactions",icon:e.jsx(Ne,{className:"h-5 w-5 text-amber-500"}),children:e.jsxs("div",{className:"space-y-4",children:[((($=(E=s.interactions)==null?void 0:E.contraindications)==null?void 0:$.length)>0||((L=s.contraindications)==null?void 0:L.length)>0)&&e.jsx(S,{title:"Contraindications",variant:"danger",children:e.jsx("ul",{className:"list-disc list-inside space-y-1",children:[...((V=s.interactions)==null?void 0:V.contraindications)||[],...s.contraindications||[]].map((N,w)=>e.jsx("li",{className:"text-red-700 dark:text-red-300",children:N},w))})}),"                  ",((ge=(R=s.interactions)==null?void 0:R.drugs)==null?void 0:ge.length)>0&&e.jsx(S,{title:"Interacting Medications",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:(he=(ie=s.interactions)==null?void 0:ie.drugs)==null?void 0:he.map((N,w)=>e.jsx(P,{variant:"outline",children:N},w))})}),((ue=(ne=s.interactions)==null?void 0:ne.precautions)==null?void 0:ue.length)>0&&e.jsx(S,{title:"Precautions",variant:"warning",children:e.jsx("ul",{className:"list-disc list-inside space-y-1",children:(se=(le=s.interactions)==null?void 0:le.precautions)==null?void 0:se.map((N,w)=>e.jsx("li",{className:"text-amber-700 dark:text-amber-300",children:N},w))})})]})}),s.special_considerations&&e.jsx(q,{title:"Special Considerations",icon:e.jsx(xe,{className:"h-5 w-5 text-orange-500"}),children:e.jsxs("div",{className:"space-y-4",children:[s.special_considerations.pregnancy&&e.jsx(S,{title:"Pregnancy",children:e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:s.special_considerations.pregnancy})}),s.special_considerations.elderly&&e.jsx(S,{title:"Elderly",children:e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:s.special_considerations.elderly})}),s.special_considerations.renal&&e.jsx(S,{title:"Renal Impairment",children:e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:s.special_considerations.renal})}),s.special_considerations.hepatic&&e.jsx(S,{title:"Hepatic Impairment",children:e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:s.special_considerations.hepatic})}),"                  ",((pe=(oe=s.special_considerations)==null?void 0:oe.other)==null?void 0:pe.length)>0&&e.jsx(S,{title:"Other Considerations",children:e.jsx("ul",{className:"list-disc list-inside space-y-1",children:(ye=(ce=s.special_considerations)==null?void 0:ce.other)==null?void 0:ye.map((N,w)=>e.jsx("li",{className:"text-gray-700 dark:text-gray-300",children:N},w))})})]})}),s.pharmacokinetics&&e.jsx(q,{title:"Pharmacokinetics",icon:e.jsx(Ze,{className:"h-5 w-5 text-purple-500"}),children:e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:["                  ",((de=s.pharmacokinetics)==null?void 0:de.half_life)&&e.jsx(S,{title:"Half-Life",children:e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:s.pharmacokinetics.half_life})}),s.pharmacokinetics.metabolism&&e.jsx(S,{title:"Metabolism",children:e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:s.pharmacokinetics.metabolism})}),s.pharmacokinetics.excretion&&e.jsx(S,{title:"Excretion",children:e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:s.pharmacokinetics.excretion})}),s.pharmacokinetics.bioavailability&&e.jsx(S,{title:"Bioavailability",children:e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:s.pharmacokinetics.bioavailability})}),s.pharmacokinetics.protein_binding&&e.jsx(S,{title:"Protein Binding",children:e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:s.pharmacokinetics.protein_binding})})]})}),e.jsxs("div",{className:"grid gap-6 sm:grid-cols-2",children:[((fe=s.reference_sources)==null?void 0:fe.length)>0&&e.jsx(q,{title:"References",icon:e.jsx(we,{className:"h-5 w-5 text-gray-500"}),children:e.jsx("div",{className:"flex flex-wrap gap-2",children:s.reference_sources.map((N,w)=>e.jsx(P,{variant:"outline",className:"text-xs",children:N},w))})}),((me=s.routine_monitoring)==null?void 0:me.length)>0&&e.jsx(q,{title:"Routine Testing",icon:e.jsx(Je,{className:"h-5 w-5 text-gray-500"}),children:e.jsx("ul",{className:"list-disc list-inside space-y-1",children:s.routine_monitoring.map((N,w)=>e.jsx("li",{className:"text-gray-700 dark:text-gray-300",children:N},w))})})]})]})})]})}):null}const be=s=>{try{const t=new(window.AudioContext||window.webkitAudioContext),a=t.createOscillator(),r=t.createGain();switch(a.connect(r),r.connect(t.destination),s){case"sort":a.type="sine",a.frequency.setValueAtTime(440,t.currentTime),r.gain.setValueAtTime(.1,t.currentTime),r.gain.exponentialRampToValueAtTime(.01,t.currentTime+.1),a.start(t.currentTime),a.stop(t.currentTime+.1);break;case"select":a.type="sine",a.frequency.setValueAtTime(520,t.currentTime),r.gain.setValueAtTime(.1,t.currentTime),r.gain.exponentialRampToValueAtTime(.01,t.currentTime+.05),a.start(t.currentTime),a.stop(t.currentTime+.05);break;case"success":a.type="sine",a.frequency.setValueAtTime(780,t.currentTime),r.gain.setValueAtTime(.1,t.currentTime),r.gain.exponentialRampToValueAtTime(.01,t.currentTime+.15),a.start(t.currentTime),a.stop(t.currentTime+.15);break;case"warning":a.type="triangle",a.frequency.setValueAtTime(320,t.currentTime),r.gain.setValueAtTime(.1,t.currentTime),r.gain.exponentialRampToValueAtTime(.01,t.currentTime+.3),a.start(t.currentTime),a.stop(t.currentTime+.3);break;case"error":a.type="square",a.frequency.setValueAtTime(220,t.currentTime),r.gain.setValueAtTime(.1,t.currentTime),r.gain.exponentialRampToValueAtTime(.01,t.currentTime+.2),a.start(t.currentTime),a.stop(t.currentTime+.2);break}}catch(t){console.warn("Audio feedback not supported",t)}},lr=()=>typeof window<"u"&&(typeof window.AudioContext<"u"||typeof window.webkitAudioContext<"u");function or(s,t){const[a,r]=i.useState(s);return i.useEffect(()=>{const n=setTimeout(()=>{r(s)},t);return()=>{clearTimeout(n)}},[s,t]),a}class cr extends G.Component{constructor(){super(...arguments);ee(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,r){console.error("Medication component error:",a,r)}render(){return this.state.hasError?this.props.fallback||e.jsxs("div",{className:"p-6 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-red-600 font-medium mb-2",children:[e.jsx(xe,{className:"h-5 w-5"}),e.jsx("h2",{children:"Error loading medication data"})]}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Please try refreshing the page. If the problem persists, contact support."})]}):this.props.children}}const Ds=(s,t)=>s.localeCompare(t),dr=(s,t,a,r,n)=>i.useMemo(()=>[...s.filter(h=>{var m,j;if(t){const l=t.toLowerCase(),x=(h.name||"").toLowerCase().includes(l),u=(h.brand_names||[]).some(I=>(I||"").toLowerCase().includes(l)),_=(h.classification||"").toLowerCase().includes(l),C=(((m=h.indications)==null?void 0:m.cancer_types)||[]).some(I=>(I||"").toLowerCase().includes(l));if(!x&&!u&&!_&&!C)return!1}return a&&!((j=h.classification)!=null&&j.includes(a))?!1:r?["Antiemetic","Anxiolytic","Antihistamine","Corticosteroid"].some(x=>{var u;return(u=h.classification)==null?void 0:u.includes(x)}):!0})].sort((h,m)=>{const j=n.order==="asc"?1:-1;switch(n.field){case"name":return Ds(h.name,m.name)*j;case"classification":return Ds(h.classification,m.classification)*j;case"updated_at":return(new Date(h.updated_at).getTime()-new Date(m.updated_at).getTime())*j;default:return 0}}),[s,t,a,r,n]),He=()=>e.jsxs("div",{className:"bg-white/30 backdrop-blur-md border border-white/20 rounded-xl shadow-lg p-6 animate-pulse","data-testid":"medication-skeleton",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-6 w-48 bg-gray-200 rounded-md"}),e.jsx("div",{className:"h-4 w-32 bg-gray-200 rounded-md"})]}),e.jsx("div",{className:"h-6 w-24 bg-gray-200 rounded-full"})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("div",{className:"h-5 w-20 bg-gray-200 rounded-md"}),e.jsx("div",{className:"h-5 w-24 bg-gray-200 rounded-md"}),e.jsx("div",{className:"h-5 w-16 bg-gray-200 rounded-md"})]})]}),mr=s=>s.includes("Antiemetic")?"bg-teal-100 text-teal-800 border border-teal-200":s.includes("Antihistamine")?"bg-cyan-100 text-cyan-800 border border-cyan-200":s.includes("Corticosteroid")?"bg-emerald-100 text-emerald-800 border border-emerald-200":s.includes("Anxiolytic")?"bg-indigo-100 text-indigo-800 border border-indigo-200":s.includes("Chemotherapy")?"bg-yellow-100 text-yellow-800 border border-yellow-200":s.includes("Checkpoint Inhibitor")?"bg-green-100 text-green-800 border border-green-200":s.includes("Monoclonal Antibody")?"bg-purple-100 text-purple-800 border border-purple-200":s.includes("Conjugate")?"bg-pink-100 text-pink-800 border border-pink-200":s.includes("Inhibitor")?"bg-blue-100 text-blue-800 border border-blue-200":s.includes("SERM")?"bg-orange-100 text-orange-800 border border-orange-200":"bg-gray-100 text-gray-800 border border-gray-200",xr=s=>s.includes("5-HT3 Receptor Antagonist")?"5-HT3 RA":s.includes("NK1 Receptor Antagonist")?"NK1 RA":s.includes("Checkpoint Inhibitor")?s.replace("Checkpoint Inhibitor","Inhibitor"):s.includes("Monoclonal Antibody")?s.replace("Monoclonal Antibody","mAb"):s.includes("Tyrosine Kinase Inhibitor")?s.replace("Tyrosine Kinase Inhibitor","TKI"):s.includes("Antibody-Drug Conjugate")?s.replace("Targeted Antibody-Drug Conjugate","ADC"):s==="Selective Estrogen Receptor Modulator (SERM)"?"SERM":s,Zs="medications-sort-preference",gr=()=>{try{const s=localStorage.getItem(Zs);if(s){const t=JSON.parse(s);if(t.field&&["name","classification","updated_at"].includes(t.field)&&t.order&&["asc","desc"].includes(t.order))return t}}catch{console.warn("Failed to parse saved sort preference")}return{field:"name",order:"asc"}};function hr({initialData:s}){const t=G.useRef(null),[a,r]=i.useState(s||[]),[n,g]=i.useState(!s),[h,m]=i.useState(""),j=or(h,300),[l,x]=i.useState(""),[u,_]=i.useState(!1),[C,I]=i.useState(null),[M,p]=i.useState(null),[d,f]=i.useState(-1),[y,F]=i.useState(gr()),[W,Y]=i.useState("");dr(a,j,l,u,y);const X=c=>{if(c!==d&&(f(c),be("select"),a[c])){const v=new URL(window.location.href);v.searchParams.set("med",a[c].id),window.history.replaceState({},"",v)}},B=c=>{Y(c),setTimeout(()=>Y(""),1e3)},Z=c=>{if(typeof window>"u")return;const v=new URL(window.location.href);Object.entries(c).forEach(([b,E])=>{E?v.searchParams.set(b==="search"?"q":b,E):v.searchParams.delete(b==="search"?"q":b)}),window.history.replaceState({},"",v)},O=(c,v)=>{F(c),B(v),Z({sort:c.field,order:c.order})};i.useEffect(()=>{try{localStorage.setItem(Zs,JSON.stringify(y))}catch{console.warn("Failed to save sort preference")}},[y]);const J=c=>{var v;if(((v=document.activeElement)==null?void 0:v.tagName)!=="INPUT")switch(c.key){case"ArrowDown":case"j":{c.preventDefault();const b=d<a.length-1?d+1:d;X(b);break}case"ArrowUp":case"k":{c.preventDefault();const b=d>0?d-1:d;X(b);break}case"Enter":c.preventDefault(),d>=0&&d<a.length&&(p(a[d]),be("select"));break;case"Home":c.preventDefault(),f(0);break;case"End":c.preventDefault(),f(a.length-1);break;case"n":case"c":case"u":case"s":case"l":if(c.altKey){if(c.preventDefault(),c.key==="l"){const b=new URL(window.location.href);navigator.clipboard.writeText(b.toString()),B("URL copied to clipboard! ✓"),be("select");return}if(c.key==="n"){const b={field:"name",order:y.field==="name"&&y.order==="asc"?"desc":"asc"};O(b,`Sorted by name ${b.order==="asc"?"↑":"↓"}`)}else if(c.key==="c"){const b={field:"classification",order:y.field==="classification"&&y.order==="asc"?"desc":"asc"};O(b,`Sorted by classification ${b.order==="asc"?"↑":"↓"}`)}else if(c.key==="u"){const b={field:"updated_at",order:y.field==="updated_at"&&y.order==="asc"?"desc":"asc"};O(b,`Sorted by date ${b.order==="asc"?"↑":"↓"}`)}if(c.key==="s"){const b={...y,order:y.order==="asc"?"desc":"asc"};O(b,`Sort order: ${b.order==="asc"?"ascending ↑":"descending ↓"}`)}}break}},U=i.useCallback(async()=>{try{g(!0),I(null);let c=es.from("oncology_medications").select("*").order(y.field,{ascending:y.order==="asc"});j&&(c=c.or(`name.ilike.%${j}%,classification.ilike.%${j}%`)),l&&(c=c.eq("classification",l)),u&&(c=c.eq("is_premedication",!0));const{data:v,error:b}=await c;if(b)throw console.error("❌ Error fetching from oncology_medications:",b),b;console.log("✅ Medications fetched:",v),r(v)}catch(c){const v=c;console.error("❌ Error fetching medications:",v);const b=v.message||"Failed to fetch medications. Please try again.";I(b),lr()&&be("error"),B(`Error: ${b}`),r([])}finally{g(!1)}},[j,l,u,y]);return i.useEffect(()=>{s||U()},[s]),i.useEffect(()=>{const c=setTimeout(()=>{h||l?U():s||U()},300);return()=>clearTimeout(c)},[h,l,s]),i.useEffect(()=>{f(-1)},[a]),i.useEffect(()=>{if(typeof window<"u"){const c=new URL(window.location.href),v=c.searchParams.get("q");v&&m(v);const b=c.searchParams.get("class");b&&x(b);const E=c.searchParams.get("sort"),$=c.searchParams.get("order");E&&$&&F({field:E,order:$});const L=c.searchParams.get("med");if(L&&a.length>0){const V=a.findIndex(R=>R.id===L);V!==-1&&(f(V),setTimeout(()=>{const R=document.getElementById(`medication-${V}`);R==null||R.scrollIntoView({behavior:"smooth",block:"nearest"})},100))}}},[a]),i.useEffect(()=>{const c=v=>{var b,E;v.key==="/"&&((b=document.activeElement)==null?void 0:b.tagName)!=="INPUT"&&(v.preventDefault(),(E=t.current)==null||E.focus()),v.key==="Escape"&&(h||l?(m(""),x("")):f(-1)),J(v)};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[h,l,a.length]),i.useEffect(()=>{if(d>=0){const c=document.getElementById(`medication-${d}`);c==null||c.scrollIntoView({behavior:"smooth",block:"nearest"})}},[d]),n?e.jsxs("div",{className:"space-y-4",children:[e.jsx(He,{}),e.jsx(He,{}),e.jsx(He,{})]}):e.jsx(cr,{children:e.jsxs("div",{className:"space-y-6 relative",children:[W&&e.jsx("div",{className:`
              fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 
              bg-gray-900/90 text-white px-4 py-2 rounded-lg shadow-xl 
              backdrop-blur-sm z-50
              animate-in fade-in-0 zoom-in-95 duration-200
              data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95
              flex items-center gap-2 font-medium
            `,role:"status","aria-live":"polite",children:W}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-lg shadow-lg",children:e.jsx(we,{className:"h-6 w-6 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent",children:"Oncology Medications"})]}),e.jsxs("button",{onClick:()=>{const c=new URL(window.location.href);navigator.clipboard.writeText(c.toString()),B("URL copied to clipboard! ✓"),be("select")},className:"px-3 py-2 flex items-center gap-2 text-sm text-gray-600 hover:text-gray-800 bg-white/30 backdrop-blur-md border border-white/20 rounded-lg shadow-lg hover:shadow-xl opacity-80 hover:opacity-100 transition-all duration-300",title:"Copy link to clipboard (Alt+L)",children:[e.jsx(zt,{className:"h-4 w-4"}),"Share View"]})]}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx("button",{onClick:()=>{_(!u),x("")},className:`
              px-4 py-2 rounded-lg text-sm font-medium 
              transition-all duration-300
              ${u?"bg-indigo-600 text-white shadow-lg":"bg-white/30 text-gray-600 hover:bg-indigo-50"}
            `,children:u?"✓ Pre-Medications Only":"Show Pre-Medications"}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Ye,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{ref:t,type:"text",placeholder:"Search medications, classifications, or cancer types... (Press '/' to focus)",value:h,onChange:c=>{m(c.target.value),Z({search:c.target.value||void 0})},className:"pl-10 pr-4 py-2 w-full bg-white/30 backdrop-blur-md border border-white/20 rounded-lg shadow-lg hover:shadow-xl opacity-80 hover:opacity-100 focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300"})]}),!u&&e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:l,onChange:c=>x(c.target.value),className:"pl-4 pr-10 py-2 bg-white/30 backdrop-blur-md border border-white/20 rounded-lg shadow-lg hover:shadow-xl opacity-80 hover:opacity-100 appearance-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300","aria-label":"Filter by classification",children:[e.jsx("option",{value:"",children:"All Classifications"}),e.jsxs("optgroup",{label:"Pre-Medications",children:[e.jsx("option",{value:"5-HT3 Receptor Antagonist Antiemetic",children:"5-HT3 RA Antiemetic"}),e.jsx("option",{value:"NK1 Receptor Antagonist Antiemetic",children:"NK1 RA Antiemetic"}),e.jsx("option",{value:"D2 Receptor Antagonist Antiemetic",children:"D2 RA Antiemetic"}),e.jsx("option",{value:"H1 Antihistamine",children:"H1 Antihistamine"}),e.jsx("option",{value:"H2 Antihistamine",children:"H2 Antihistamine"}),e.jsx("option",{value:"Corticosteroid",children:"Corticosteroid"}),e.jsx("option",{value:"Benzodiazepine Anxiolytic",children:"Benzodiazepine Anxiolytic"})]}),e.jsxs("optgroup",{label:"Traditional Chemotherapy",children:[e.jsx("option",{value:"Platinum Chemotherapy",children:"Platinum Chemotherapy"}),e.jsx("option",{value:"Anthracycline Chemotherapy",children:"Anthracycline Chemotherapy"}),e.jsx("option",{value:"Taxane Chemotherapy",children:"Taxane Chemotherapy"})]}),e.jsxs("optgroup",{label:"Immunotherapy",children:[e.jsx("option",{value:"PD-1 Checkpoint Inhibitor",children:"PD-1 Inhibitor"}),e.jsx("option",{value:"PD-L1 Checkpoint Inhibitor",children:"PD-L1 Inhibitor"})]}),e.jsxs("optgroup",{label:"Antibody-Drug Conjugates",children:[e.jsx("option",{value:"HER2-Targeted Antibody-Drug Conjugate",children:"HER2 ADC"}),e.jsx("option",{value:"Trop-2-Targeted Antibody-Drug Conjugate",children:"Trop-2 ADC"}),e.jsx("option",{value:"CD79b-Targeted Antibody-Drug Conjugate",children:"CD79b ADC"})]}),e.jsx("optgroup",{label:"Monoclonal Antibodies",children:e.jsx("option",{value:"HER2 Monoclonal Antibody",children:"HER2 mAb"})}),e.jsxs("optgroup",{label:"Targeted Therapies",children:[e.jsx("option",{value:"EGFR Tyrosine Kinase Inhibitor",children:"EGFR TKI"}),e.jsx("option",{value:"ALK Tyrosine Kinase Inhibitor",children:"ALK TKI"}),e.jsx("option",{value:"ALK/ROS1 Tyrosine Kinase Inhibitor",children:"ALK/ROS1 TKI"}),e.jsx("option",{value:"KRAS Inhibitor",children:"KRAS Inhibitor"}),e.jsx("option",{value:"PI3K Inhibitor",children:"PI3K Inhibitor"}),e.jsx("option",{value:"CDK4/6 Inhibitor",children:"CDK4/6 Inhibitor"}),e.jsx("option",{value:"BTK Inhibitor",children:"BTK Inhibitor"})]}),e.jsx("optgroup",{label:"Hormone Therapy",children:e.jsx("option",{value:"Selective Estrogen Receptor Modulator (SERM)",children:"SERM"})})]}),e.jsx(Ht,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none"})]})]}),e.jsxs("div",{className:"text-sm text-gray-500","aria-label":"Keyboard shortcuts",children:[e.jsx("h3",{className:"sr-only",children:"Keyboard shortcuts"}),e.jsxs("ul",{className:"flex flex-wrap gap-x-4 gap-y-2",children:[e.jsxs("li",{className:"flex flex-wrap gap-x-4 gap-y-2",children:[e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("kbd",{className:"px-2 py-0.5 text-xs bg-gray-100 border border-gray-300 rounded",children:"/"}),e.jsx("span",{children:"Search"})]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("kbd",{className:"px-2 py-0.5 text-xs bg-gray-100 border border-gray-300 rounded",children:"↑"}),e.jsx("kbd",{className:"px-2 py-0.5 text-xs bg-gray-100 border border-gray-300 rounded",children:"↓"}),e.jsx("span",{children:"or"}),e.jsx("kbd",{className:"px-2 py-0.5 text-xs bg-gray-100 border border-gray-300 rounded",children:"j"}),e.jsx("kbd",{className:"px-2 py-0.5 text-xs bg-gray-100 border border-gray-300 rounded",children:"k"}),e.jsx("span",{children:"Navigate"})]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("kbd",{className:"px-2 py-0.5 text-xs bg-gray-100 border border-gray-300 rounded",children:"Home"}),e.jsx("kbd",{className:"px-2 py-0.5 text-xs bg-gray-100 border border-gray-300 rounded",children:"End"}),e.jsx("span",{children:"Jump to top/bottom"})]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("kbd",{className:"px-2 py-0.5 text-xs bg-gray-100 border border-gray-300 rounded",children:"Enter"}),e.jsx("span",{children:"View details"})]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("kbd",{className:"px-2 py-0.5 text-xs bg-gray-100 border border-gray-300 rounded",children:"Esc"}),e.jsx("span",{children:"Clear filters"})]})]}),e.jsxs("li",{className:"flex flex-wrap gap-x-4 gap-y-2 border-t border-gray-200/30 pt-2 w-full",children:[e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("kbd",{className:"px-2 py-0.5 text-xs bg-gray-100 border border-gray-300 rounded",children:"Alt"}),"+",e.jsx("kbd",{className:"px-2 py-0.5 text-xs bg-gray-100 border border-gray-300 rounded",children:"N"}),e.jsx("span",{children:"Sort by name"})]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("kbd",{className:"px-2 py-0.5 text-xs bg-gray-100 border border-gray-300 rounded",children:"Alt"}),"+",e.jsx("kbd",{className:"px-2 py-0.5 text-xs bg-gray-100 border border-gray-300 rounded",children:"C"}),e.jsx("span",{children:"Sort by class"})]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("kbd",{className:"px-2 py-0.5 text-xs bg-gray-100 border border-gray-300 rounded",children:"Alt"}),"+",e.jsx("kbd",{className:"px-2 py-0.5 text-xs bg-gray-100 border border-gray-300 rounded",children:"U"}),e.jsx("span",{children:"Sort by updated"})]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("kbd",{className:"px-2 py-0.5 text-xs bg-gray-100 border border-gray-300 rounded",children:"Alt"}),"+",e.jsx("kbd",{className:"px-2 py-0.5 text-xs bg-gray-100 border border-gray-300 rounded",children:"S"}),e.jsx("span",{children:"Toggle ascending/descending"})]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("kbd",{className:"px-2 py-0.5 text-xs bg-gray-100 border border-gray-300 rounded",children:"Alt"}),"+",e.jsx("kbd",{className:"px-2 py-0.5 text-xs bg-gray-100 border border-gray-300 rounded",children:"L"}),e.jsx("span",{children:"Copy sharable link"})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm",role:"toolbar","aria-label":"Sort controls",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"sort-field",className:"text-gray-600",children:"Sort by:"}),e.jsxs("select",{id:"sort-field",value:y.field,onChange:c=>{const v={field:c.target.value,order:"asc"};O(v,`Sorted by ${c.target.value.replace(/_/g," ")} ${v.order==="asc"?"↑":"↓"}`)},className:`
                pl-3 pr-8 py-1 bg-white/30 backdrop-blur-md border border-white/20 
                rounded-lg shadow hover:shadow-md opacity-80 hover:opacity-100 
                appearance-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent 
                transition-all duration-300
                ${y.field==="name"&&"text-indigo-700"}
                ${y.field==="classification"&&"text-purple-700"}
                ${y.field==="updated_at"&&"text-blue-700"}
              `,title:"Press Alt+N for name, Alt+C for class, Alt+U for updated","aria-label":`Sort by ${y.field}, currently ${y.order==="asc"?"ascending":"descending"}`,children:[e.jsxs("option",{value:"name",children:[y.field==="name"&&(y.order==="asc"?"↑ ":"↓ "),"Name"]}),e.jsxs("option",{value:"classification",children:[y.field==="classification"&&(y.order==="asc"?"↑ ":"↓ "),"Classification"]}),e.jsxs("option",{value:"updated_at",children:[y.field==="updated_at"&&(y.order==="asc"?"↑ ":"↓ "),"Last Updated"]})]})]}),e.jsxs("button",{onClick:()=>{const c={...y,order:y.order==="asc"?"desc":"asc"};O(c,`Sort order: ${c.order==="asc"?"ascending ↑":"descending ↓"}`)},className:`
              inline-flex items-center gap-1 px-2.5 py-1.5 
              text-gray-600 hover:text-gray-800 
              border border-transparent hover:border-gray-200 
              rounded-lg transition-all duration-200
              ${y.order==="desc"?"bg-gray-100/50":""}
            `,title:"Press Alt+S to toggle sort order",children:[y.order==="asc"?"↑":"↓",y.order==="asc"?"Ascending":"Descending"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm border-t border-gray-200/30 pt-3 mt-3",children:[!n&&!C&&e.jsxs("span",{className:"text-gray-600",children:["Found ",a.length," medication",a.length!==1?"s":"",(h||l)&&" matching filters"]}),h&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded bg-indigo-100 text-indigo-800 gap-1",children:["Search: ",h,e.jsx("button",{onClick:()=>m(""),className:"hover:text-indigo-600",title:"Clear search",children:e.jsx(ae,{className:"h-3 w-3"})})]}),l&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded bg-purple-100 text-purple-800 gap-1",children:["Type: ",l,e.jsx("button",{onClick:()=>x(""),className:"hover:text-purple-600",title:"Clear classification filter",children:e.jsx(ae,{className:"h-3 w-3"})})]}),(h||l)&&e.jsx("button",{onClick:()=>{m(""),x("")},className:"text-gray-500 hover:text-gray-700 transition-colors text-sm",children:"Clear all filters"})]}),C&&e.jsxs("div",{className:"bg-white/30 backdrop-blur-md border border-white/20 text-red-700 p-4 rounded-xl shadow-lg hover:shadow-xl opacity-80 hover:opacity-100 transition-all duration-300 flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5"}),e.jsx("p",{children:C})]}),e.jsx("div",{className:"space-y-4",children:a.length===0?e.jsxs("div",{className:"text-center p-8 bg-white/30 backdrop-blur-md border border-white/20 rounded-xl shadow-lg hover:shadow-xl opacity-80 hover:opacity-100 transition-all duration-300",children:["No medications found. ",h||l?"Try adjusting your filters.":""]}):a.map((c,v)=>{var b,E,$;return e.jsxs("div",{id:`medication-${v}`,className:`group bg-white/30 backdrop-blur-md border ${d===v?"border-indigo-500 ring-2 ring-indigo-500 ring-opacity-50 shadow-xl scale-[1.02]":"border-white/20 hover:shadow-2xl hover:scale-[1.02]"} rounded-xl shadow-lg opacity-80 hover:opacity-100 p-6 cursor-pointer 
                  transition-all duration-300
                  motion-safe:animate-in 
                  motion-safe:fade-in-0 
                  ${y.order==="asc"?"motion-safe:slide-in-from-bottom-4":"motion-safe:slide-in-from-top-4"}
                  motion-safe:duration-500
                  motion-safe:delay-[${Math.min(v*50,1e3)}ms]`,onClick:()=>p(c),title:`Click to view detailed information (${v+1} of ${a.length})`,role:"button",tabIndex:0,"aria-selected":d===v?"true":"false",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent",children:c.name||"Untitled Medication"}),c.is_premedication&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium bg-indigo-100 text-indigo-800 rounded-full",children:"Pre-Med"})]}),((b=c.brand_names)==null?void 0:b.length)>0&&e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:c.brand_names.join(", ")})]}),e.jsx("span",{className:`px-2.5 py-0.5 rounded-full text-xs font-medium ${mr(c.classification||"")}`,children:xr(c.classification||"")})]}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:($=(E=c.indications)==null?void 0:E.cancer_types)==null?void 0:$.map((L,V)=>e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-md text-xs bg-gray-100 text-gray-800 border border-gray-200 hover:bg-gray-200 transition-colors duration-200 cursor-help",title:`Search for medications indicated for ${L}`,onClick:R=>{R.stopPropagation(),m(L)},children:L},V))})]},c.id)})}),e.jsx(nr,{medication:M,isOpen:!!M,onClose:()=>{p(null);const c=new URL(window.location.href);c.searchParams.delete("med"),window.history.replaceState({},"",c)}})]})})}const br=()=>{const[s,t]=i.useState(0),a=[{id:"treatment-protocols",label:"Treatment Protocols",component:e.jsx(Ma,{})},{id:"medications",label:"Medications",component:e.jsx(hr,{})},{id:"toxicity",label:"Toxicity",component:e.jsx(Xa,{})},{id:"disease-progress",label:"Disease Progress",component:e.jsx(ar,{})}];return e.jsx(Hs,{moduleName:"Chemotherapy Day Unit",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6 text-indigo-700",children:"Chemotherapy Day Unit"}),e.jsxs(A.Group,{selectedIndex:s,onChange:t,children:[e.jsx(A.List,{className:"flex space-x-4 border-b pb-3 mb-6",children:a.map((r,n)=>e.jsx(A,{className:({selected:g})=>`
                cursor-pointer py-2 px-4 rounded-lg shadow transition-all duration-300
                ${g?"bg-gradient-to-r from-indigo-500 to-teal-500 text-white":"bg-white text-gray-600 hover:text-indigo-500 hover:shadow-md"}
              `,children:r.label},n))}),e.jsx(A.Panels,{children:a.map((r,n)=>e.jsx(A.Panel,{children:r.id==="treatment-protocols"?e.jsxs(ut,{children:[e.jsx(_s,{index:!0,element:r.component}),e.jsx(_s,{path:"treatment-protocols/:id",element:e.jsx(qa,{})})]}):r.component},n))})]})]})})},Qs=i.forwardRef(({className:s,size:t="sm",...a},r)=>e.jsx(zs,{ref:r,className:`
        inline-flex items-center justify-center rounded-md font-medium
        transition-colors focus-visible:outline-none focus-visible:ring-2
        focus-visible:ring-indigo-400 focus-visible:ring-offset-2
        disabled:pointer-events-none disabled:opacity-50
        hover:bg-gray-100 hover:text-gray-900
        data-[state=on]:bg-indigo-100 data-[state=on]:text-indigo-900
        dark:hover:bg-gray-800 dark:hover:text-gray-50
        dark:data-[state=on]:bg-indigo-900 dark:data-[state=on]:text-indigo-50
        ${t==="sm"?"text-sm px-2 py-1":"text-base px-3 py-2"}
        ${s}
      `,...a}));Qs.displayName=zs.displayName;const Is=["#4F46E5","#7C3AED","#EC4899","#F59E0B","#10B981"],ur=[{id:"groups",label:"Group Distribution",icon:Je},{id:"intent",label:"Intent Distribution",icon:Zt},{id:"completeness",label:"Completeness",icon:Qt},{id:"timeline",label:"Timeline",icon:Ze}],Ge=s=>{const t=["eligibility","treatment","tests","monitoring","precautions","supportive_care","toxicity_monitoring"];return t.filter(r=>{const n=s[r];return n&&(Array.isArray(n)?n.length>0:typeof n=="object"?Object.keys(n).length>0:!!n)}).length/t.length*100},Es=s=>Math.floor((Date.now()-new Date(s).getTime())/(1e3*60*60*24)),Nr=()=>{const[s,t]=i.useState([]),{theme:a,setTheme:r}=Gt(),n=a==="dark";i.useEffect(()=>{window.scrollTo(0,0)},[]);const{data:g=[],isLoading:h}=Yt({queryKey:["protocols"],queryFn:()=>ss({tumorGroup:null,drugName:null,treatmentIntent:null}),staleTime:1e3*60*5}),m=i.useMemo(()=>g.filter(p=>s.every(d=>{switch(d.type){case"group":return p.tumour_group===d.value;case"intent":return p.treatment_intent===d.value;case"recent":return p.updated_at?Es(p.updated_at)<=30:!1;default:return!0}})),[g,s]),j=i.useMemo(()=>{const p=m.map(Ge),d=m.length,f=d>0?p.reduce((y,F)=>y+F,0)/d:0;return{totalProtocols:d,avgCompleteness:Math.round(f),missingDataCount:m.filter(y=>Ge(y)<70).length,recentlyUpdated:m.filter(y=>y.updated_at?Es(y.updated_at)<=30:!1).length}},[m]),l=p=>{t(d=>d.filter(f=>f.type!==p.type||f.value!==p.value))},x=()=>e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:s.map((p,d)=>e.jsxs(P,{variant:"secondary",className:"flex items-center gap-1",children:[p.type,": ",p.value,e.jsx("button",{onClick:()=>l(p),className:"ml-1 hover:text-red-500",children:e.jsx(ae,{className:"w-3 h-3"})})]},d))}),u=({title:p,value:d,icon:f,color:y})=>e.jsx(Pe,{className:`p-6 ${y} text-white rounded-lg shadow-lg`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm opacity-80",children:p}),e.jsx("p",{className:"text-3xl font-bold mt-1",children:d})]}),e.jsx("div",{className:"text-white/80",children:f})]})}),_=()=>{const p=i.useMemo(()=>{const d={};return m.forEach(f=>{f.tumour_group&&(d[f.tumour_group]=(d[f.tumour_group]||0)+1)}),Object.keys(d).map(f=>({name:f,count:d[f]}))},[m]);return e.jsx("div",{className:"h-[400px]",children:e.jsx(Te,{width:"100%",height:"100%",children:e.jsxs(Cs,{data:p,children:[e.jsx(Le,{strokeDasharray:"3 3"}),e.jsx(Fe,{dataKey:"name"}),e.jsx(Be,{}),e.jsx(Ae,{}),e.jsx($e,{}),e.jsx(Ts,{dataKey:"count",fill:"#4F46E5",name:"Protocols"})]})})})},C=()=>{const p=i.useMemo(()=>{const d={};return m.forEach(f=>{f.treatment_intent&&(d[f.treatment_intent]=(d[f.treatment_intent]||0)+1)}),Object.keys(d).map(f=>({name:f,value:d[f]}))},[m]);return e.jsx("div",{className:"h-[400px]",children:e.jsx(Te,{width:"100%",height:"100%",children:e.jsxs(ea,{children:[e.jsx(sa,{data:p,cx:"50%",cy:"50%",labelLine:!0,label:({name:d,percent:f})=>`${d}: ${(f*100).toFixed(0)}%`,outerRadius:150,fill:"#8884d8",dataKey:"value",children:p.map((d,f)=>e.jsx(ta,{fill:Is[f%Is.length]},`cell-${f}`))}),e.jsx(Ae,{}),e.jsx($e,{})]})})})},I=()=>{const p=i.useMemo(()=>m.map(d=>({name:d.id||`${d.tumour_group||""} Protocol`||"Unnamed Protocol",completeness:Ge(d)})).sort((d,f)=>f.completeness-d.completeness).slice(0,10),[m]);return e.jsx("div",{className:"h-[400px]",children:e.jsx(Te,{width:"100%",height:"100%",children:e.jsxs(Cs,{data:p,layout:"vertical",children:[e.jsx(Le,{strokeDasharray:"3 3"}),e.jsx(Fe,{type:"number",domain:[0,100]}),e.jsx(Be,{dataKey:"name",type:"category",width:150}),e.jsx(Ae,{formatter:d=>[`${d}%`,"Completeness"]}),e.jsx(Ts,{dataKey:"completeness",fill:"#10B981"})]})})})},M=()=>{const p=i.useMemo(()=>{const d={};return m.forEach(f=>{if(f.updated_at){const y=new Date(f.updated_at).toISOString().split("T")[0];d[y]=(d[y]||0)+1}}),Object.keys(d).sort().map(f=>({date:f,count:d[f]})).slice(-30)},[m]);return e.jsx("div",{className:"h-[400px]",children:e.jsx(Te,{width:"100%",height:"100%",children:e.jsxs(aa,{data:p,children:[e.jsx(Le,{strokeDasharray:"3 3"}),e.jsx(Fe,{dataKey:"date"}),e.jsx(Be,{}),e.jsx(Ae,{}),e.jsx($e,{}),e.jsx(ra,{type:"monotone",dataKey:"count",stroke:"#7C3AED",name:"Updates"})]})})})};return h?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"OncoProtocol Explorer"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Explore and manage oncology treatment protocols"})]}),e.jsx(Qs,{pressed:n,onPressedChange:()=>r(n?"light":"dark"),children:n?e.jsx(Jt,{className:"w-4 h-4"}):e.jsx(Wt,{className:"w-4 h-4"})})]}),s.length>0&&x(),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(u,{title:"Total Protocols",value:j.totalProtocols,icon:e.jsx(Xt,{className:"w-6 h-6"}),color:"bg-indigo-500"}),e.jsx(u,{title:"Avg. Completeness",value:`${j.avgCompleteness}%`,icon:e.jsx(Ne,{className:"w-6 h-6"}),color:"bg-green-500"}),e.jsx(u,{title:"Missing Data",value:j.missingDataCount,icon:e.jsx(xe,{className:"w-6 h-6"}),color:"bg-amber-500"}),e.jsx(u,{title:"Recently Updated",value:j.recentlyUpdated,icon:e.jsx(Ze,{className:"w-6 h-6"}),color:"bg-purple-500"})]}),e.jsx(ts,{className:"h-[500px]",children:e.jsx(Pe,{className:"p-6",children:e.jsxs(A.Group,{children:[e.jsxs(A.List,{className:"flex space-x-2 border-b mb-4 overflow-x-auto whitespace-nowrap scrollbar-hide pr-8 relative",children:[ur.map(p=>e.jsxs(A,{className:({selected:d})=>`
                    px-4 py-2 rounded-t-lg font-medium flex items-center space-x-2
                    ${d?"text-indigo-600 dark:text-indigo-400 border-b-2 border-indigo-600 dark:border-indigo-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"}
                  `,children:[e.jsx(p.icon,{className:"w-4 h-4"}),e.jsx("span",{children:p.label})]},p.id)),e.jsx("div",{className:"pointer-events-none absolute top-0 right-0 h-full w-8 bg-gradient-to-l from-white to-transparent dark:from-gray-900"})]}),e.jsxs(A.Panels,{children:[e.jsx(A.Panel,{children:e.jsx(_,{})}),e.jsx(A.Panel,{children:e.jsx(C,{})}),e.jsx(A.Panel,{children:e.jsx(I,{})}),e.jsx(A.Panel,{children:e.jsx(M,{})})]})]})})})]})};export{re as B,Pe as C,De as D,Hs as E,Nr as P,ba as T,ha as a,ua as b,D as c,ya as d,P as e,jr as f,ke as g,Me as h,Qe as i,Gs as j,z as k,H as l,br as m,qa as n,es as s,Sa as t,Ca as u};
//# sourceMappingURL=module-cdu-BUS-kbPn.js.map
